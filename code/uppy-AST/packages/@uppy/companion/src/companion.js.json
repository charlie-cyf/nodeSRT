{"type":"Program","start":0,"end":11941,"body":[{"type":"VariableDeclaration","start":0,"end":24,"declarations":[{"type":"VariableDeclarator","start":6,"end":24,"id":{"type":"Identifier","start":6,"end":8,"name":"fs"},"init":{"type":"CallExpression","start":11,"end":24,"callee":{"type":"Identifier","start":11,"end":18,"name":"require"},"arguments":[{"type":"Literal","start":19,"end":23,"value":"fs","raw":"'fs'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":25,"end":59,"declarations":[{"type":"VariableDeclarator","start":31,"end":59,"id":{"type":"Identifier","start":31,"end":38,"name":"express"},"init":{"type":"CallExpression","start":41,"end":59,"callee":{"type":"Identifier","start":41,"end":48,"name":"require"},"arguments":[{"type":"Literal","start":49,"end":58,"value":"express","raw":"'express'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":74,"end":114,"declarations":[{"type":"VariableDeclarator","start":80,"end":114,"id":{"type":"Identifier","start":80,"end":85,"name":"Grant"},"init":{"type":"CallExpression","start":88,"end":114,"callee":{"type":"MemberExpression","start":88,"end":112,"object":{"type":"CallExpression","start":88,"end":104,"callee":{"type":"Identifier","start":88,"end":95,"name":"require"},"arguments":[{"type":"Literal","start":96,"end":103,"value":"grant","raw":"'grant'"}]},"property":{"type":"Identifier","start":105,"end":112,"name":"express"},"computed":false},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","start":115,"end":162,"declarations":[{"type":"VariableDeclarator","start":121,"end":162,"id":{"type":"Identifier","start":121,"end":132,"name":"grantConfig"},"init":{"type":"CallExpression","start":135,"end":162,"callee":{"type":"CallExpression","start":135,"end":160,"callee":{"type":"Identifier","start":135,"end":142,"name":"require"},"arguments":[{"type":"Literal","start":143,"end":159,"value":"./config/grant","raw":"'./config/grant'"}]},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","start":163,"end":215,"declarations":[{"type":"VariableDeclarator","start":169,"end":215,"id":{"type":"Identifier","start":169,"end":184,"name":"providerManager"},"init":{"type":"CallExpression","start":187,"end":215,"callee":{"type":"Identifier","start":187,"end":194,"name":"require"},"arguments":[{"type":"Literal","start":195,"end":214,"value":"./server/provider","raw":"'./server/provider'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":216,"end":267,"declarations":[{"type":"VariableDeclarator","start":222,"end":267,"id":{"type":"Identifier","start":222,"end":233,"name":"controllers"},"init":{"type":"CallExpression","start":236,"end":267,"callee":{"type":"Identifier","start":236,"end":243,"name":"require"},"arguments":[{"type":"Literal","start":244,"end":266,"value":"./server/controllers","raw":"'./server/controllers'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":268,"end":313,"declarations":[{"type":"VariableDeclarator","start":274,"end":313,"id":{"type":"Identifier","start":274,"end":276,"name":"s3"},"init":{"type":"CallExpression","start":279,"end":313,"callee":{"type":"Identifier","start":279,"end":286,"name":"require"},"arguments":[{"type":"Literal","start":287,"end":312,"value":"./server/controllers/s3","raw":"'./server/controllers/s3'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":314,"end":361,"declarations":[{"type":"VariableDeclarator","start":320,"end":361,"id":{"type":"Identifier","start":320,"end":323,"name":"url"},"init":{"type":"CallExpression","start":326,"end":361,"callee":{"type":"Identifier","start":326,"end":333,"name":"require"},"arguments":[{"type":"Literal","start":334,"end":360,"value":"./server/controllers/url","raw":"'./server/controllers/url'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":362,"end":403,"declarations":[{"type":"VariableDeclarator","start":368,"end":403,"id":{"type":"Identifier","start":368,"end":380,"name":"SocketServer"},"init":{"type":"MemberExpression","start":383,"end":403,"object":{"type":"CallExpression","start":383,"end":396,"callee":{"type":"Identifier","start":383,"end":390,"name":"require"},"arguments":[{"type":"Literal","start":391,"end":395,"value":"ws","raw":"'ws'"}]},"property":{"type":"Identifier","start":397,"end":403,"name":"Server"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":404,"end":447,"declarations":[{"type":"VariableDeclarator","start":410,"end":447,"id":{"type":"Identifier","start":410,"end":417,"name":"emitter"},"init":{"type":"CallExpression","start":420,"end":447,"callee":{"type":"Identifier","start":420,"end":427,"name":"require"},"arguments":[{"type":"Literal","start":428,"end":446,"value":"./server/emitter","raw":"'./server/emitter'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":448,"end":485,"declarations":[{"type":"VariableDeclarator","start":454,"end":485,"id":{"type":"Identifier","start":454,"end":459,"name":"merge"},"init":{"type":"CallExpression","start":462,"end":485,"callee":{"type":"Identifier","start":462,"end":469,"name":"require"},"arguments":[{"type":"Literal","start":470,"end":484,"value":"lodash.merge","raw":"'lodash.merge'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":486,"end":525,"declarations":[{"type":"VariableDeclarator","start":492,"end":525,"id":{"type":"Identifier","start":492,"end":497,"name":"redis"},"init":{"type":"CallExpression","start":500,"end":525,"callee":{"type":"Identifier","start":500,"end":507,"name":"require"},"arguments":[{"type":"Literal","start":508,"end":524,"value":"./server/redis","raw":"'./server/redis'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":526,"end":571,"declarations":[{"type":"VariableDeclarator","start":532,"end":571,"id":{"type":"Identifier","start":532,"end":544,"name":"cookieParser"},"init":{"type":"CallExpression","start":547,"end":571,"callee":{"type":"Identifier","start":547,"end":554,"name":"require"},"arguments":[{"type":"Literal","start":555,"end":570,"value":"cookie-parser","raw":"'cookie-parser'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":572,"end":646,"declarations":[{"type":"VariableDeclarator","start":578,"end":646,"id":{"type":"ObjectPattern","start":578,"end":610,"properties":[{"type":"Property","start":580,"end":593,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":580,"end":593,"name":"jsonStringify"},"kind":"init","value":{"type":"Identifier","start":580,"end":593,"name":"jsonStringify"}},{"type":"Property","start":595,"end":608,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":595,"end":608,"name":"getURLBuilder"},"kind":"init","value":{"type":"Identifier","start":595,"end":608,"name":"getURLBuilder"}}]},"init":{"type":"CallExpression","start":613,"end":646,"callee":{"type":"Identifier","start":613,"end":620,"name":"require"},"arguments":[{"type":"Literal","start":621,"end":645,"value":"./server/helpers/utils","raw":"'./server/helpers/utils'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":647,"end":684,"declarations":[{"type":"VariableDeclarator","start":653,"end":684,"id":{"type":"Identifier","start":653,"end":657,"name":"jobs"},"init":{"type":"CallExpression","start":660,"end":684,"callee":{"type":"Identifier","start":660,"end":667,"name":"require"},"arguments":[{"type":"Literal","start":668,"end":683,"value":"./server/jobs","raw":"'./server/jobs'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":685,"end":735,"declarations":[{"type":"VariableDeclarator","start":691,"end":735,"id":{"type":"Identifier","start":691,"end":702,"name":"interceptor"},"init":{"type":"CallExpression","start":705,"end":735,"callee":{"type":"Identifier","start":705,"end":712,"name":"require"},"arguments":[{"type":"Literal","start":713,"end":734,"value":"express-interceptor","raw":"'express-interceptor'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":736,"end":777,"declarations":[{"type":"VariableDeclarator","start":742,"end":777,"id":{"type":"Identifier","start":742,"end":748,"name":"logger"},"init":{"type":"CallExpression","start":751,"end":777,"callee":{"type":"Identifier","start":751,"end":758,"name":"require"},"arguments":[{"type":"Literal","start":759,"end":776,"value":"./server/logger","raw":"'./server/logger'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":778,"end":833,"declarations":[{"type":"VariableDeclarator","start":784,"end":833,"id":{"type":"ObjectPattern","start":784,"end":802,"properties":[{"type":"Property","start":786,"end":800,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":786,"end":800,"name":"STORAGE_PREFIX"},"kind":"init","value":{"type":"Identifier","start":786,"end":800,"name":"STORAGE_PREFIX"}}]},"init":{"type":"CallExpression","start":805,"end":833,"callee":{"type":"Identifier","start":805,"end":812,"name":"require"},"arguments":[{"type":"Literal","start":813,"end":832,"value":"./server/Uploader","raw":"'./server/Uploader'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":834,"end":885,"declarations":[{"type":"VariableDeclarator","start":840,"end":885,"id":{"type":"Identifier","start":840,"end":851,"name":"middlewares"},"init":{"type":"CallExpression","start":854,"end":885,"callee":{"type":"Identifier","start":854,"end":861,"name":"require"},"arguments":[{"type":"Literal","start":862,"end":884,"value":"./server/middlewares","raw":"'./server/middlewares'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":886,"end":939,"declarations":[{"type":"VariableDeclarator","start":892,"end":939,"id":{"type":"ObjectPattern","start":892,"end":908,"properties":[{"type":"Property","start":894,"end":906,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":894,"end":906,"name":"shortenToken"},"kind":"init","value":{"type":"Identifier","start":894,"end":906,"name":"shortenToken"}}]},"init":{"type":"CallExpression","start":911,"end":939,"callee":{"type":"Identifier","start":911,"end":918,"name":"require"},"arguments":[{"type":"Literal","start":919,"end":938,"value":"./server/Uploader","raw":"'./server/Uploader'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":940,"end":1022,"declarations":[{"type":"VariableDeclarator","start":946,"end":1022,"id":{"type":"ObjectPattern","start":946,"end":985,"properties":[{"type":"Property","start":948,"end":964,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":948,"end":964,"name":"ProviderApiError"},"kind":"init","value":{"type":"Identifier","start":948,"end":964,"name":"ProviderApiError"}},{"type":"Property","start":966,"end":983,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":966,"end":983,"name":"ProviderAuthError"},"kind":"init","value":{"type":"Identifier","start":966,"end":983,"name":"ProviderAuthError"}}]},"init":{"type":"CallExpression","start":988,"end":1022,"callee":{"type":"Identifier","start":988,"end":995,"name":"require"},"arguments":[{"type":"Literal","start":996,"end":1021,"value":"./server/provider/error","raw":"'./server/provider/error'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":1023,"end":1047,"declarations":[{"type":"VariableDeclarator","start":1029,"end":1047,"id":{"type":"Identifier","start":1029,"end":1031,"name":"ms"},"init":{"type":"CallExpression","start":1034,"end":1047,"callee":{"type":"Identifier","start":1034,"end":1041,"name":"require"},"arguments":[{"type":"Literal","start":1042,"end":1046,"value":"ms","raw":"'ms'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":1049,"end":1408,"declarations":[{"type":"VariableDeclarator","start":1055,"end":1408,"id":{"type":"Identifier","start":1055,"end":1069,"name":"defaultOptions"},"init":{"type":"ObjectExpression","start":1072,"end":1408,"properties":[{"type":"Property","start":1076,"end":1124,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1076,"end":1082,"name":"server"},"value":{"type":"ObjectExpression","start":1084,"end":1124,"properties":[{"type":"Property","start":1090,"end":1106,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1090,"end":1098,"name":"protocol"},"value":{"type":"Literal","start":1100,"end":1106,"value":"http","raw":"'http'"},"kind":"init"},{"type":"Property","start":1112,"end":1120,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1112,"end":1116,"name":"path"},"value":{"type":"Literal","start":1118,"end":1120,"value":"","raw":"''"},"kind":"init"}]},"kind":"init"},{"type":"Property","start":1128,"end":1391,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1128,"end":1143,"name":"providerOptions"},"value":{"type":"ObjectExpression","start":1145,"end":1391,"properties":[{"type":"Property","start":1151,"end":1387,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1151,"end":1153,"name":"s3"},"value":{"type":"ObjectExpression","start":1155,"end":1387,"properties":[{"type":"Property","start":1163,"end":1181,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1163,"end":1166,"name":"acl"},"value":{"type":"Literal","start":1168,"end":1181,"value":"public-read","raw":"'public-read'"},"kind":"init"},{"type":"Property","start":1189,"end":1241,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1189,"end":1197,"name":"endpoint"},"value":{"type":"Literal","start":1199,"end":1241,"value":"https://{service}.{region}.amazonaws.com","raw":"'https://{service}.{region}.amazonaws.com'"},"kind":"init"},{"type":"Property","start":1249,"end":1263,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1249,"end":1259,"name":"conditions"},"value":{"type":"ArrayExpression","start":1261,"end":1263,"elements":[]},"kind":"init"},{"type":"Property","start":1271,"end":1299,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1271,"end":1292,"name":"useAccelerateEndpoint"},"value":{"type":"Literal","start":1294,"end":1299,"value":false,"raw":"false"},"kind":"init"},{"type":"Property","start":1307,"end":1342,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1307,"end":1313,"name":"getKey"},"value":{"type":"ArrowFunctionExpression","start":1315,"end":1342,"id":null,"expression":true,"generator":false,"async":false,"params":[{"type":"Identifier","start":1316,"end":1319,"name":"req"},{"type":"Identifier","start":1321,"end":1329,"name":"filename"}],"body":{"type":"Identifier","start":1334,"end":1342,"name":"filename"}},"kind":"init"},{"type":"Property","start":1350,"end":1381,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1350,"end":1357,"name":"expires"},"value":{"type":"BinaryExpression","start":1359,"end":1381,"left":{"type":"CallExpression","start":1359,"end":1374,"callee":{"type":"Identifier","start":1359,"end":1361,"name":"ms"},"arguments":[{"type":"Literal","start":1362,"end":1373,"value":"5 minutes","raw":"'5 minutes'"}]},"operator":"/","right":{"type":"Literal","start":1377,"end":1381,"value":1000,"raw":"1000"}},"kind":"init"}]},"kind":"init"}]},"kind":"init"},{"type":"Property","start":1395,"end":1406,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1395,"end":1400,"name":"debug"},"value":{"type":"Literal","start":1402,"end":1406,"value":true,"raw":"true"},"kind":"init"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":1469,"end":1532,"expression":{"type":"AssignmentExpression","start":1469,"end":1532,"operator":"=","left":{"type":"MemberExpression","start":1469,"end":1490,"object":{"type":"MemberExpression","start":1469,"end":1483,"object":{"type":"Identifier","start":1469,"end":1475,"name":"module"},"property":{"type":"Identifier","start":1476,"end":1483,"name":"exports"},"computed":false},"property":{"type":"Identifier","start":1484,"end":1490,"name":"errors"},"computed":false},"right":{"type":"ObjectExpression","start":1493,"end":1532,"properties":[{"type":"Property","start":1495,"end":1511,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1495,"end":1511,"name":"ProviderApiError"},"kind":"init","value":{"type":"Identifier","start":1495,"end":1511,"name":"ProviderApiError"}},{"type":"Property","start":1513,"end":1530,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1513,"end":1530,"name":"ProviderAuthError"},"kind":"init","value":{"type":"Identifier","start":1513,"end":1530,"name":"ProviderAuthError"}}]}}},{"type":"ExpressionStatement","start":1624,"end":4712,"expression":{"type":"AssignmentExpression","start":1624,"end":4712,"operator":"=","left":{"type":"MemberExpression","start":1624,"end":1642,"object":{"type":"MemberExpression","start":1624,"end":1638,"object":{"type":"Identifier","start":1624,"end":1630,"name":"module"},"property":{"type":"Identifier","start":1631,"end":1638,"name":"exports"},"computed":false},"property":{"type":"Identifier","start":1639,"end":1642,"name":"app"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":1645,"end":4712,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"AssignmentPattern","start":1646,"end":1658,"left":{"type":"Identifier","start":1646,"end":1653,"name":"options"},"right":{"type":"ObjectExpression","start":1656,"end":1658,"properties":[]}}],"body":{"type":"BlockStatement","start":1663,"end":4712,"body":[{"type":"ExpressionStatement","start":1667,"end":1690,"expression":{"type":"CallExpression","start":1667,"end":1690,"callee":{"type":"Identifier","start":1667,"end":1681,"name":"validateConfig"},"arguments":[{"type":"Identifier","start":1682,"end":1689,"name":"options"}]}},{"type":"ExpressionStatement","start":1694,"end":1738,"expression":{"type":"AssignmentExpression","start":1694,"end":1738,"operator":"=","left":{"type":"Identifier","start":1694,"end":1701,"name":"options"},"right":{"type":"CallExpression","start":1704,"end":1738,"callee":{"type":"Identifier","start":1704,"end":1709,"name":"merge"},"arguments":[{"type":"ObjectExpression","start":1710,"end":1712,"properties":[]},{"type":"Identifier","start":1714,"end":1728,"name":"defaultOptions"},{"type":"Identifier","start":1730,"end":1737,"name":"options"}]}}},{"type":"VariableDeclaration","start":1741,"end":1803,"declarations":[{"type":"VariableDeclarator","start":1747,"end":1803,"id":{"type":"Identifier","start":1747,"end":1756,"name":"providers"},"init":{"type":"CallExpression","start":1759,"end":1803,"callee":{"type":"MemberExpression","start":1759,"end":1794,"object":{"type":"Identifier","start":1759,"end":1774,"name":"providerManager"},"property":{"type":"Identifier","start":1775,"end":1794,"name":"getDefaultProviders"},"computed":false},"arguments":[{"type":"Identifier","start":1795,"end":1802,"name":"options"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":1806,"end":1862,"expression":{"type":"CallExpression","start":1806,"end":1862,"callee":{"type":"MemberExpression","start":1806,"end":1840,"object":{"type":"Identifier","start":1806,"end":1821,"name":"providerManager"},"property":{"type":"Identifier","start":1822,"end":1840,"name":"addProviderOptions"},"computed":false},"arguments":[{"type":"Identifier","start":1841,"end":1848,"name":"options"},{"type":"Identifier","start":1850,"end":1861,"name":"grantConfig"}]}},{"type":"VariableDeclaration","start":1866,"end":1913,"declarations":[{"type":"VariableDeclarator","start":1872,"end":1913,"id":{"type":"Identifier","start":1872,"end":1887,"name":"customProviders"},"init":{"type":"MemberExpression","start":1890,"end":1913,"object":{"type":"Identifier","start":1890,"end":1897,"name":"options"},"property":{"type":"Identifier","start":1898,"end":1913,"name":"customProviders"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":1916,"end":2022,"test":{"type":"Identifier","start":1920,"end":1935,"name":"customProviders"},"consequent":{"type":"BlockStatement","start":1937,"end":2022,"body":[{"type":"ExpressionStatement","start":1943,"end":2018,"expression":{"type":"CallExpression","start":1943,"end":2018,"callee":{"type":"MemberExpression","start":1943,"end":1977,"object":{"type":"Identifier","start":1943,"end":1958,"name":"providerManager"},"property":{"type":"Identifier","start":1959,"end":1977,"name":"addCustomProviders"},"computed":false},"arguments":[{"type":"Identifier","start":1978,"end":1993,"name":"customProviders"},{"type":"Identifier","start":1995,"end":2004,"name":"providers"},{"type":"Identifier","start":2006,"end":2017,"name":"grantConfig"}]}}]},"alternate":null},{"type":"ExpressionStatement","start":2071,"end":2090,"expression":{"type":"CallExpression","start":2071,"end":2090,"callee":{"type":"Identifier","start":2071,"end":2081,"name":"maskLogger"},"arguments":[{"type":"Identifier","start":2082,"end":2089,"name":"options"}]}},{"type":"IfStatement","start":2129,"end":2235,"test":{"type":"MemberExpression","start":2133,"end":2149,"object":{"type":"Identifier","start":2133,"end":2140,"name":"options"},"property":{"type":"Identifier","start":2141,"end":2149,"name":"redisUrl"},"computed":false},"consequent":{"type":"BlockStatement","start":2151,"end":2235,"body":[{"type":"ExpressionStatement","start":2157,"end":2231,"expression":{"type":"CallExpression","start":2157,"end":2231,"callee":{"type":"MemberExpression","start":2157,"end":2169,"object":{"type":"Identifier","start":2157,"end":2162,"name":"redis"},"property":{"type":"Identifier","start":2163,"end":2169,"name":"client"},"computed":false},"arguments":[{"type":"CallExpression","start":2170,"end":2230,"callee":{"type":"Identifier","start":2170,"end":2175,"name":"merge"},"arguments":[{"type":"ObjectExpression","start":2176,"end":2201,"properties":[{"type":"Property","start":2178,"end":2199,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":2178,"end":2181,"name":"url"},"value":{"type":"MemberExpression","start":2183,"end":2199,"object":{"type":"Identifier","start":2183,"end":2190,"name":"options"},"property":{"type":"Identifier","start":2191,"end":2199,"name":"redisUrl"},"computed":false},"kind":"init"}]},{"type":"LogicalExpression","start":2203,"end":2229,"left":{"type":"MemberExpression","start":2203,"end":2223,"object":{"type":"Identifier","start":2203,"end":2210,"name":"options"},"property":{"type":"Identifier","start":2211,"end":2223,"name":"redisOptions"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":2227,"end":2229,"properties":[]}}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":2238,"end":2292,"expression":{"type":"CallExpression","start":2238,"end":2292,"callee":{"type":"Identifier","start":2238,"end":2245,"name":"emitter"},"arguments":[{"type":"LogicalExpression","start":2246,"end":2291,"left":{"type":"MemberExpression","start":2246,"end":2271,"object":{"type":"Identifier","start":2246,"end":2253,"name":"options"},"property":{"type":"Identifier","start":2254,"end":2271,"name":"multipleInstances"},"computed":false},"operator":"&&","right":{"type":"MemberExpression","start":2275,"end":2291,"object":{"type":"Identifier","start":2275,"end":2282,"name":"options"},"property":{"type":"Identifier","start":2283,"end":2291,"name":"redisUrl"},"computed":false}}]}},{"type":"VariableDeclaration","start":2296,"end":2317,"declarations":[{"type":"VariableDeclarator","start":2302,"end":2317,"id":{"type":"Identifier","start":2302,"end":2305,"name":"app"},"init":{"type":"CallExpression","start":2308,"end":2317,"callee":{"type":"Identifier","start":2308,"end":2315,"name":"express"},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","start":2320,"end":2343,"expression":{"type":"CallExpression","start":2320,"end":2343,"callee":{"type":"MemberExpression","start":2320,"end":2327,"object":{"type":"Identifier","start":2320,"end":2323,"name":"app"},"property":{"type":"Identifier","start":2324,"end":2327,"name":"use"},"computed":false},"arguments":[{"type":"CallExpression","start":2328,"end":2342,"callee":{"type":"Identifier","start":2328,"end":2340,"name":"cookieParser"},"arguments":[]}]}},{"type":"ExpressionStatement","start":2385,"end":2421,"expression":{"type":"CallExpression","start":2385,"end":2421,"callee":{"type":"MemberExpression","start":2385,"end":2392,"object":{"type":"Identifier","start":2385,"end":2388,"name":"app"},"property":{"type":"Identifier","start":2389,"end":2392,"name":"use"},"computed":false},"arguments":[{"type":"Identifier","start":2393,"end":2420,"name":"interceptGrantErrorResponse"}]}},{"type":"ExpressionStatement","start":2424,"end":2451,"expression":{"type":"CallExpression","start":2424,"end":2451,"callee":{"type":"MemberExpression","start":2424,"end":2431,"object":{"type":"Identifier","start":2424,"end":2427,"name":"app"},"property":{"type":"Identifier","start":2428,"end":2431,"name":"use"},"computed":false},"arguments":[{"type":"CallExpression","start":2432,"end":2450,"callee":{"type":"Identifier","start":2432,"end":2437,"name":"Grant"},"arguments":[{"type":"Identifier","start":2438,"end":2449,"name":"grantConfig"}]}]}},{"type":"ExpressionStatement","start":2454,"end":3415,"expression":{"type":"CallExpression","start":2454,"end":3415,"callee":{"type":"MemberExpression","start":2454,"end":2461,"object":{"type":"Identifier","start":2454,"end":2457,"name":"app"},"property":{"type":"Identifier","start":2458,"end":2461,"name":"use"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":2462,"end":3414,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":2463,"end":2466,"name":"req"},{"type":"Identifier","start":2468,"end":2471,"name":"res"},{"type":"Identifier","start":2473,"end":2477,"name":"next"}],"body":{"type":"BlockStatement","start":2482,"end":3414,"body":[{"type":"ExpressionStatement","start":2488,"end":2560,"expression":{"type":"CallExpression","start":2488,"end":2560,"callee":{"type":"MemberExpression","start":2488,"end":2498,"object":{"type":"Identifier","start":2488,"end":2491,"name":"res"},"property":{"type":"Identifier","start":2492,"end":2498,"name":"header"},"computed":false},"arguments":[{"type":"Literal","start":2499,"end":2529,"value":"Access-Control-Allow-Methods","raw":"'Access-Control-Allow-Methods'"},{"type":"Literal","start":2531,"end":2559,"value":"GET, POST, OPTIONS, DELETE","raw":"'GET, POST, OPTIONS, DELETE'"}]}},{"type":"ExpressionStatement","start":2565,"end":2746,"expression":{"type":"CallExpression","start":2565,"end":2746,"callee":{"type":"MemberExpression","start":2565,"end":2575,"object":{"type":"Identifier","start":2565,"end":2568,"name":"res"},"property":{"type":"Identifier","start":2569,"end":2575,"name":"header"},"computed":false},"arguments":[{"type":"Literal","start":2583,"end":2613,"value":"Access-Control-Allow-Headers","raw":"'Access-Control-Allow-Headers'"},{"type":"CallExpression","start":2621,"end":2740,"callee":{"type":"MemberExpression","start":2621,"end":2735,"object":{"type":"ArrayExpression","start":2621,"end":2730,"elements":[{"type":"Literal","start":2631,"end":2648,"value":"uppy-auth-token","raw":"'uppy-auth-token'"},{"type":"Literal","start":2658,"end":2673,"value":"uppy-versions","raw":"'uppy-versions'"},{"type":"CallExpression","start":2683,"end":2722,"callee":{"type":"MemberExpression","start":2683,"end":2690,"object":{"type":"Identifier","start":2683,"end":2686,"name":"res"},"property":{"type":"Identifier","start":2687,"end":2690,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":2691,"end":2721,"value":"Access-Control-Allow-Headers","raw":"'Access-Control-Allow-Headers'"}]}]},"property":{"type":"Identifier","start":2731,"end":2735,"name":"join"},"computed":false},"arguments":[{"type":"Literal","start":2736,"end":2739,"value":",","raw":"','"}]}]}},{"type":"VariableDeclaration","start":2752,"end":2888,"declarations":[{"type":"VariableDeclarator","start":2758,"end":2888,"id":{"type":"Identifier","start":2758,"end":2772,"name":"exposedHeaders"},"init":{"type":"ArrayExpression","start":2775,"end":2888,"elements":[{"type":"Literal","start":2852,"end":2882,"value":"Access-Control-Allow-Headers","raw":"'Access-Control-Allow-Headers'"}]}}],"kind":"const"},{"type":"IfStatement","start":2894,"end":3118,"test":{"type":"MemberExpression","start":2898,"end":2922,"object":{"type":"Identifier","start":2898,"end":2905,"name":"options"},"property":{"type":"Identifier","start":2906,"end":2922,"name":"sendSelfEndpoint"},"computed":false},"consequent":{"type":"BlockStatement","start":2924,"end":3118,"body":[{"type":"ExpressionStatement","start":2972,"end":2999,"expression":{"type":"CallExpression","start":2972,"end":2999,"callee":{"type":"MemberExpression","start":2972,"end":2991,"object":{"type":"Identifier","start":2972,"end":2986,"name":"exposedHeaders"},"property":{"type":"Identifier","start":2987,"end":2991,"name":"push"},"computed":false},"arguments":[{"type":"Literal","start":2992,"end":2998,"value":"i-am","raw":"'i-am'"}]}},{"type":"VariableDeclaration","start":3007,"end":3042,"declarations":[{"type":"VariableDeclarator","start":3013,"end":3042,"id":{"type":"ObjectPattern","start":3013,"end":3025,"properties":[{"type":"Property","start":3015,"end":3023,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":3015,"end":3023,"name":"protocol"},"kind":"init","value":{"type":"Identifier","start":3015,"end":3023,"name":"protocol"}}]},"init":{"type":"MemberExpression","start":3028,"end":3042,"object":{"type":"Identifier","start":3028,"end":3035,"name":"options"},"property":{"type":"Identifier","start":3036,"end":3042,"name":"server"},"computed":false}}],"kind":"const"},{"type":"ExpressionStatement","start":3049,"end":3112,"expression":{"type":"CallExpression","start":3049,"end":3112,"callee":{"type":"MemberExpression","start":3049,"end":3059,"object":{"type":"Identifier","start":3049,"end":3052,"name":"res"},"property":{"type":"Identifier","start":3053,"end":3059,"name":"header"},"computed":false},"arguments":[{"type":"Literal","start":3060,"end":3066,"value":"i-am","raw":"'i-am'"},{"type":"TemplateLiteral","start":3068,"end":3111,"expressions":[{"type":"Identifier","start":3071,"end":3079,"name":"protocol"},{"type":"MemberExpression","start":3085,"end":3109,"object":{"type":"Identifier","start":3085,"end":3092,"name":"options"},"property":{"type":"Identifier","start":3093,"end":3109,"name":"sendSelfEndpoint"},"computed":false}],"quasis":[{"type":"TemplateElement","start":3069,"end":3069,"value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","start":3080,"end":3083,"value":{"raw":"://","cooked":"://"},"tail":false},{"type":"TemplateElement","start":3110,"end":3110,"value":{"raw":"","cooked":""},"tail":true}]}]}}]},"alternate":null},{"type":"IfStatement","start":3124,"end":3324,"test":{"type":"CallExpression","start":3128,"end":3168,"callee":{"type":"MemberExpression","start":3128,"end":3135,"object":{"type":"Identifier","start":3128,"end":3131,"name":"res"},"property":{"type":"Identifier","start":3132,"end":3135,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":3136,"end":3167,"value":"Access-Control-Expose-Headers","raw":"'Access-Control-Expose-Headers'"}]},"consequent":{"type":"BlockStatement","start":3170,"end":3324,"body":[{"type":"ExpressionStatement","start":3257,"end":3318,"expression":{"type":"CallExpression","start":3257,"end":3318,"callee":{"type":"MemberExpression","start":3257,"end":3276,"object":{"type":"Identifier","start":3257,"end":3271,"name":"exposedHeaders"},"property":{"type":"Identifier","start":3272,"end":3276,"name":"push"},"computed":false},"arguments":[{"type":"CallExpression","start":3277,"end":3317,"callee":{"type":"MemberExpression","start":3277,"end":3284,"object":{"type":"Identifier","start":3277,"end":3280,"name":"res"},"property":{"type":"Identifier","start":3281,"end":3284,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":3285,"end":3316,"value":"Access-Control-Expose-Headers","raw":"'Access-Control-Expose-Headers'"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":3330,"end":3399,"expression":{"type":"CallExpression","start":3330,"end":3399,"callee":{"type":"MemberExpression","start":3330,"end":3340,"object":{"type":"Identifier","start":3330,"end":3333,"name":"res"},"property":{"type":"Identifier","start":3334,"end":3340,"name":"header"},"computed":false},"arguments":[{"type":"Literal","start":3341,"end":3372,"value":"Access-Control-Expose-Headers","raw":"'Access-Control-Expose-Headers'"},{"type":"CallExpression","start":3374,"end":3398,"callee":{"type":"MemberExpression","start":3374,"end":3393,"object":{"type":"Identifier","start":3374,"end":3388,"name":"exposedHeaders"},"property":{"type":"Identifier","start":3389,"end":3393,"name":"join"},"computed":false},"arguments":[{"type":"Literal","start":3394,"end":3397,"value":",","raw":"','"}]}]}},{"type":"ExpressionStatement","start":3404,"end":3410,"expression":{"type":"CallExpression","start":3404,"end":3410,"callee":{"type":"Identifier","start":3404,"end":3408,"name":"next"},"arguments":[]}}]}}]}},{"type":"ExpressionStatement","start":3509,"end":3552,"expression":{"type":"CallExpression","start":3509,"end":3552,"callee":{"type":"MemberExpression","start":3509,"end":3516,"object":{"type":"Identifier","start":3509,"end":3512,"name":"app"},"property":{"type":"Identifier","start":3513,"end":3516,"name":"use"},"computed":false},"arguments":[{"type":"Literal","start":3517,"end":3520,"value":"*","raw":"'*'"},{"type":"CallExpression","start":3522,"end":3551,"callee":{"type":"Identifier","start":3522,"end":3542,"name":"getOptionsMiddleware"},"arguments":[{"type":"Identifier","start":3543,"end":3550,"name":"options"}]}]}},{"type":"ExpressionStatement","start":3555,"end":3601,"expression":{"type":"CallExpression","start":3555,"end":3601,"callee":{"type":"MemberExpression","start":3555,"end":3562,"object":{"type":"Identifier","start":3555,"end":3558,"name":"app"},"property":{"type":"Identifier","start":3559,"end":3562,"name":"use"},"computed":false},"arguments":[{"type":"Literal","start":3563,"end":3568,"value":"/s3","raw":"'/s3'"},{"type":"CallExpression","start":3570,"end":3600,"callee":{"type":"Identifier","start":3570,"end":3572,"name":"s3"},"arguments":[{"type":"MemberExpression","start":3573,"end":3599,"object":{"type":"MemberExpression","start":3573,"end":3596,"object":{"type":"Identifier","start":3573,"end":3580,"name":"options"},"property":{"type":"Identifier","start":3581,"end":3596,"name":"providerOptions"},"computed":false},"property":{"type":"Identifier","start":3597,"end":3599,"name":"s3"},"computed":false}]}]}},{"type":"ExpressionStatement","start":3604,"end":3626,"expression":{"type":"CallExpression","start":3604,"end":3626,"callee":{"type":"MemberExpression","start":3604,"end":3611,"object":{"type":"Identifier","start":3604,"end":3607,"name":"app"},"property":{"type":"Identifier","start":3608,"end":3611,"name":"use"},"computed":false},"arguments":[{"type":"Literal","start":3612,"end":3618,"value":"/url","raw":"'/url'"},{"type":"CallExpression","start":3620,"end":3625,"callee":{"type":"Identifier","start":3620,"end":3623,"name":"url"},"arguments":[]}]}},{"type":"ExpressionStatement","start":3630,"end":3721,"expression":{"type":"CallExpression","start":3630,"end":3721,"callee":{"type":"MemberExpression","start":3630,"end":3637,"object":{"type":"Identifier","start":3630,"end":3633,"name":"app"},"property":{"type":"Identifier","start":3634,"end":3637,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":3638,"end":3663,"value":"/:providerName/callback","raw":"'/:providerName/callback'"},{"type":"MemberExpression","start":3665,"end":3698,"object":{"type":"Identifier","start":3665,"end":3676,"name":"middlewares"},"property":{"type":"Identifier","start":3677,"end":3698,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":3700,"end":3720,"object":{"type":"Identifier","start":3700,"end":3711,"name":"controllers"},"property":{"type":"Identifier","start":3712,"end":3720,"name":"callback"},"computed":false}]}},{"type":"ExpressionStatement","start":3724,"end":3813,"expression":{"type":"CallExpression","start":3724,"end":3813,"callee":{"type":"MemberExpression","start":3724,"end":3731,"object":{"type":"Identifier","start":3724,"end":3727,"name":"app"},"property":{"type":"Identifier","start":3728,"end":3731,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":3732,"end":3756,"value":"/:providerName/connect","raw":"'/:providerName/connect'"},{"type":"MemberExpression","start":3758,"end":3791,"object":{"type":"Identifier","start":3758,"end":3769,"name":"middlewares"},"property":{"type":"Identifier","start":3770,"end":3791,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":3793,"end":3812,"object":{"type":"Identifier","start":3793,"end":3804,"name":"controllers"},"property":{"type":"Identifier","start":3805,"end":3812,"name":"connect"},"computed":false}]}},{"type":"ExpressionStatement","start":3816,"end":3907,"expression":{"type":"CallExpression","start":3816,"end":3907,"callee":{"type":"MemberExpression","start":3816,"end":3823,"object":{"type":"Identifier","start":3816,"end":3819,"name":"app"},"property":{"type":"Identifier","start":3820,"end":3823,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":3824,"end":3849,"value":"/:providerName/redirect","raw":"'/:providerName/redirect'"},{"type":"MemberExpression","start":3851,"end":3884,"object":{"type":"Identifier","start":3851,"end":3862,"name":"middlewares"},"property":{"type":"Identifier","start":3863,"end":3884,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":3886,"end":3906,"object":{"type":"Identifier","start":3886,"end":3897,"name":"controllers"},"property":{"type":"Identifier","start":3898,"end":3906,"name":"redirect"},"computed":false}]}},{"type":"ExpressionStatement","start":3910,"end":4028,"expression":{"type":"CallExpression","start":3910,"end":4028,"callee":{"type":"MemberExpression","start":3910,"end":3917,"object":{"type":"Identifier","start":3910,"end":3913,"name":"app"},"property":{"type":"Identifier","start":3914,"end":3917,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":3918,"end":3941,"value":"/:providerName/logout","raw":"'/:providerName/logout'"},{"type":"MemberExpression","start":3943,"end":3976,"object":{"type":"Identifier","start":3943,"end":3954,"name":"middlewares"},"property":{"type":"Identifier","start":3955,"end":3976,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":3978,"end":4007,"object":{"type":"Identifier","start":3978,"end":3989,"name":"middlewares"},"property":{"type":"Identifier","start":3990,"end":4007,"name":"gentleVerifyToken"},"computed":false},{"type":"MemberExpression","start":4009,"end":4027,"object":{"type":"Identifier","start":4009,"end":4020,"name":"controllers"},"property":{"type":"Identifier","start":4021,"end":4027,"name":"logout"},"computed":false}]}},{"type":"ExpressionStatement","start":4031,"end":4150,"expression":{"type":"CallExpression","start":4031,"end":4150,"callee":{"type":"MemberExpression","start":4031,"end":4038,"object":{"type":"Identifier","start":4031,"end":4034,"name":"app"},"property":{"type":"Identifier","start":4035,"end":4038,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":4039,"end":4066,"value":"/:providerName/send-token","raw":"'/:providerName/send-token'"},{"type":"MemberExpression","start":4068,"end":4101,"object":{"type":"Identifier","start":4068,"end":4079,"name":"middlewares"},"property":{"type":"Identifier","start":4080,"end":4101,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":4103,"end":4126,"object":{"type":"Identifier","start":4103,"end":4114,"name":"middlewares"},"property":{"type":"Identifier","start":4115,"end":4126,"name":"verifyToken"},"computed":false},{"type":"MemberExpression","start":4128,"end":4149,"object":{"type":"Identifier","start":4128,"end":4139,"name":"controllers"},"property":{"type":"Identifier","start":4140,"end":4149,"name":"sendToken"},"computed":false}]}},{"type":"ExpressionStatement","start":4153,"end":4266,"expression":{"type":"CallExpression","start":4153,"end":4266,"callee":{"type":"MemberExpression","start":4153,"end":4160,"object":{"type":"Identifier","start":4153,"end":4156,"name":"app"},"property":{"type":"Identifier","start":4157,"end":4160,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":4161,"end":4187,"value":"/:providerName/list/:id?","raw":"'/:providerName/list/:id?'"},{"type":"MemberExpression","start":4189,"end":4222,"object":{"type":"Identifier","start":4189,"end":4200,"name":"middlewares"},"property":{"type":"Identifier","start":4201,"end":4222,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":4224,"end":4247,"object":{"type":"Identifier","start":4224,"end":4235,"name":"middlewares"},"property":{"type":"Identifier","start":4236,"end":4247,"name":"verifyToken"},"computed":false},{"type":"MemberExpression","start":4249,"end":4265,"object":{"type":"Identifier","start":4249,"end":4260,"name":"controllers"},"property":{"type":"Identifier","start":4261,"end":4265,"name":"list"},"computed":false}]}},{"type":"ExpressionStatement","start":4269,"end":4380,"expression":{"type":"CallExpression","start":4269,"end":4380,"callee":{"type":"MemberExpression","start":4269,"end":4277,"object":{"type":"Identifier","start":4269,"end":4272,"name":"app"},"property":{"type":"Identifier","start":4273,"end":4277,"name":"post"},"computed":false},"arguments":[{"type":"Literal","start":4278,"end":4302,"value":"/:providerName/get/:id","raw":"'/:providerName/get/:id'"},{"type":"MemberExpression","start":4304,"end":4337,"object":{"type":"Identifier","start":4304,"end":4315,"name":"middlewares"},"property":{"type":"Identifier","start":4316,"end":4337,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":4339,"end":4362,"object":{"type":"Identifier","start":4339,"end":4350,"name":"middlewares"},"property":{"type":"Identifier","start":4351,"end":4362,"name":"verifyToken"},"computed":false},{"type":"MemberExpression","start":4364,"end":4379,"object":{"type":"Identifier","start":4364,"end":4375,"name":"controllers"},"property":{"type":"Identifier","start":4376,"end":4379,"name":"get"},"computed":false}]}},{"type":"ExpressionStatement","start":4383,"end":4534,"expression":{"type":"CallExpression","start":4383,"end":4534,"callee":{"type":"MemberExpression","start":4383,"end":4390,"object":{"type":"Identifier","start":4383,"end":4386,"name":"app"},"property":{"type":"Identifier","start":4387,"end":4390,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":4391,"end":4421,"value":"/:providerName/thumbnail/:id","raw":"'/:providerName/thumbnail/:id'"},{"type":"MemberExpression","start":4423,"end":4456,"object":{"type":"Identifier","start":4423,"end":4434,"name":"middlewares"},"property":{"type":"Identifier","start":4435,"end":4456,"name":"hasSessionAndProvider"},"computed":false},{"type":"MemberExpression","start":4458,"end":4485,"object":{"type":"Identifier","start":4458,"end":4469,"name":"middlewares"},"property":{"type":"Identifier","start":4470,"end":4485,"name":"cookieAuthToken"},"computed":false},{"type":"MemberExpression","start":4487,"end":4510,"object":{"type":"Identifier","start":4487,"end":4498,"name":"middlewares"},"property":{"type":"Identifier","start":4499,"end":4510,"name":"verifyToken"},"computed":false},{"type":"MemberExpression","start":4512,"end":4533,"object":{"type":"Identifier","start":4512,"end":4523,"name":"controllers"},"property":{"type":"Identifier","start":4524,"end":4533,"name":"thumbnail"},"computed":false}]}},{"type":"ExpressionStatement","start":4538,"end":4613,"expression":{"type":"CallExpression","start":4538,"end":4613,"callee":{"type":"MemberExpression","start":4538,"end":4547,"object":{"type":"Identifier","start":4538,"end":4541,"name":"app"},"property":{"type":"Identifier","start":4542,"end":4547,"name":"param"},"computed":false},"arguments":[{"type":"Literal","start":4548,"end":4562,"value":"providerName","raw":"'providerName'"},{"type":"CallExpression","start":4564,"end":4612,"callee":{"type":"MemberExpression","start":4564,"end":4601,"object":{"type":"Identifier","start":4564,"end":4579,"name":"providerManager"},"property":{"type":"Identifier","start":4580,"end":4601,"name":"getProviderMiddleware"},"computed":false},"arguments":[{"type":"Identifier","start":4602,"end":4611,"name":"providers"}]}]}},{"type":"IfStatement","start":4617,"end":4696,"test":{"type":"BinaryExpression","start":4621,"end":4646,"left":{"type":"CallExpression","start":4621,"end":4635,"callee":{"type":"MemberExpression","start":4621,"end":4628,"object":{"type":"Identifier","start":4621,"end":4624,"name":"app"},"property":{"type":"Identifier","start":4625,"end":4628,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":4629,"end":4634,"value":"env","raw":"'env'"}]},"operator":"!==","right":{"type":"Literal","start":4640,"end":4646,"value":"test","raw":"'test'"}},"consequent":{"type":"BlockStatement","start":4648,"end":4696,"body":[{"type":"ExpressionStatement","start":4654,"end":4692,"expression":{"type":"CallExpression","start":4654,"end":4692,"callee":{"type":"MemberExpression","start":4654,"end":4674,"object":{"type":"Identifier","start":4654,"end":4658,"name":"jobs"},"property":{"type":"Identifier","start":4659,"end":4674,"name":"startCleanUpJob"},"computed":false},"arguments":[{"type":"MemberExpression","start":4675,"end":4691,"object":{"type":"Identifier","start":4675,"end":4682,"name":"options"},"property":{"type":"Identifier","start":4683,"end":4691,"name":"filePath"},"computed":false}]}}]},"alternate":null},{"type":"ReturnStatement","start":4700,"end":4710,"argument":{"type":"Identifier","start":4707,"end":4710,"name":"app"}}]}}}},{"type":"ExpressionStatement","start":4814,"end":6566,"expression":{"type":"AssignmentExpression","start":4814,"end":6566,"operator":"=","left":{"type":"MemberExpression","start":4814,"end":4835,"object":{"type":"MemberExpression","start":4814,"end":4828,"object":{"type":"Identifier","start":4814,"end":4820,"name":"module"},"property":{"type":"Identifier","start":4821,"end":4828,"name":"exports"},"computed":false},"property":{"type":"Identifier","start":4829,"end":4835,"name":"socket"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":4838,"end":6566,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":4839,"end":4845,"name":"server"}],"body":{"type":"BlockStatement","start":4850,"end":6566,"body":[{"type":"VariableDeclaration","start":4854,"end":4894,"declarations":[{"type":"VariableDeclarator","start":4860,"end":4894,"id":{"type":"Identifier","start":4860,"end":4863,"name":"wss"},"init":{"type":"NewExpression","start":4866,"end":4894,"callee":{"type":"Identifier","start":4870,"end":4882,"name":"SocketServer"},"arguments":[{"type":"ObjectExpression","start":4883,"end":4893,"properties":[{"type":"Property","start":4885,"end":4891,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":4885,"end":4891,"name":"server"},"kind":"init","value":{"type":"Identifier","start":4885,"end":4891,"name":"server"}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","start":4897,"end":4931,"declarations":[{"type":"VariableDeclarator","start":4903,"end":4931,"id":{"type":"Identifier","start":4903,"end":4914,"name":"redisClient"},"init":{"type":"CallExpression","start":4917,"end":4931,"callee":{"type":"MemberExpression","start":4917,"end":4929,"object":{"type":"Identifier","start":4917,"end":4922,"name":"redis"},"property":{"type":"Identifier","start":4923,"end":4929,"name":"client"},"computed":false},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","start":5097,"end":6564,"expression":{"type":"CallExpression","start":5097,"end":6564,"callee":{"type":"MemberExpression","start":5097,"end":5103,"object":{"type":"Identifier","start":5097,"end":5100,"name":"wss"},"property":{"type":"Identifier","start":5101,"end":5103,"name":"on"},"computed":false},"arguments":[{"type":"Literal","start":5104,"end":5116,"value":"connection","raw":"'connection'"},{"type":"ArrowFunctionExpression","start":5118,"end":6563,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":5119,"end":5121,"name":"ws"},{"type":"Identifier","start":5123,"end":5126,"name":"req"}],"body":{"type":"BlockStatement","start":5131,"end":6563,"body":[{"type":"VariableDeclaration","start":5155,"end":5179,"declarations":[{"type":"VariableDeclarator","start":5161,"end":5179,"id":{"type":"Identifier","start":5161,"end":5169,"name":"fullPath"},"init":{"type":"MemberExpression","start":5172,"end":5179,"object":{"type":"Identifier","start":5172,"end":5175,"name":"req"},"property":{"type":"Identifier","start":5176,"end":5179,"name":"url"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":5295,"end":5343,"declarations":[{"type":"VariableDeclarator","start":5301,"end":5343,"id":{"type":"Identifier","start":5301,"end":5306,"name":"token"},"init":{"type":"CallExpression","start":5309,"end":5343,"callee":{"type":"MemberExpression","start":5309,"end":5325,"object":{"type":"Identifier","start":5309,"end":5317,"name":"fullPath"},"property":{"type":"Identifier","start":5318,"end":5325,"name":"replace"},"computed":false},"arguments":[{"type":"Literal","start":5326,"end":5338,"value":{},"raw":"/^.*\\/api\\//","regex":{"pattern":"^.*\\/api\\/","flags":""}},{"type":"Literal","start":5340,"end":5342,"value":"","raw":"''"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":5348,"end":5414,"expression":{"type":"CallExpression","start":5348,"end":5414,"callee":{"type":"MemberExpression","start":5348,"end":5359,"object":{"type":"Identifier","start":5348,"end":5354,"name":"logger"},"property":{"type":"Identifier","start":5355,"end":5359,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":5360,"end":5395,"expressions":[{"type":"Identifier","start":5388,"end":5393,"name":"token"}],"quasis":[{"type":"TemplateElement","start":5361,"end":5386,"value":{"raw":"connection received from ","cooked":"connection received from "},"tail":false},{"type":"TemplateElement","start":5394,"end":5394,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":5397,"end":5413,"value":"socket.connect","raw":"'socket.connect'"}]}},{"type":"FunctionDeclaration","start":5498,"end":5670,"id":{"type":"Identifier","start":5507,"end":5519,"name":"sendProgress"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":5521,"end":5525,"name":"data"}],"body":{"type":"BlockStatement","start":5527,"end":5670,"body":[{"type":"ExpressionStatement","start":5535,"end":5664,"expression":{"type":"CallExpression","start":5535,"end":5664,"callee":{"type":"MemberExpression","start":5535,"end":5542,"object":{"type":"Identifier","start":5535,"end":5537,"name":"ws"},"property":{"type":"Identifier","start":5538,"end":5542,"name":"send"},"computed":false},"arguments":[{"type":"CallExpression","start":5543,"end":5562,"callee":{"type":"Identifier","start":5543,"end":5556,"name":"jsonStringify"},"arguments":[{"type":"Identifier","start":5557,"end":5561,"name":"data"}]},{"type":"ArrowFunctionExpression","start":5564,"end":5663,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":5565,"end":5568,"name":"err"}],"body":{"type":"BlockStatement","start":5573,"end":5663,"body":[{"type":"IfStatement","start":5583,"end":5655,"test":{"type":"Identifier","start":5587,"end":5590,"name":"err"},"consequent":{"type":"ExpressionStatement","start":5592,"end":5655,"expression":{"type":"CallExpression","start":5592,"end":5655,"callee":{"type":"MemberExpression","start":5592,"end":5604,"object":{"type":"Identifier","start":5592,"end":5598,"name":"logger"},"property":{"type":"Identifier","start":5599,"end":5604,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":5605,"end":5608,"name":"err"},{"type":"Literal","start":5610,"end":5633,"value":"socket.progress.error","raw":"'socket.progress.error'"},{"type":"CallExpression","start":5635,"end":5654,"callee":{"type":"Identifier","start":5635,"end":5647,"name":"shortenToken"},"arguments":[{"type":"Identifier","start":5648,"end":5653,"name":"token"}]}]}},"alternate":null}]}}]}}]}},{"type":"IfStatement","start":5819,"end":6135,"test":{"type":"Identifier","start":5823,"end":5834,"name":"redisClient"},"consequent":{"type":"BlockStatement","start":5836,"end":6135,"body":[{"type":"ExpressionStatement","start":5844,"end":6129,"expression":{"type":"CallExpression","start":5844,"end":6129,"callee":{"type":"MemberExpression","start":5844,"end":5859,"object":{"type":"Identifier","start":5844,"end":5855,"name":"redisClient"},"property":{"type":"Identifier","start":5856,"end":5859,"name":"get"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":5860,"end":5888,"expressions":[{"type":"Identifier","start":5863,"end":5877,"name":"STORAGE_PREFIX"},{"type":"Identifier","start":5881,"end":5886,"name":"token"}],"quasis":[{"type":"TemplateElement","start":5861,"end":5861,"value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","start":5878,"end":5879,"value":{"raw":":","cooked":":"},"tail":false},{"type":"TemplateElement","start":5887,"end":5887,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"ArrowFunctionExpression","start":5890,"end":6128,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":5891,"end":5894,"name":"err"},{"type":"Identifier","start":5896,"end":5900,"name":"data"}],"body":{"type":"BlockStatement","start":5905,"end":6128,"body":[{"type":"IfStatement","start":5915,"end":5984,"test":{"type":"Identifier","start":5919,"end":5922,"name":"err"},"consequent":{"type":"ExpressionStatement","start":5924,"end":5984,"expression":{"type":"CallExpression","start":5924,"end":5984,"callee":{"type":"MemberExpression","start":5924,"end":5936,"object":{"type":"Identifier","start":5924,"end":5930,"name":"logger"},"property":{"type":"Identifier","start":5931,"end":5936,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":5937,"end":5940,"name":"err"},{"type":"Literal","start":5942,"end":5962,"value":"socket.redis.error","raw":"'socket.redis.error'"},{"type":"CallExpression","start":5964,"end":5983,"callee":{"type":"Identifier","start":5964,"end":5976,"name":"shortenToken"},"arguments":[{"type":"Identifier","start":5977,"end":5982,"name":"token"}]}]}},"alternate":null},{"type":"IfStatement","start":5993,"end":6120,"test":{"type":"Identifier","start":5997,"end":6001,"name":"data"},"consequent":{"type":"BlockStatement","start":6003,"end":6120,"body":[{"type":"VariableDeclaration","start":6015,"end":6058,"declarations":[{"type":"VariableDeclarator","start":6021,"end":6058,"id":{"type":"Identifier","start":6021,"end":6028,"name":"dataObj"},"init":{"type":"CallExpression","start":6031,"end":6058,"callee":{"type":"MemberExpression","start":6031,"end":6041,"object":{"type":"Identifier","start":6031,"end":6035,"name":"JSON"},"property":{"type":"Identifier","start":6036,"end":6041,"name":"parse"},"computed":false},"arguments":[{"type":"CallExpression","start":6042,"end":6057,"callee":{"type":"MemberExpression","start":6042,"end":6055,"object":{"type":"Identifier","start":6042,"end":6046,"name":"data"},"property":{"type":"Identifier","start":6047,"end":6055,"name":"toString"},"computed":false},"arguments":[]}]}}],"kind":"const"},{"type":"IfStatement","start":6069,"end":6110,"test":{"type":"MemberExpression","start":6073,"end":6087,"object":{"type":"Identifier","start":6073,"end":6080,"name":"dataObj"},"property":{"type":"Identifier","start":6081,"end":6087,"name":"action"},"computed":false},"consequent":{"type":"ExpressionStatement","start":6089,"end":6110,"expression":{"type":"CallExpression","start":6089,"end":6110,"callee":{"type":"Identifier","start":6089,"end":6101,"name":"sendProgress"},"arguments":[{"type":"Identifier","start":6102,"end":6109,"name":"dataObj"}]}},"alternate":null}]},"alternate":null}]}}]}}]},"alternate":null},{"type":"ExpressionStatement","start":6141,"end":6178,"expression":{"type":"CallExpression","start":6141,"end":6178,"callee":{"type":"MemberExpression","start":6141,"end":6155,"object":{"type":"CallExpression","start":6141,"end":6150,"callee":{"type":"Identifier","start":6141,"end":6148,"name":"emitter"},"arguments":[]},"property":{"type":"Identifier","start":6151,"end":6155,"name":"emit"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":6156,"end":6177,"expressions":[{"type":"Identifier","start":6170,"end":6175,"name":"token"}],"quasis":[{"type":"TemplateElement","start":6157,"end":6168,"value":{"raw":"connection:","cooked":"connection:"},"tail":false},{"type":"TemplateElement","start":6176,"end":6176,"value":{"raw":"","cooked":""},"tail":true}]}]}},{"type":"ExpressionStatement","start":6183,"end":6216,"expression":{"type":"CallExpression","start":6183,"end":6216,"callee":{"type":"MemberExpression","start":6183,"end":6195,"object":{"type":"CallExpression","start":6183,"end":6192,"callee":{"type":"Identifier","start":6183,"end":6190,"name":"emitter"},"arguments":[]},"property":{"type":"Identifier","start":6193,"end":6195,"name":"on"},"computed":false},"arguments":[{"type":"Identifier","start":6196,"end":6201,"name":"token"},{"type":"Identifier","start":6203,"end":6215,"name":"sendProgress"}]}},{"type":"ExpressionStatement","start":6222,"end":6472,"expression":{"type":"CallExpression","start":6222,"end":6472,"callee":{"type":"MemberExpression","start":6222,"end":6227,"object":{"type":"Identifier","start":6222,"end":6224,"name":"ws"},"property":{"type":"Identifier","start":6225,"end":6227,"name":"on"},"computed":false},"arguments":[{"type":"Literal","start":6228,"end":6237,"value":"message","raw":"'message'"},{"type":"ArrowFunctionExpression","start":6239,"end":6471,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":6240,"end":6248,"name":"jsonData"}],"body":{"type":"BlockStatement","start":6253,"end":6471,"body":[{"type":"VariableDeclaration","start":6261,"end":6305,"declarations":[{"type":"VariableDeclarator","start":6267,"end":6305,"id":{"type":"Identifier","start":6267,"end":6271,"name":"data"},"init":{"type":"CallExpression","start":6274,"end":6305,"callee":{"type":"MemberExpression","start":6274,"end":6284,"object":{"type":"Identifier","start":6274,"end":6278,"name":"JSON"},"property":{"type":"Identifier","start":6279,"end":6284,"name":"parse"},"computed":false},"arguments":[{"type":"CallExpression","start":6285,"end":6304,"callee":{"type":"MemberExpression","start":6285,"end":6302,"object":{"type":"Identifier","start":6285,"end":6293,"name":"jsonData"},"property":{"type":"Identifier","start":6294,"end":6302,"name":"toString"},"computed":false},"arguments":[]}]}}],"kind":"const"},{"type":"IfStatement","start":6349,"end":6465,"test":{"type":"CallExpression","start":6353,"end":6404,"callee":{"type":"MemberExpression","start":6353,"end":6391,"object":{"type":"ArrayExpression","start":6353,"end":6382,"elements":[{"type":"Literal","start":6354,"end":6361,"value":"pause","raw":"'pause'"},{"type":"Literal","start":6363,"end":6371,"value":"resume","raw":"'resume'"},{"type":"Literal","start":6373,"end":6381,"value":"cancel","raw":"'cancel'"}]},"property":{"type":"Identifier","start":6383,"end":6391,"name":"includes"},"computed":false},"arguments":[{"type":"MemberExpression","start":6392,"end":6403,"object":{"type":"Identifier","start":6392,"end":6396,"name":"data"},"property":{"type":"Identifier","start":6397,"end":6403,"name":"action"},"computed":false}]},"consequent":{"type":"BlockStatement","start":6406,"end":6465,"body":[{"type":"ExpressionStatement","start":6416,"end":6457,"expression":{"type":"CallExpression","start":6416,"end":6457,"callee":{"type":"MemberExpression","start":6416,"end":6430,"object":{"type":"CallExpression","start":6416,"end":6425,"callee":{"type":"Identifier","start":6416,"end":6423,"name":"emitter"},"arguments":[]},"property":{"type":"Identifier","start":6426,"end":6430,"name":"emit"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":6431,"end":6456,"expressions":[{"type":"MemberExpression","start":6434,"end":6445,"object":{"type":"Identifier","start":6434,"end":6438,"name":"data"},"property":{"type":"Identifier","start":6439,"end":6445,"name":"action"},"computed":false},{"type":"Identifier","start":6449,"end":6454,"name":"token"}],"quasis":[{"type":"TemplateElement","start":6432,"end":6432,"value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","start":6446,"end":6447,"value":{"raw":":","cooked":":"},"tail":false},{"type":"TemplateElement","start":6455,"end":6455,"value":{"raw":"","cooked":""},"tail":true}]}]}}]},"alternate":null}]}}]}},{"type":"ExpressionStatement","start":6478,"end":6559,"expression":{"type":"CallExpression","start":6478,"end":6559,"callee":{"type":"MemberExpression","start":6478,"end":6483,"object":{"type":"Identifier","start":6478,"end":6480,"name":"ws"},"property":{"type":"Identifier","start":6481,"end":6483,"name":"on"},"computed":false},"arguments":[{"type":"Literal","start":6484,"end":6491,"value":"close","raw":"'close'"},{"type":"ArrowFunctionExpression","start":6493,"end":6558,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":6499,"end":6558,"body":[{"type":"ExpressionStatement","start":6507,"end":6552,"expression":{"type":"CallExpression","start":6507,"end":6552,"callee":{"type":"MemberExpression","start":6507,"end":6531,"object":{"type":"CallExpression","start":6507,"end":6516,"callee":{"type":"Identifier","start":6507,"end":6514,"name":"emitter"},"arguments":[]},"property":{"type":"Identifier","start":6517,"end":6531,"name":"removeListener"},"computed":false},"arguments":[{"type":"Identifier","start":6532,"end":6537,"name":"token"},{"type":"Identifier","start":6539,"end":6551,"name":"sendProgress"}]}}]}}]}}]}}]}}]}}}},{"type":"VariableDeclaration","start":6665,"end":7488,"declarations":[{"type":"VariableDeclarator","start":6671,"end":7488,"id":{"type":"Identifier","start":6671,"end":6698,"name":"interceptGrantErrorResponse"},"init":{"type":"CallExpression","start":6701,"end":7488,"callee":{"type":"Identifier","start":6701,"end":6712,"name":"interceptor"},"arguments":[{"type":"ArrowFunctionExpression","start":6713,"end":7487,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":6714,"end":6717,"name":"req"},{"type":"Identifier","start":6719,"end":6722,"name":"res"}],"body":{"type":"BlockStatement","start":6727,"end":7487,"body":[{"type":"ReturnStatement","start":6731,"end":7485,"argument":{"type":"ObjectExpression","start":6738,"end":7485,"properties":[{"type":"Property","start":6744,"end":6868,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6744,"end":6759,"name":"isInterceptable"},"value":{"type":"ArrowFunctionExpression","start":6761,"end":6868,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":6767,"end":6868,"body":[{"type":"ReturnStatement","start":6813,"end":6862,"argument":{"type":"CallExpression","start":6820,"end":6862,"callee":{"type":"MemberExpression","start":6820,"end":6852,"object":{"type":"Literal","start":6820,"end":6847,"value":{},"raw":"/^\\/connect\\/\\w+\\/callback/","regex":{"pattern":"^\\/connect\\/\\w+\\/callback","flags":""}},"property":{"type":"Identifier","start":6848,"end":6852,"name":"test"},"computed":false},"arguments":[{"type":"MemberExpression","start":6853,"end":6861,"object":{"type":"Identifier","start":6853,"end":6856,"name":"req"},"property":{"type":"Identifier","start":6857,"end":6861,"name":"path"},"computed":false}]}}]}},"kind":"init"},{"type":"Property","start":6874,"end":7481,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6874,"end":6883,"name":"intercept"},"value":{"type":"ArrowFunctionExpression","start":6885,"end":7481,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":6886,"end":6890,"name":"body"},{"type":"Identifier","start":6892,"end":6896,"name":"send"}],"body":{"type":"BlockStatement","start":6901,"end":7481,"body":[{"type":"VariableDeclaration","start":6909,"end":6998,"declarations":[{"type":"VariableDeclarator","start":6915,"end":6998,"id":{"type":"Identifier","start":6915,"end":6927,"name":"unwantedBody"},"init":{"type":"Literal","start":6930,"end":6998,"value":"error=Grant%3A%20missing%20session%20or%20misconfigured%20provider","raw":"'error=Grant%3A%20missing%20session%20or%20misconfigured%20provider'"}}],"kind":"const"},{"type":"IfStatement","start":7005,"end":7475,"test":{"type":"BinaryExpression","start":7009,"end":7030,"left":{"type":"Identifier","start":7009,"end":7013,"name":"body"},"operator":"===","right":{"type":"Identifier","start":7018,"end":7030,"name":"unwantedBody"}},"consequent":{"type":"BlockStatement","start":7032,"end":7441,"body":[{"type":"ExpressionStatement","start":7042,"end":7125,"expression":{"type":"CallExpression","start":7042,"end":7125,"callee":{"type":"MemberExpression","start":7042,"end":7054,"object":{"type":"Identifier","start":7042,"end":7048,"name":"logger"},"property":{"type":"Identifier","start":7049,"end":7054,"name":"error"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":7055,"end":7095,"expressions":[{"type":"Identifier","start":7089,"end":7093,"name":"body"}],"quasis":[{"type":"TemplateElement","start":7056,"end":7087,"value":{"raw":"grant.js responded with error: ","cooked":"grant.js responded with error: "},"tail":false},{"type":"TemplateElement","start":7094,"end":7094,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":7097,"end":7116,"value":"grant.oauth.error","raw":"'grant.oauth.error'"},{"type":"MemberExpression","start":7118,"end":7124,"object":{"type":"Identifier","start":7118,"end":7121,"name":"req"},"property":{"type":"Identifier","start":7122,"end":7124,"name":"id"},"computed":false}]}},{"type":"ExpressionStatement","start":7134,"end":7171,"expression":{"type":"CallExpression","start":7134,"end":7171,"callee":{"type":"MemberExpression","start":7134,"end":7141,"object":{"type":"Identifier","start":7134,"end":7137,"name":"res"},"property":{"type":"Identifier","start":7138,"end":7141,"name":"set"},"computed":false},"arguments":[{"type":"Literal","start":7142,"end":7156,"value":"Content-Type","raw":"'Content-Type'"},{"type":"Literal","start":7158,"end":7170,"value":"text/plain","raw":"'text/plain'"}]}},{"type":"VariableDeclaration","start":7180,"end":7233,"declarations":[{"type":"VariableDeclarator","start":7186,"end":7233,"id":{"type":"Identifier","start":7186,"end":7193,"name":"reqHint"},"init":{"type":"ConditionalExpression","start":7196,"end":7233,"test":{"type":"MemberExpression","start":7196,"end":7202,"object":{"type":"Identifier","start":7196,"end":7199,"name":"req"},"property":{"type":"Identifier","start":7200,"end":7202,"name":"id"},"computed":false},"consequent":{"type":"TemplateLiteral","start":7205,"end":7228,"expressions":[{"type":"MemberExpression","start":7220,"end":7226,"object":{"type":"Identifier","start":7220,"end":7223,"name":"req"},"property":{"type":"Identifier","start":7224,"end":7226,"name":"id"},"computed":false}],"quasis":[{"type":"TemplateElement","start":7206,"end":7218,"value":{"raw":"Request ID: ","cooked":"Request ID: "},"tail":false},{"type":"TemplateElement","start":7227,"end":7227,"value":{"raw":"","cooked":""},"tail":true}]},"alternate":{"type":"Literal","start":7231,"end":7233,"value":"","raw":"''"}}}],"kind":"const"},{"type":"ExpressionStatement","start":7242,"end":7433,"expression":{"type":"CallExpression","start":7242,"end":7433,"callee":{"type":"Identifier","start":7242,"end":7246,"name":"send"},"arguments":[{"type":"CallExpression","start":7247,"end":7432,"callee":{"type":"MemberExpression","start":7247,"end":7426,"object":{"type":"ArrayExpression","start":7247,"end":7421,"elements":[{"type":"Literal","start":7259,"end":7314,"value":"Companion was unable to complete the OAuth process :(","raw":"'Companion was unable to complete the OAuth process :('"},{"type":"Literal","start":7326,"end":7392,"value":"Error: User session is missing or the Provider was misconfigured","raw":"'Error: User session is missing or the Provider was misconfigured'"},{"type":"Identifier","start":7404,"end":7411,"name":"reqHint"}]},"property":{"type":"Identifier","start":7422,"end":7426,"name":"join"},"computed":false},"arguments":[{"type":"Literal","start":7427,"end":7431,"value":"\n","raw":"'\\n'"}]}]}}]},"alternate":{"type":"BlockStatement","start":7447,"end":7475,"body":[{"type":"ExpressionStatement","start":7457,"end":7467,"expression":{"type":"CallExpression","start":7457,"end":7467,"callee":{"type":"Identifier","start":7457,"end":7461,"name":"send"},"arguments":[{"type":"Identifier","start":7462,"end":7466,"name":"body"}]}}]}}]}},"kind":"init"}]}}]}}]}}],"kind":"const"},{"type":"VariableDeclaration","start":7528,"end":10063,"declarations":[{"type":"VariableDeclarator","start":7534,"end":10063,"id":{"type":"Identifier","start":7534,"end":7554,"name":"getOptionsMiddleware"},"init":{"type":"ArrowFunctionExpression","start":7557,"end":10063,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":7558,"end":7565,"name":"options"}],"body":{"type":"BlockStatement","start":7570,"end":10063,"body":[{"type":"VariableDeclaration","start":7574,"end":7593,"declarations":[{"type":"VariableDeclarator","start":7578,"end":7593,"id":{"type":"Identifier","start":7578,"end":7586,"name":"s3Client"},"init":{"type":"Literal","start":7589,"end":7593,"value":null,"raw":"null"}}],"kind":"let"},{"type":"IfStatement","start":7596,"end":9354,"test":{"type":"MemberExpression","start":7600,"end":7626,"object":{"type":"MemberExpression","start":7600,"end":7623,"object":{"type":"Identifier","start":7600,"end":7607,"name":"options"},"property":{"type":"Identifier","start":7608,"end":7623,"name":"providerOptions"},"computed":false},"property":{"type":"Identifier","start":7624,"end":7626,"name":"s3"},"computed":false},"consequent":{"type":"BlockStatement","start":7628,"end":9354,"body":[{"type":"VariableDeclaration","start":7634,"end":7674,"declarations":[{"type":"VariableDeclarator","start":7640,"end":7674,"id":{"type":"Identifier","start":7640,"end":7642,"name":"S3"},"init":{"type":"CallExpression","start":7645,"end":7674,"callee":{"type":"Identifier","start":7645,"end":7652,"name":"require"},"arguments":[{"type":"Literal","start":7653,"end":7673,"value":"aws-sdk/clients/s3","raw":"'aws-sdk/clients/s3'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":7679,"end":7709,"declarations":[{"type":"VariableDeclarator","start":7685,"end":7709,"id":{"type":"Identifier","start":7685,"end":7688,"name":"AWS"},"init":{"type":"CallExpression","start":7691,"end":7709,"callee":{"type":"Identifier","start":7691,"end":7698,"name":"require"},"arguments":[{"type":"Literal","start":7699,"end":7708,"value":"aws-sdk","raw":"'aws-sdk'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":7714,"end":7766,"declarations":[{"type":"VariableDeclarator","start":7720,"end":7766,"id":{"type":"Identifier","start":7720,"end":7737,"name":"s3ProviderOptions"},"init":{"type":"MemberExpression","start":7740,"end":7766,"object":{"type":"MemberExpression","start":7740,"end":7763,"object":{"type":"Identifier","start":7740,"end":7747,"name":"options"},"property":{"type":"Identifier","start":7748,"end":7763,"name":"providerOptions"},"computed":false},"property":{"type":"Identifier","start":7764,"end":7766,"name":"s3"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":7772,"end":8145,"test":{"type":"LogicalExpression","start":7776,"end":7842,"left":{"type":"MemberExpression","start":7776,"end":7805,"object":{"type":"Identifier","start":7776,"end":7793,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":7794,"end":7805,"name":"accessKeyId"},"computed":false},"operator":"||","right":{"type":"MemberExpression","start":7809,"end":7842,"object":{"type":"Identifier","start":7809,"end":7826,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":7827,"end":7842,"name":"secretAccessKey"},"computed":false}},"consequent":{"type":"BlockStatement","start":7844,"end":8145,"body":[{"type":"ThrowStatement","start":7852,"end":8139,"argument":{"type":"NewExpression","start":7858,"end":8139,"callee":{"type":"Identifier","start":7862,"end":7867,"name":"Error"},"arguments":[{"type":"Literal","start":7868,"end":8138,"value":"Found `providerOptions.s3.accessKeyId` or `providerOptions.s3.secretAccessKey` configuration, but Companion requires `key` and `secret` option names instead. Please use the `key` property instead of `accessKeyId` and the `secret` property instead of `secretAccessKey`.","raw":"'Found `providerOptions.s3.accessKeyId` or `providerOptions.s3.secretAccessKey` configuration, but Companion requires `key` and `secret` option names instead. Please use the `key` property instead of `accessKeyId` and the `secret` property instead of `secretAccessKey`.'"}]}}]},"alternate":null},{"type":"VariableDeclaration","start":8151,"end":8210,"declarations":[{"type":"VariableDeclarator","start":8157,"end":8210,"id":{"type":"Identifier","start":8157,"end":8173,"name":"rawClientOptions"},"init":{"type":"MemberExpression","start":8176,"end":8210,"object":{"type":"Identifier","start":8176,"end":8193,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":8194,"end":8210,"name":"awsClientOptions"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":8215,"end":8568,"test":{"type":"LogicalExpression","start":8219,"end":8305,"left":{"type":"Identifier","start":8219,"end":8235,"name":"rawClientOptions"},"operator":"&&","right":{"type":"LogicalExpression","start":8240,"end":8304,"left":{"type":"MemberExpression","start":8240,"end":8268,"object":{"type":"Identifier","start":8240,"end":8256,"name":"rawClientOptions"},"property":{"type":"Identifier","start":8257,"end":8268,"name":"accessKeyId"},"computed":false},"operator":"||","right":{"type":"MemberExpression","start":8272,"end":8304,"object":{"type":"Identifier","start":8272,"end":8288,"name":"rawClientOptions"},"property":{"type":"Identifier","start":8289,"end":8304,"name":"secretAccessKey"},"computed":false}}},"consequent":{"type":"BlockStatement","start":8307,"end":8568,"body":[{"type":"ThrowStatement","start":8315,"end":8562,"argument":{"type":"NewExpression","start":8321,"end":8562,"callee":{"type":"Identifier","start":8325,"end":8330,"name":"Error"},"arguments":[{"type":"Literal","start":8331,"end":8561,"value":"Found unsupported `providerOptions.s3.awsClientOptions.accessKeyId` or `providerOptions.s3.awsClientOptions.secretAccessKey` configuration. Please use the `providerOptions.s3.key` and `providerOptions.s3.secret` options instead.","raw":"'Found unsupported `providerOptions.s3.awsClientOptions.accessKeyId` or `providerOptions.s3.awsClientOptions.secretAccessKey` configuration. Please use the `providerOptions.s3.key` and `providerOptions.s3.secret` options instead.'"}]}}]},"alternate":null},{"type":"VariableDeclaration","start":8574,"end":8847,"declarations":[{"type":"VariableDeclarator","start":8580,"end":8847,"id":{"type":"Identifier","start":8580,"end":8595,"name":"s3ClientOptions"},"init":{"type":"CallExpression","start":8598,"end":8847,"callee":{"type":"MemberExpression","start":8598,"end":8611,"object":{"type":"Identifier","start":8598,"end":8604,"name":"Object"},"property":{"type":"Identifier","start":8605,"end":8611,"name":"assign"},"computed":false},"arguments":[{"type":"ObjectExpression","start":8612,"end":8828,"properties":[{"type":"Property","start":8620,"end":8642,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8620,"end":8636,"name":"signatureVersion"},"value":{"type":"Literal","start":8638,"end":8642,"value":"v4","raw":"'v4'"},"kind":"init"},{"type":"Property","start":8650,"end":8686,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8650,"end":8658,"name":"endpoint"},"value":{"type":"MemberExpression","start":8660,"end":8686,"object":{"type":"Identifier","start":8660,"end":8677,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":8678,"end":8686,"name":"endpoint"},"computed":false},"kind":"init"},{"type":"Property","start":8694,"end":8726,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8694,"end":8700,"name":"region"},"value":{"type":"MemberExpression","start":8702,"end":8726,"object":{"type":"Identifier","start":8702,"end":8719,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":8720,"end":8726,"name":"region"},"computed":false},"kind":"init"},{"type":"Property","start":8760,"end":8822,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8760,"end":8781,"name":"useAccelerateEndpoint"},"value":{"type":"MemberExpression","start":8783,"end":8822,"object":{"type":"Identifier","start":8783,"end":8800,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":8801,"end":8822,"name":"useAccelerateEndpoint"},"computed":false},"kind":"init"}]},{"type":"Identifier","start":8830,"end":8846,"name":"rawClientOptions"}]}}],"kind":"const"},{"type":"IfStatement","start":9055,"end":9311,"test":{"type":"LogicalExpression","start":9059,"end":9140,"left":{"type":"LogicalExpression","start":9059,"end":9108,"left":{"type":"MemberExpression","start":9059,"end":9080,"object":{"type":"Identifier","start":9059,"end":9076,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":9077,"end":9080,"name":"key"},"computed":false},"operator":"&&","right":{"type":"MemberExpression","start":9084,"end":9108,"object":{"type":"Identifier","start":9084,"end":9101,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":9102,"end":9108,"name":"secret"},"computed":false}},"operator":"&&","right":{"type":"UnaryExpression","start":9112,"end":9140,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":9113,"end":9140,"object":{"type":"Identifier","start":9113,"end":9128,"name":"s3ClientOptions"},"property":{"type":"Identifier","start":9129,"end":9140,"name":"credentials"},"computed":false}}},"consequent":{"type":"BlockStatement","start":9142,"end":9311,"body":[{"type":"ExpressionStatement","start":9150,"end":9305,"expression":{"type":"AssignmentExpression","start":9150,"end":9305,"operator":"=","left":{"type":"MemberExpression","start":9150,"end":9177,"object":{"type":"Identifier","start":9150,"end":9165,"name":"s3ClientOptions"},"property":{"type":"Identifier","start":9166,"end":9177,"name":"credentials"},"computed":false},"right":{"type":"NewExpression","start":9180,"end":9305,"callee":{"type":"MemberExpression","start":9184,"end":9199,"object":{"type":"Identifier","start":9184,"end":9187,"name":"AWS"},"property":{"type":"Identifier","start":9188,"end":9199,"name":"Credentials"},"computed":false},"arguments":[{"type":"MemberExpression","start":9209,"end":9230,"object":{"type":"Identifier","start":9209,"end":9226,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":9227,"end":9230,"name":"key"},"computed":false},{"type":"MemberExpression","start":9240,"end":9264,"object":{"type":"Identifier","start":9240,"end":9257,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":9258,"end":9264,"name":"secret"},"computed":false},{"type":"MemberExpression","start":9274,"end":9304,"object":{"type":"Identifier","start":9274,"end":9291,"name":"s3ProviderOptions"},"property":{"type":"Identifier","start":9292,"end":9304,"name":"sessionToken"},"computed":false}]}}}]},"alternate":null},{"type":"ExpressionStatement","start":9316,"end":9350,"expression":{"type":"AssignmentExpression","start":9316,"end":9350,"operator":"=","left":{"type":"Identifier","start":9316,"end":9324,"name":"s3Client"},"right":{"type":"NewExpression","start":9327,"end":9350,"callee":{"type":"Identifier","start":9331,"end":9333,"name":"S3"},"arguments":[{"type":"Identifier","start":9334,"end":9349,"name":"s3ClientOptions"}]}}}]},"alternate":null},{"type":"VariableDeclaration","start":9448,"end":10040,"declarations":[{"type":"VariableDeclarator","start":9454,"end":10040,"id":{"type":"Identifier","start":9454,"end":9464,"name":"middleware"},"init":{"type":"ArrowFunctionExpression","start":9467,"end":10040,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":9468,"end":9471,"name":"req"},{"type":"Identifier","start":9473,"end":9476,"name":"res"},{"type":"Identifier","start":9478,"end":9482,"name":"next"}],"body":{"type":"BlockStatement","start":9487,"end":10040,"body":[{"type":"VariableDeclaration","start":9493,"end":9592,"declarations":[{"type":"VariableDeclarator","start":9499,"end":9592,"id":{"type":"Identifier","start":9499,"end":9515,"name":"versionFromQuery"},"init":{"type":"ConditionalExpression","start":9518,"end":9592,"test":{"type":"MemberExpression","start":9518,"end":9540,"object":{"type":"MemberExpression","start":9518,"end":9527,"object":{"type":"Identifier","start":9518,"end":9521,"name":"req"},"property":{"type":"Identifier","start":9522,"end":9527,"name":"query"},"computed":false},"property":{"type":"Identifier","start":9528,"end":9540,"name":"uppyVersions"},"computed":false},"consequent":{"type":"CallExpression","start":9543,"end":9585,"callee":{"type":"Identifier","start":9543,"end":9561,"name":"decodeURIComponent"},"arguments":[{"type":"MemberExpression","start":9562,"end":9584,"object":{"type":"MemberExpression","start":9562,"end":9571,"object":{"type":"Identifier","start":9562,"end":9565,"name":"req"},"property":{"type":"Identifier","start":9566,"end":9571,"name":"query"},"computed":false},"property":{"type":"Identifier","start":9572,"end":9584,"name":"uppyVersions"},"computed":false}]},"alternate":{"type":"Literal","start":9588,"end":9592,"value":null,"raw":"null"}}}],"kind":"const"},{"type":"ExpressionStatement","start":9597,"end":9846,"expression":{"type":"AssignmentExpression","start":9597,"end":9846,"operator":"=","left":{"type":"MemberExpression","start":9597,"end":9610,"object":{"type":"Identifier","start":9597,"end":9600,"name":"req"},"property":{"type":"Identifier","start":9601,"end":9610,"name":"companion"},"computed":false},"right":{"type":"ObjectExpression","start":9613,"end":9846,"properties":[{"type":"Property","start":9621,"end":9628,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":9621,"end":9628,"name":"options"},"kind":"init","value":{"type":"Identifier","start":9621,"end":9628,"name":"options"}},{"type":"Property","start":9636,"end":9644,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":9636,"end":9644,"name":"s3Client"},"kind":"init","value":{"type":"Identifier","start":9636,"end":9644,"name":"s3Client"}},{"type":"Property","start":9652,"end":9719,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9652,"end":9661,"name":"authToken"},"value":{"type":"LogicalExpression","start":9663,"end":9719,"left":{"type":"CallExpression","start":9663,"end":9692,"callee":{"type":"MemberExpression","start":9663,"end":9673,"object":{"type":"Identifier","start":9663,"end":9666,"name":"req"},"property":{"type":"Identifier","start":9667,"end":9673,"name":"header"},"computed":false},"arguments":[{"type":"Literal","start":9674,"end":9691,"value":"uppy-auth-token","raw":"'uppy-auth-token'"}]},"operator":"||","right":{"type":"MemberExpression","start":9696,"end":9719,"object":{"type":"MemberExpression","start":9696,"end":9705,"object":{"type":"Identifier","start":9696,"end":9699,"name":"req"},"property":{"type":"Identifier","start":9700,"end":9705,"name":"query"},"computed":false},"property":{"type":"Identifier","start":9706,"end":9719,"name":"uppyAuthToken"},"computed":false}},"kind":"init"},{"type":"Property","start":9727,"end":9800,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9727,"end":9740,"name":"clientVersion"},"value":{"type":"LogicalExpression","start":9742,"end":9800,"left":{"type":"LogicalExpression","start":9742,"end":9789,"left":{"type":"CallExpression","start":9742,"end":9769,"callee":{"type":"MemberExpression","start":9742,"end":9752,"object":{"type":"Identifier","start":9742,"end":9745,"name":"req"},"property":{"type":"Identifier","start":9746,"end":9752,"name":"header"},"computed":false},"arguments":[{"type":"Literal","start":9753,"end":9768,"value":"uppy-versions","raw":"'uppy-versions'"}]},"operator":"||","right":{"type":"Identifier","start":9773,"end":9789,"name":"versionFromQuery"}},"operator":"||","right":{"type":"Literal","start":9793,"end":9800,"value":"1.0.0","raw":"'1.0.0'"}},"kind":"init"},{"type":"Property","start":9808,"end":9840,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9808,"end":9816,"name":"buildURL"},"value":{"type":"CallExpression","start":9818,"end":9840,"callee":{"type":"Identifier","start":9818,"end":9831,"name":"getURLBuilder"},"arguments":[{"type":"Identifier","start":9832,"end":9839,"name":"options"}]},"kind":"init"}]}}},{"type":"ExpressionStatement","start":9852,"end":9945,"expression":{"type":"CallExpression","start":9852,"end":9945,"callee":{"type":"MemberExpression","start":9852,"end":9863,"object":{"type":"Identifier","start":9852,"end":9858,"name":"logger"},"property":{"type":"Identifier","start":9859,"end":9863,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":9864,"end":9916,"expressions":[{"type":"MemberExpression","start":9887,"end":9914,"object":{"type":"MemberExpression","start":9887,"end":9900,"object":{"type":"Identifier","start":9887,"end":9890,"name":"req"},"property":{"type":"Identifier","start":9891,"end":9900,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":9901,"end":9914,"name":"clientVersion"},"computed":false}],"quasis":[{"type":"TemplateElement","start":9865,"end":9885,"value":{"raw":"uppy client version ","cooked":"uppy client version "},"tail":false},{"type":"TemplateElement","start":9915,"end":9915,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":9918,"end":9944,"value":"companion.client.version","raw":"'companion.client.version'"}]}},{"type":"ExpressionStatement","start":10001,"end":10025,"expression":{"type":"AssignmentExpression","start":10001,"end":10025,"operator":"=","left":{"type":"MemberExpression","start":10001,"end":10009,"object":{"type":"Identifier","start":10001,"end":10004,"name":"req"},"property":{"type":"Identifier","start":10005,"end":10009,"name":"uppy"},"computed":false},"right":{"type":"MemberExpression","start":10012,"end":10025,"object":{"type":"Identifier","start":10012,"end":10015,"name":"req"},"property":{"type":"Identifier","start":10016,"end":10025,"name":"companion"},"computed":false}}},{"type":"ExpressionStatement","start":10030,"end":10036,"expression":{"type":"CallExpression","start":10030,"end":10036,"callee":{"type":"Identifier","start":10030,"end":10034,"name":"next"},"arguments":[]}}]}}}],"kind":"const"},{"type":"ReturnStatement","start":10044,"end":10061,"argument":{"type":"Identifier","start":10051,"end":10061,"name":"middleware"}}]}}}],"kind":"const"},{"type":"VariableDeclaration","start":10218,"end":10795,"declarations":[{"type":"VariableDeclarator","start":10224,"end":10795,"id":{"type":"Identifier","start":10224,"end":10234,"name":"maskLogger"},"init":{"type":"ArrowFunctionExpression","start":10237,"end":10795,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":10238,"end":10254,"name":"companionOptions"}],"body":{"type":"BlockStatement","start":10259,"end":10795,"body":[{"type":"VariableDeclaration","start":10263,"end":10281,"declarations":[{"type":"VariableDeclarator","start":10269,"end":10281,"id":{"type":"Identifier","start":10269,"end":10276,"name":"secrets"},"init":{"type":"ArrayExpression","start":10279,"end":10281,"elements":[]}}],"kind":"const"},{"type":"VariableDeclaration","start":10284,"end":10345,"declarations":[{"type":"VariableDeclarator","start":10290,"end":10345,"id":{"type":"ObjectPattern","start":10290,"end":10326,"properties":[{"type":"Property","start":10292,"end":10307,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":10292,"end":10307,"name":"providerOptions"},"kind":"init","value":{"type":"Identifier","start":10292,"end":10307,"name":"providerOptions"}},{"type":"Property","start":10309,"end":10324,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":10309,"end":10324,"name":"customProviders"},"kind":"init","value":{"type":"Identifier","start":10309,"end":10324,"name":"customProviders"}}]},"init":{"type":"Identifier","start":10329,"end":10345,"name":"companionOptions"}}],"kind":"const"},{"type":"ExpressionStatement","start":10348,"end":10508,"expression":{"type":"CallExpression","start":10348,"end":10508,"callee":{"type":"MemberExpression","start":10348,"end":10384,"object":{"type":"CallExpression","start":10348,"end":10376,"callee":{"type":"MemberExpression","start":10348,"end":10359,"object":{"type":"Identifier","start":10348,"end":10354,"name":"Object"},"property":{"type":"Identifier","start":10355,"end":10359,"name":"keys"},"computed":false},"arguments":[{"type":"Identifier","start":10360,"end":10375,"name":"providerOptions"}]},"property":{"type":"Identifier","start":10377,"end":10384,"name":"forEach"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":10385,"end":10507,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":10386,"end":10394,"name":"provider"}],"body":{"type":"BlockStatement","start":10399,"end":10507,"body":[{"type":"IfStatement","start":10405,"end":10503,"test":{"type":"MemberExpression","start":10409,"end":10441,"object":{"type":"MemberExpression","start":10409,"end":10434,"object":{"type":"Identifier","start":10409,"end":10424,"name":"providerOptions"},"property":{"type":"Identifier","start":10425,"end":10433,"name":"provider"},"computed":true},"property":{"type":"Identifier","start":10435,"end":10441,"name":"secret"},"computed":false},"consequent":{"type":"BlockStatement","start":10443,"end":10503,"body":[{"type":"ExpressionStatement","start":10451,"end":10497,"expression":{"type":"CallExpression","start":10451,"end":10497,"callee":{"type":"MemberExpression","start":10451,"end":10463,"object":{"type":"Identifier","start":10451,"end":10458,"name":"secrets"},"property":{"type":"Identifier","start":10459,"end":10463,"name":"push"},"computed":false},"arguments":[{"type":"MemberExpression","start":10464,"end":10496,"object":{"type":"MemberExpression","start":10464,"end":10489,"object":{"type":"Identifier","start":10464,"end":10479,"name":"providerOptions"},"property":{"type":"Identifier","start":10480,"end":10488,"name":"provider"},"computed":true},"property":{"type":"Identifier","start":10490,"end":10496,"name":"secret"},"computed":false}]}}]},"alternate":null}]}}]}},{"type":"IfStatement","start":10512,"end":10761,"test":{"type":"Identifier","start":10516,"end":10531,"name":"customProviders"},"consequent":{"type":"BlockStatement","start":10533,"end":10761,"body":[{"type":"ExpressionStatement","start":10539,"end":10757,"expression":{"type":"CallExpression","start":10539,"end":10757,"callee":{"type":"MemberExpression","start":10539,"end":10575,"object":{"type":"CallExpression","start":10539,"end":10567,"callee":{"type":"MemberExpression","start":10539,"end":10550,"object":{"type":"Identifier","start":10539,"end":10545,"name":"Object"},"property":{"type":"Identifier","start":10546,"end":10550,"name":"keys"},"computed":false},"arguments":[{"type":"Identifier","start":10551,"end":10566,"name":"customProviders"}]},"property":{"type":"Identifier","start":10568,"end":10575,"name":"forEach"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":10576,"end":10756,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":10577,"end":10585,"name":"provider"}],"body":{"type":"BlockStatement","start":10590,"end":10756,"body":[{"type":"IfStatement","start":10598,"end":10750,"test":{"type":"LogicalExpression","start":10602,"end":10677,"left":{"type":"MemberExpression","start":10602,"end":10634,"object":{"type":"MemberExpression","start":10602,"end":10627,"object":{"type":"Identifier","start":10602,"end":10617,"name":"customProviders"},"property":{"type":"Identifier","start":10618,"end":10626,"name":"provider"},"computed":true},"property":{"type":"Identifier","start":10628,"end":10634,"name":"config"},"computed":false},"operator":"&&","right":{"type":"MemberExpression","start":10638,"end":10677,"object":{"type":"MemberExpression","start":10638,"end":10670,"object":{"type":"MemberExpression","start":10638,"end":10663,"object":{"type":"Identifier","start":10638,"end":10653,"name":"customProviders"},"property":{"type":"Identifier","start":10654,"end":10662,"name":"provider"},"computed":true},"property":{"type":"Identifier","start":10664,"end":10670,"name":"config"},"computed":false},"property":{"type":"Identifier","start":10671,"end":10677,"name":"secret"},"computed":false}},"consequent":{"type":"BlockStatement","start":10679,"end":10750,"body":[{"type":"ExpressionStatement","start":10689,"end":10742,"expression":{"type":"CallExpression","start":10689,"end":10742,"callee":{"type":"MemberExpression","start":10689,"end":10701,"object":{"type":"Identifier","start":10689,"end":10696,"name":"secrets"},"property":{"type":"Identifier","start":10697,"end":10701,"name":"push"},"computed":false},"arguments":[{"type":"MemberExpression","start":10702,"end":10741,"object":{"type":"MemberExpression","start":10702,"end":10734,"object":{"type":"MemberExpression","start":10702,"end":10727,"object":{"type":"Identifier","start":10702,"end":10717,"name":"customProviders"},"property":{"type":"Identifier","start":10718,"end":10726,"name":"provider"},"computed":true},"property":{"type":"Identifier","start":10728,"end":10734,"name":"config"},"computed":false},"property":{"type":"Identifier","start":10735,"end":10741,"name":"secret"},"computed":false}]}}]},"alternate":null}]}}]}}]},"alternate":null},{"type":"ExpressionStatement","start":10765,"end":10793,"expression":{"type":"CallExpression","start":10765,"end":10793,"callee":{"type":"MemberExpression","start":10765,"end":10784,"object":{"type":"Identifier","start":10765,"end":10771,"name":"logger"},"property":{"type":"Identifier","start":10772,"end":10784,"name":"setMaskables"},"computed":false},"arguments":[{"type":"Identifier","start":10785,"end":10792,"name":"secrets"}]}}]}}}],"kind":"const"},{"type":"VariableDeclaration","start":11025,"end":11940,"declarations":[{"type":"VariableDeclarator","start":11031,"end":11940,"id":{"type":"Identifier","start":11031,"end":11045,"name":"validateConfig"},"init":{"type":"ArrowFunctionExpression","start":11048,"end":11940,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":11049,"end":11065,"name":"companionOptions"}],"body":{"type":"BlockStatement","start":11070,"end":11940,"body":[{"type":"VariableDeclaration","start":11074,"end":11136,"declarations":[{"type":"VariableDeclarator","start":11080,"end":11136,"id":{"type":"Identifier","start":11080,"end":11096,"name":"mandatoryOptions"},"init":{"type":"ArrayExpression","start":11099,"end":11136,"elements":[{"type":"Literal","start":11100,"end":11108,"value":"secret","raw":"'secret'"},{"type":"Literal","start":11110,"end":11120,"value":"filePath","raw":"'filePath'"},{"type":"Literal","start":11122,"end":11135,"value":"server.host","raw":"'server.host'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":11165,"end":11187,"declarations":[{"type":"VariableDeclarator","start":11171,"end":11187,"id":{"type":"Identifier","start":11171,"end":11182,"name":"unspecified"},"init":{"type":"ArrayExpression","start":11185,"end":11187,"elements":[]}}],"kind":"const"},{"type":"ExpressionStatement","start":11191,"end":11376,"expression":{"type":"CallExpression","start":11191,"end":11376,"callee":{"type":"MemberExpression","start":11191,"end":11215,"object":{"type":"Identifier","start":11191,"end":11207,"name":"mandatoryOptions"},"property":{"type":"Identifier","start":11208,"end":11215,"name":"forEach"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":11216,"end":11375,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":11217,"end":11218,"name":"i"}],"body":{"type":"BlockStatement","start":11223,"end":11375,"body":[{"type":"VariableDeclaration","start":11229,"end":11327,"declarations":[{"type":"VariableDeclarator","start":11235,"end":11327,"id":{"type":"Identifier","start":11235,"end":11240,"name":"value"},"init":{"type":"CallExpression","start":11243,"end":11327,"callee":{"type":"MemberExpression","start":11243,"end":11262,"object":{"type":"CallExpression","start":11243,"end":11255,"callee":{"type":"MemberExpression","start":11243,"end":11250,"object":{"type":"Identifier","start":11243,"end":11244,"name":"i"},"property":{"type":"Identifier","start":11245,"end":11250,"name":"split"},"computed":false},"arguments":[{"type":"Literal","start":11251,"end":11254,"value":".","raw":"'.'"}]},"property":{"type":"Identifier","start":11256,"end":11262,"name":"reduce"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":11263,"end":11308,"id":null,"expression":true,"generator":false,"async":false,"params":[{"type":"Identifier","start":11264,"end":11268,"name":"prev"},{"type":"Identifier","start":11270,"end":11274,"name":"curr"}],"body":{"type":"ConditionalExpression","start":11279,"end":11308,"test":{"type":"Identifier","start":11279,"end":11283,"name":"prev"},"consequent":{"type":"MemberExpression","start":11286,"end":11296,"object":{"type":"Identifier","start":11286,"end":11290,"name":"prev"},"property":{"type":"Identifier","start":11291,"end":11295,"name":"curr"},"computed":true},"alternate":{"type":"Identifier","start":11299,"end":11308,"name":"undefined"}}},{"type":"Identifier","start":11310,"end":11326,"name":"companionOptions"}]}}],"kind":"const"},{"type":"IfStatement","start":11333,"end":11371,"test":{"type":"UnaryExpression","start":11337,"end":11343,"operator":"!","prefix":true,"argument":{"type":"Identifier","start":11338,"end":11343,"name":"value"}},"consequent":{"type":"ExpressionStatement","start":11345,"end":11371,"expression":{"type":"CallExpression","start":11345,"end":11371,"callee":{"type":"MemberExpression","start":11345,"end":11361,"object":{"type":"Identifier","start":11345,"end":11356,"name":"unspecified"},"property":{"type":"Identifier","start":11357,"end":11361,"name":"push"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":11362,"end":11370,"expressions":[{"type":"Identifier","start":11366,"end":11367,"name":"i"}],"quasis":[{"type":"TemplateElement","start":11363,"end":11364,"value":{"raw":"\"","cooked":"\""},"tail":false},{"type":"TemplateElement","start":11368,"end":11369,"value":{"raw":"\"","cooked":"\""},"tail":true}]}]}},"alternate":null}]}}]}},{"type":"IfStatement","start":11431,"end":11611,"test":{"type":"MemberExpression","start":11435,"end":11453,"object":{"type":"Identifier","start":11435,"end":11446,"name":"unspecified"},"property":{"type":"Identifier","start":11447,"end":11453,"name":"length"},"computed":false},"consequent":{"type":"BlockStatement","start":11455,"end":11611,"body":[{"type":"VariableDeclaration","start":11461,"end":11539,"declarations":[{"type":"VariableDeclarator","start":11467,"end":11539,"id":{"type":"Identifier","start":11467,"end":11480,"name":"messagePrefix"},"init":{"type":"Literal","start":11483,"end":11539,"value":"Please specify the following options to use companion:","raw":"'Please specify the following options to use companion:'"}}],"kind":"const"},{"type":"ThrowStatement","start":11544,"end":11607,"argument":{"type":"NewExpression","start":11550,"end":11607,"callee":{"type":"Identifier","start":11554,"end":11559,"name":"Error"},"arguments":[{"type":"TemplateLiteral","start":11560,"end":11606,"expressions":[{"type":"Identifier","start":11563,"end":11576,"name":"messagePrefix"},{"type":"CallExpression","start":11581,"end":11604,"callee":{"type":"MemberExpression","start":11581,"end":11597,"object":{"type":"Identifier","start":11581,"end":11592,"name":"unspecified"},"property":{"type":"Identifier","start":11593,"end":11597,"name":"join"},"computed":false},"arguments":[{"type":"Literal","start":11598,"end":11603,"value":",\n","raw":"',\\n'"}]}],"quasis":[{"type":"TemplateElement","start":11561,"end":11561,"value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","start":11577,"end":11579,"value":{"raw":"\\n","cooked":"\n"},"tail":false},{"type":"TemplateElement","start":11605,"end":11605,"value":{"raw":"","cooked":""},"tail":true}]}]}}]},"alternate":null},{"type":"TryStatement","start":11676,"end":11938,"block":{"type":"BlockStatement","start":11680,"end":11772,"body":[{"type":"ExpressionStatement","start":11704,"end":11768,"expression":{"type":"CallExpression","start":11704,"end":11768,"callee":{"type":"MemberExpression","start":11704,"end":11717,"object":{"type":"Identifier","start":11704,"end":11706,"name":"fs"},"property":{"type":"Identifier","start":11707,"end":11717,"name":"accessSync"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":11718,"end":11748,"expressions":[{"type":"MemberExpression","start":11721,"end":11746,"object":{"type":"Identifier","start":11721,"end":11737,"name":"companionOptions"},"property":{"type":"Identifier","start":11738,"end":11746,"name":"filePath"},"computed":false}],"quasis":[{"type":"TemplateElement","start":11719,"end":11719,"value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","start":11747,"end":11747,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"BinaryExpression","start":11750,"end":11767,"left":{"type":"MemberExpression","start":11750,"end":11757,"object":{"type":"Identifier","start":11750,"end":11752,"name":"fs"},"property":{"type":"Identifier","start":11753,"end":11757,"name":"R_OK"},"computed":false},"operator":"|","right":{"type":"MemberExpression","start":11760,"end":11767,"object":{"type":"Identifier","start":11760,"end":11762,"name":"fs"},"property":{"type":"Identifier","start":11763,"end":11767,"name":"W_OK"},"computed":false}}]}}]},"handler":{"type":"CatchClause","start":11773,"end":11938,"param":{"type":"Identifier","start":11780,"end":11783,"name":"err"},"body":{"type":"BlockStatement","start":11785,"end":11938,"body":[{"type":"ThrowStatement","start":11791,"end":11934,"argument":{"type":"NewExpression","start":11797,"end":11934,"callee":{"type":"Identifier","start":11801,"end":11806,"name":"Error"},"arguments":[{"type":"TemplateLiteral","start":11814,"end":11928,"expressions":[{"type":"MemberExpression","start":11831,"end":11856,"object":{"type":"Identifier","start":11831,"end":11847,"name":"companionOptions"},"property":{"type":"Identifier","start":11848,"end":11856,"name":"filePath"},"computed":false}],"quasis":[{"type":"TemplateElement","start":11815,"end":11829,"value":{"raw":"No access to \"","cooked":"No access to \""},"tail":false},{"type":"TemplateElement","start":11857,"end":11927,"value":{"raw":"\". Please ensure the directory exists and with read/write permissions.","cooked":"\". Please ensure the directory exists and with read/write permissions."},"tail":true}]}]}}]}},"finalizer":null}]}}}],"kind":"const"}],"sourceType":"script"}