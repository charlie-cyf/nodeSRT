{"type":"Program","start":0,"end":1986,"body":[{"type":"VariableDeclaration","start":0,"end":41,"declarations":[{"type":"VariableDeclarator","start":6,"end":41,"id":{"type":"Identifier","start":6,"end":14,"name":"schedule"},"init":{"type":"CallExpression","start":17,"end":41,"callee":{"type":"Identifier","start":17,"end":24,"name":"require"},"arguments":[{"type":"Literal","start":25,"end":40,"value":"node-schedule","raw":"'node-schedule'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":42,"end":92,"declarations":[{"type":"VariableDeclarator","start":48,"end":92,"id":{"type":"ObjectPattern","start":48,"end":68,"properties":[{"type":"Property","start":50,"end":66,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":50,"end":66,"name":"FILE_NAME_PREFIX"},"kind":"init","value":{"type":"Identifier","start":50,"end":66,"name":"FILE_NAME_PREFIX"}}]},"init":{"type":"CallExpression","start":71,"end":92,"callee":{"type":"Identifier","start":71,"end":78,"name":"require"},"arguments":[{"type":"Literal","start":79,"end":91,"value":"./Uploader","raw":"'./Uploader'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":93,"end":117,"declarations":[{"type":"VariableDeclarator","start":99,"end":117,"id":{"type":"Identifier","start":99,"end":101,"name":"fs"},"init":{"type":"CallExpression","start":104,"end":117,"callee":{"type":"Identifier","start":104,"end":111,"name":"require"},"arguments":[{"type":"Literal","start":112,"end":116,"value":"fs","raw":"'fs'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":118,"end":146,"declarations":[{"type":"VariableDeclarator","start":124,"end":146,"id":{"type":"Identifier","start":124,"end":128,"name":"path"},"init":{"type":"CallExpression","start":131,"end":146,"callee":{"type":"Identifier","start":131,"end":138,"name":"require"},"arguments":[{"type":"Literal","start":139,"end":145,"value":"path","raw":"'path'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":147,"end":181,"declarations":[{"type":"VariableDeclarator","start":153,"end":181,"id":{"type":"Identifier","start":153,"end":159,"name":"logger"},"init":{"type":"CallExpression","start":162,"end":181,"callee":{"type":"Identifier","start":162,"end":169,"name":"require"},"arguments":[{"type":"Literal","start":170,"end":180,"value":"./logger","raw":"'./logger'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":340,"end":539,"expression":{"type":"AssignmentExpression","start":340,"end":539,"operator":"=","left":{"type":"MemberExpression","start":340,"end":363,"object":{"type":"Identifier","start":340,"end":347,"name":"exports"},"property":{"type":"Identifier","start":348,"end":363,"name":"startCleanUpJob"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":366,"end":539,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":367,"end":374,"name":"dirPath"}],"body":{"type":"BlockStatement","start":379,"end":539,"body":[{"type":"ExpressionStatement","start":383,"end":441,"expression":{"type":"CallExpression","start":383,"end":441,"callee":{"type":"MemberExpression","start":383,"end":394,"object":{"type":"Identifier","start":383,"end":389,"name":"logger"},"property":{"type":"Identifier","start":390,"end":394,"name":"info"},"computed":false},"arguments":[{"type":"Literal","start":395,"end":418,"value":"starting clean up job","raw":"'starting clean up job'"},{"type":"Literal","start":420,"end":440,"value":"jobs.cleanup.start","raw":"'jobs.cleanup.start'"}]}},{"type":"ExpressionStatement","start":464,"end":537,"expression":{"type":"CallExpression","start":464,"end":537,"callee":{"type":"MemberExpression","start":464,"end":484,"object":{"type":"Identifier","start":464,"end":472,"name":"schedule"},"property":{"type":"Identifier","start":473,"end":484,"name":"scheduleJob"},"computed":false},"arguments":[{"type":"Literal","start":485,"end":497,"value":"0 23 * * *","raw":"'0 23 * * *'"},{"type":"ArrowFunctionExpression","start":499,"end":536,"id":null,"expression":true,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","start":505,"end":536,"callee":{"type":"Identifier","start":505,"end":527,"name":"cleanUpFinishedUploads"},"arguments":[{"type":"Identifier","start":528,"end":535,"name":"dirPath"}]}}]}}]}}}},{"type":"VariableDeclaration","start":541,"end":1985,"declarations":[{"type":"VariableDeclarator","start":547,"end":1985,"id":{"type":"Identifier","start":547,"end":569,"name":"cleanUpFinishedUploads"},"init":{"type":"ArrowFunctionExpression","start":572,"end":1985,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":573,"end":580,"name":"dirPath"}],"body":{"type":"BlockStatement","start":585,"end":1985,"body":[{"type":"ExpressionStatement","start":589,"end":675,"expression":{"type":"CallExpression","start":589,"end":675,"callee":{"type":"MemberExpression","start":589,"end":600,"object":{"type":"Identifier","start":589,"end":595,"name":"logger"},"property":{"type":"Identifier","start":596,"end":600,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":601,"end":644,"expressions":[{"type":"Identifier","start":635,"end":642,"name":"dirPath"}],"quasis":[{"type":"TemplateElement","start":602,"end":633,"value":{"raw":"running clean up job for path: ","cooked":"running clean up job for path: "},"tail":false},{"type":"TemplateElement","start":643,"end":643,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":646,"end":674,"value":"jobs.cleanup.progress.read","raw":"'jobs.cleanup.progress.read'"}]}},{"type":"ExpressionStatement","start":678,"end":1983,"expression":{"type":"CallExpression","start":678,"end":1983,"callee":{"type":"MemberExpression","start":678,"end":688,"object":{"type":"Identifier","start":678,"end":680,"name":"fs"},"property":{"type":"Identifier","start":681,"end":688,"name":"readdir"},"computed":false},"arguments":[{"type":"Identifier","start":689,"end":696,"name":"dirPath"},{"type":"ArrowFunctionExpression","start":698,"end":1982,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":699,"end":702,"name":"err"},{"type":"Identifier","start":704,"end":709,"name":"files"}],"body":{"type":"BlockStatement","start":714,"end":1982,"body":[{"type":"IfStatement","start":720,"end":800,"test":{"type":"Identifier","start":724,"end":727,"name":"err"},"consequent":{"type":"BlockStatement","start":729,"end":800,"body":[{"type":"ExpressionStatement","start":737,"end":781,"expression":{"type":"CallExpression","start":737,"end":781,"callee":{"type":"MemberExpression","start":737,"end":749,"object":{"type":"Identifier","start":737,"end":743,"name":"logger"},"property":{"type":"Identifier","start":744,"end":749,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":750,"end":753,"name":"err"},{"type":"Literal","start":755,"end":780,"value":"jobs.cleanup.read.error","raw":"'jobs.cleanup.read.error'"}]}},{"type":"ReturnStatement","start":788,"end":794,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":806,"end":870,"expression":{"type":"CallExpression","start":806,"end":870,"callee":{"type":"MemberExpression","start":806,"end":817,"object":{"type":"Identifier","start":806,"end":812,"name":"logger"},"property":{"type":"Identifier","start":813,"end":817,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":818,"end":847,"expressions":[{"type":"MemberExpression","start":827,"end":839,"object":{"type":"Identifier","start":827,"end":832,"name":"files"},"property":{"type":"Identifier","start":833,"end":839,"name":"length"},"computed":false}],"quasis":[{"type":"TemplateElement","start":819,"end":825,"value":{"raw":"found ","cooked":"found "},"tail":false},{"type":"TemplateElement","start":840,"end":846,"value":{"raw":" files","cooked":" files"},"tail":true}]},{"type":"Literal","start":849,"end":869,"value":"jobs.cleanup.files","raw":"'jobs.cleanup.files'"}]}},{"type":"ExpressionStatement","start":875,"end":1978,"expression":{"type":"CallExpression","start":875,"end":1978,"callee":{"type":"MemberExpression","start":875,"end":888,"object":{"type":"Identifier","start":875,"end":880,"name":"files"},"property":{"type":"Identifier","start":881,"end":888,"name":"forEach"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":889,"end":1977,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":890,"end":894,"name":"file"},{"type":"Identifier","start":896,"end":905,"name":"fileIndex"}],"body":{"type":"BlockStatement","start":910,"end":1977,"body":[{"type":"IfStatement","start":1134,"end":1264,"test":{"type":"UnaryExpression","start":1138,"end":1172,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":1139,"end":1172,"callee":{"type":"MemberExpression","start":1139,"end":1154,"object":{"type":"Identifier","start":1139,"end":1143,"name":"file"},"property":{"type":"Identifier","start":1144,"end":1154,"name":"startsWith"},"computed":false},"arguments":[{"type":"Identifier","start":1155,"end":1171,"name":"FILE_NAME_PREFIX"}]}},"consequent":{"type":"BlockStatement","start":1174,"end":1264,"body":[{"type":"ExpressionStatement","start":1184,"end":1241,"expression":{"type":"CallExpression","start":1184,"end":1241,"callee":{"type":"MemberExpression","start":1184,"end":1195,"object":{"type":"Identifier","start":1184,"end":1190,"name":"logger"},"property":{"type":"Identifier","start":1191,"end":1195,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":1196,"end":1219,"expressions":[{"type":"Identifier","start":1213,"end":1217,"name":"file"}],"quasis":[{"type":"TemplateElement","start":1197,"end":1211,"value":{"raw":"skipping file ","cooked":"skipping file "},"tail":false},{"type":"TemplateElement","start":1218,"end":1218,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":1221,"end":1240,"value":"jobs.cleanup.skip","raw":"'jobs.cleanup.skip'"}]}},{"type":"ReturnStatement","start":1250,"end":1256,"argument":null}]},"alternate":null},{"type":"VariableDeclaration","start":1271,"end":1312,"declarations":[{"type":"VariableDeclarator","start":1277,"end":1312,"id":{"type":"Identifier","start":1277,"end":1285,"name":"fullPath"},"init":{"type":"CallExpression","start":1288,"end":1312,"callee":{"type":"MemberExpression","start":1288,"end":1297,"object":{"type":"Identifier","start":1288,"end":1292,"name":"path"},"property":{"type":"Identifier","start":1293,"end":1297,"name":"join"},"computed":false},"arguments":[{"type":"Identifier","start":1298,"end":1305,"name":"dirPath"},{"type":"Identifier","start":1307,"end":1311,"name":"file"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":1320,"end":1971,"expression":{"type":"CallExpression","start":1320,"end":1971,"callee":{"type":"MemberExpression","start":1320,"end":1327,"object":{"type":"Identifier","start":1320,"end":1322,"name":"fs"},"property":{"type":"Identifier","start":1323,"end":1327,"name":"stat"},"computed":false},"arguments":[{"type":"Identifier","start":1328,"end":1336,"name":"fullPath"},{"type":"ArrowFunctionExpression","start":1338,"end":1970,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1339,"end":1342,"name":"err"},{"type":"Identifier","start":1344,"end":1349,"name":"stats"}],"body":{"type":"BlockStatement","start":1354,"end":1970,"body":[{"type":"VariableDeclaration","start":1364,"end":1406,"declarations":[{"type":"VariableDeclarator","start":1370,"end":1406,"id":{"type":"Identifier","start":1370,"end":1384,"name":"twelveHoursAgo"},"init":{"type":"BinaryExpression","start":1387,"end":1406,"left":{"type":"BinaryExpression","start":1387,"end":1399,"left":{"type":"BinaryExpression","start":1387,"end":1394,"left":{"type":"Literal","start":1387,"end":1389,"value":12,"raw":"12"},"operator":"*","right":{"type":"Literal","start":1392,"end":1394,"value":60,"raw":"60"}},"operator":"*","right":{"type":"Literal","start":1397,"end":1399,"value":60,"raw":"60"}},"operator":"*","right":{"type":"Literal","start":1402,"end":1406,"value":1000,"raw":"1000"}}}],"kind":"const"},{"type":"IfStatement","start":1415,"end":1768,"test":{"type":"Identifier","start":1419,"end":1422,"name":"err"},"consequent":{"type":"BlockStatement","start":1424,"end":1615,"body":[{"type":"ExpressionStatement","start":1539,"end":1583,"expression":{"type":"CallExpression","start":1539,"end":1583,"callee":{"type":"MemberExpression","start":1539,"end":1551,"object":{"type":"Identifier","start":1539,"end":1545,"name":"logger"},"property":{"type":"Identifier","start":1546,"end":1551,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":1552,"end":1555,"name":"err"},{"type":"Literal","start":1557,"end":1582,"value":"jobs.cleanup.stat.error","raw":"'jobs.cleanup.stat.error'"}]}}]},"alternate":{"type":"IfStatement","start":1621,"end":1768,"test":{"type":"BinaryExpression","start":1625,"end":1670,"left":{"type":"BinaryExpression","start":1626,"end":1652,"left":{"type":"NewExpression","start":1627,"end":1637,"callee":{"type":"Identifier","start":1631,"end":1635,"name":"Date"},"arguments":[]},"operator":"-","right":{"type":"MemberExpression","start":1641,"end":1652,"object":{"type":"Identifier","start":1641,"end":1646,"name":"stats"},"property":{"type":"Identifier","start":1647,"end":1652,"name":"mtime"},"computed":false}},"operator":"<","right":{"type":"Identifier","start":1656,"end":1670,"name":"twelveHoursAgo"}},"consequent":{"type":"BlockStatement","start":1672,"end":1768,"body":[{"type":"ExpressionStatement","start":1684,"end":1741,"expression":{"type":"CallExpression","start":1684,"end":1741,"callee":{"type":"MemberExpression","start":1684,"end":1695,"object":{"type":"Identifier","start":1684,"end":1690,"name":"logger"},"property":{"type":"Identifier","start":1691,"end":1695,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":1696,"end":1719,"expressions":[{"type":"Identifier","start":1713,"end":1717,"name":"file"}],"quasis":[{"type":"TemplateElement","start":1697,"end":1711,"value":{"raw":"skipping file ","cooked":"skipping file "},"tail":false},{"type":"TemplateElement","start":1718,"end":1718,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":1721,"end":1740,"value":"jobs.cleanup.skip","raw":"'jobs.cleanup.skip'"}]}},{"type":"ReturnStatement","start":1752,"end":1758,"argument":null}]},"alternate":null}},{"type":"ExpressionStatement","start":1778,"end":1846,"expression":{"type":"CallExpression","start":1778,"end":1846,"callee":{"type":"MemberExpression","start":1778,"end":1789,"object":{"type":"Identifier","start":1778,"end":1784,"name":"logger"},"property":{"type":"Identifier","start":1785,"end":1789,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":1790,"end":1813,"expressions":[{"type":"Identifier","start":1807,"end":1811,"name":"file"}],"quasis":[{"type":"TemplateElement","start":1791,"end":1805,"value":{"raw":"deleting file ","cooked":"deleting file "},"tail":false},{"type":"TemplateElement","start":1812,"end":1812,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":1815,"end":1845,"value":"jobs.cleanup.progress.delete","raw":"'jobs.cleanup.progress.delete'"}]}},{"type":"ExpressionStatement","start":1855,"end":1962,"expression":{"type":"CallExpression","start":1855,"end":1962,"callee":{"type":"MemberExpression","start":1855,"end":1864,"object":{"type":"Identifier","start":1855,"end":1857,"name":"fs"},"property":{"type":"Identifier","start":1858,"end":1864,"name":"unlink"},"computed":false},"arguments":[{"type":"Identifier","start":1865,"end":1873,"name":"fullPath"},{"type":"ArrowFunctionExpression","start":1875,"end":1961,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1876,"end":1879,"name":"err"}],"body":{"type":"BlockStatement","start":1884,"end":1961,"body":[{"type":"IfStatement","start":1896,"end":1951,"test":{"type":"Identifier","start":1900,"end":1903,"name":"err"},"consequent":{"type":"ExpressionStatement","start":1905,"end":1951,"expression":{"type":"CallExpression","start":1905,"end":1951,"callee":{"type":"MemberExpression","start":1905,"end":1917,"object":{"type":"Identifier","start":1905,"end":1911,"name":"logger"},"property":{"type":"Identifier","start":1912,"end":1917,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":1918,"end":1921,"name":"err"},{"type":"Literal","start":1923,"end":1950,"value":"jobs.cleanup.delete.error","raw":"'jobs.cleanup.delete.error'"}]}},"alternate":null}]}}]}}]}}]}}]}}]}}]}}]}}]}}}],"kind":"const"}],"sourceType":"script"}