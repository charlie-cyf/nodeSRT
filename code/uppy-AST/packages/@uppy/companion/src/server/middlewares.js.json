{"type":"Program","start":0,"end":1573,"body":[{"type":"VariableDeclaration","start":0,"end":45,"declarations":[{"type":"VariableDeclarator","start":6,"end":45,"id":{"type":"Identifier","start":6,"end":18,"name":"tokenService"},"init":{"type":"CallExpression","start":21,"end":45,"callee":{"type":"Identifier","start":21,"end":28,"name":"require"},"arguments":[{"type":"Literal","start":29,"end":44,"value":"./helpers/jwt","raw":"'./helpers/jwt'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":46,"end":80,"declarations":[{"type":"VariableDeclarator","start":52,"end":80,"id":{"type":"Identifier","start":52,"end":58,"name":"logger"},"init":{"type":"CallExpression","start":61,"end":80,"callee":{"type":"Identifier","start":61,"end":68,"name":"require"},"arguments":[{"type":"Literal","start":69,"end":79,"value":"./logger","raw":"'./logger'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":82,"end":477,"expression":{"type":"AssignmentExpression","start":82,"end":477,"operator":"=","left":{"type":"MemberExpression","start":82,"end":111,"object":{"type":"Identifier","start":82,"end":89,"name":"exports"},"property":{"type":"Identifier","start":90,"end":111,"name":"hasSessionAndProvider"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":114,"end":477,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":115,"end":118,"name":"req"},{"type":"Identifier","start":120,"end":123,"name":"res"},{"type":"Identifier","start":125,"end":129,"name":"next"}],"body":{"type":"BlockStatement","start":134,"end":477,"body":[{"type":"IfStatement","start":138,"end":299,"test":{"type":"LogicalExpression","start":142,"end":167,"left":{"type":"UnaryExpression","start":142,"end":154,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":143,"end":154,"object":{"type":"Identifier","start":143,"end":146,"name":"req"},"property":{"type":"Identifier","start":147,"end":154,"name":"session"},"computed":false}},"operator":"||","right":{"type":"UnaryExpression","start":158,"end":167,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":159,"end":167,"object":{"type":"Identifier","start":159,"end":162,"name":"req"},"property":{"type":"Identifier","start":163,"end":167,"name":"body"},"computed":false}}},"consequent":{"type":"BlockStatement","start":169,"end":299,"body":[{"type":"ExpressionStatement","start":175,"end":264,"expression":{"type":"CallExpression","start":175,"end":264,"callee":{"type":"MemberExpression","start":175,"end":187,"object":{"type":"Identifier","start":175,"end":181,"name":"logger"},"property":{"type":"Identifier","start":182,"end":187,"name":"debug"},"computed":false},"arguments":[{"type":"Literal","start":188,"end":249,"value":"No session/body attached to req object. Exiting dispatcher.","raw":"'No session/body attached to req object. Exiting dispatcher.'"},{"type":"Literal","start":251,"end":255,"value":null,"raw":"null"},{"type":"MemberExpression","start":257,"end":263,"object":{"type":"Identifier","start":257,"end":260,"name":"req"},"property":{"type":"Identifier","start":261,"end":263,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":269,"end":295,"argument":{"type":"CallExpression","start":276,"end":295,"callee":{"type":"MemberExpression","start":276,"end":290,"object":{"type":"Identifier","start":276,"end":279,"name":"res"},"property":{"type":"Identifier","start":280,"end":290,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":291,"end":294,"value":400,"raw":"400"}]}}]},"alternate":null},{"type":"IfStatement","start":303,"end":458,"test":{"type":"UnaryExpression","start":307,"end":330,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":308,"end":330,"object":{"type":"MemberExpression","start":308,"end":321,"object":{"type":"Identifier","start":308,"end":311,"name":"req"},"property":{"type":"Identifier","start":312,"end":321,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":322,"end":330,"name":"provider"},"computed":false}},"consequent":{"type":"BlockStatement","start":332,"end":458,"body":[{"type":"ExpressionStatement","start":338,"end":423,"expression":{"type":"CallExpression","start":338,"end":423,"callee":{"type":"MemberExpression","start":338,"end":350,"object":{"type":"Identifier","start":338,"end":344,"name":"logger"},"property":{"type":"Identifier","start":345,"end":350,"name":"debug"},"computed":false},"arguments":[{"type":"Literal","start":351,"end":408,"value":"No provider/provider-handler found. Exiting dispatcher.","raw":"'No provider/provider-handler found. Exiting dispatcher.'"},{"type":"Literal","start":410,"end":414,"value":null,"raw":"null"},{"type":"MemberExpression","start":416,"end":422,"object":{"type":"Identifier","start":416,"end":419,"name":"req"},"property":{"type":"Identifier","start":420,"end":422,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":428,"end":454,"argument":{"type":"CallExpression","start":435,"end":454,"callee":{"type":"MemberExpression","start":435,"end":449,"object":{"type":"Identifier","start":435,"end":438,"name":"res"},"property":{"type":"Identifier","start":439,"end":449,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":450,"end":453,"value":400,"raw":"400"}]}}]},"alternate":null},{"type":"ReturnStatement","start":462,"end":475,"argument":{"type":"CallExpression","start":469,"end":475,"callee":{"type":"Identifier","start":469,"end":473,"name":"next"},"arguments":[]}}]}}}},{"type":"ExpressionStatement","start":479,"end":1024,"expression":{"type":"AssignmentExpression","start":479,"end":1024,"operator":"=","left":{"type":"MemberExpression","start":479,"end":498,"object":{"type":"Identifier","start":479,"end":486,"name":"exports"},"property":{"type":"Identifier","start":487,"end":498,"name":"verifyToken"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":501,"end":1024,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":502,"end":505,"name":"req"},{"type":"Identifier","start":507,"end":510,"name":"res"},{"type":"Identifier","start":512,"end":516,"name":"next"}],"body":{"type":"BlockStatement","start":521,"end":1024,"body":[{"type":"VariableDeclaration","start":525,"end":562,"declarations":[{"type":"VariableDeclarator","start":531,"end":562,"id":{"type":"Identifier","start":531,"end":536,"name":"token"},"init":{"type":"MemberExpression","start":539,"end":562,"object":{"type":"MemberExpression","start":539,"end":552,"object":{"type":"Identifier","start":539,"end":542,"name":"req"},"property":{"type":"Identifier","start":543,"end":552,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":553,"end":562,"name":"authToken"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":565,"end":687,"test":{"type":"BinaryExpression","start":569,"end":582,"left":{"type":"Identifier","start":569,"end":574,"name":"token"},"operator":"==","right":{"type":"Literal","start":578,"end":582,"value":null,"raw":"null"}},"consequent":{"type":"BlockStatement","start":584,"end":687,"body":[{"type":"ExpressionStatement","start":590,"end":652,"expression":{"type":"CallExpression","start":590,"end":652,"callee":{"type":"MemberExpression","start":590,"end":601,"object":{"type":"Identifier","start":590,"end":596,"name":"logger"},"property":{"type":"Identifier","start":597,"end":601,"name":"info"},"computed":false},"arguments":[{"type":"Literal","start":602,"end":621,"value":"cannot auth token","raw":"'cannot auth token'"},{"type":"Literal","start":623,"end":643,"value":"token.verify.unset","raw":"'token.verify.unset'"},{"type":"MemberExpression","start":645,"end":651,"object":{"type":"Identifier","start":645,"end":648,"name":"req"},"property":{"type":"Identifier","start":649,"end":651,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":657,"end":683,"argument":{"type":"CallExpression","start":664,"end":683,"callee":{"type":"MemberExpression","start":664,"end":678,"object":{"type":"Identifier","start":664,"end":667,"name":"res"},"property":{"type":"Identifier","start":668,"end":678,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":679,"end":682,"value":401,"raw":"401"}]}}]},"alternate":null},{"type":"VariableDeclaration","start":690,"end":734,"declarations":[{"type":"VariableDeclarator","start":696,"end":734,"id":{"type":"Identifier","start":696,"end":708,"name":"providerName"},"init":{"type":"MemberExpression","start":711,"end":734,"object":{"type":"MemberExpression","start":711,"end":721,"object":{"type":"Identifier","start":711,"end":714,"name":"req"},"property":{"type":"Identifier","start":715,"end":721,"name":"params"},"computed":false},"property":{"type":"Identifier","start":722,"end":734,"name":"providerName"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":737,"end":823,"declarations":[{"type":"VariableDeclarator","start":743,"end":823,"id":{"type":"ObjectPattern","start":743,"end":759,"properties":[{"type":"Property","start":745,"end":748,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":745,"end":748,"name":"err"},"kind":"init","value":{"type":"Identifier","start":745,"end":748,"name":"err"}},{"type":"Property","start":750,"end":757,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":750,"end":757,"name":"payload"},"kind":"init","value":{"type":"Identifier","start":750,"end":757,"name":"payload"}}]},"init":{"type":"CallExpression","start":762,"end":823,"callee":{"type":"MemberExpression","start":762,"end":786,"object":{"type":"Identifier","start":762,"end":774,"name":"tokenService"},"property":{"type":"Identifier","start":775,"end":786,"name":"verifyToken"},"computed":false},"arguments":[{"type":"Identifier","start":787,"end":792,"name":"token"},{"type":"MemberExpression","start":794,"end":822,"object":{"type":"MemberExpression","start":794,"end":815,"object":{"type":"MemberExpression","start":794,"end":807,"object":{"type":"Identifier","start":794,"end":797,"name":"req"},"property":{"type":"Identifier","start":798,"end":807,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":808,"end":815,"name":"options"},"computed":false},"property":{"type":"Identifier","start":816,"end":822,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"IfStatement","start":826,"end":972,"test":{"type":"LogicalExpression","start":830,"end":859,"left":{"type":"Identifier","start":830,"end":833,"name":"err"},"operator":"||","right":{"type":"UnaryExpression","start":837,"end":859,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":838,"end":859,"object":{"type":"Identifier","start":838,"end":845,"name":"payload"},"property":{"type":"Identifier","start":846,"end":858,"name":"providerName"},"computed":true}}},"consequent":{"type":"BlockStatement","start":861,"end":972,"body":[{"type":"IfStatement","start":867,"end":937,"test":{"type":"Identifier","start":871,"end":874,"name":"err"},"consequent":{"type":"BlockStatement","start":876,"end":937,"body":[{"type":"ExpressionStatement","start":884,"end":931,"expression":{"type":"CallExpression","start":884,"end":931,"callee":{"type":"MemberExpression","start":884,"end":896,"object":{"type":"Identifier","start":884,"end":890,"name":"logger"},"property":{"type":"Identifier","start":891,"end":896,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":897,"end":900,"name":"err"},{"type":"Literal","start":902,"end":922,"value":"token.verify.error","raw":"'token.verify.error'"},{"type":"MemberExpression","start":924,"end":930,"object":{"type":"Identifier","start":924,"end":927,"name":"req"},"property":{"type":"Identifier","start":928,"end":930,"name":"id"},"computed":false}]}}]},"alternate":null},{"type":"ReturnStatement","start":942,"end":968,"argument":{"type":"CallExpression","start":949,"end":968,"callee":{"type":"MemberExpression","start":949,"end":963,"object":{"type":"Identifier","start":949,"end":952,"name":"res"},"property":{"type":"Identifier","start":953,"end":963,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":964,"end":967,"value":401,"raw":"401"}]}}]},"alternate":null},{"type":"ExpressionStatement","start":975,"end":1013,"expression":{"type":"AssignmentExpression","start":975,"end":1013,"operator":"=","left":{"type":"MemberExpression","start":975,"end":1003,"object":{"type":"MemberExpression","start":975,"end":988,"object":{"type":"Identifier","start":975,"end":978,"name":"req"},"property":{"type":"Identifier","start":979,"end":988,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":989,"end":1003,"name":"providerTokens"},"computed":false},"right":{"type":"Identifier","start":1006,"end":1013,"name":"payload"}}},{"type":"ExpressionStatement","start":1016,"end":1022,"expression":{"type":"CallExpression","start":1016,"end":1022,"callee":{"type":"Identifier","start":1016,"end":1020,"name":"next"},"arguments":[]}}]}}}},{"type":"ExpressionStatement","start":1063,"end":1408,"expression":{"type":"AssignmentExpression","start":1063,"end":1408,"operator":"=","left":{"type":"MemberExpression","start":1063,"end":1088,"object":{"type":"Identifier","start":1063,"end":1070,"name":"exports"},"property":{"type":"Identifier","start":1071,"end":1088,"name":"gentleVerifyToken"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":1091,"end":1408,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1092,"end":1095,"name":"req"},{"type":"Identifier","start":1097,"end":1100,"name":"res"},{"type":"Identifier","start":1102,"end":1106,"name":"next"}],"body":{"type":"BlockStatement","start":1111,"end":1408,"body":[{"type":"VariableDeclaration","start":1115,"end":1159,"declarations":[{"type":"VariableDeclarator","start":1121,"end":1159,"id":{"type":"Identifier","start":1121,"end":1133,"name":"providerName"},"init":{"type":"MemberExpression","start":1136,"end":1159,"object":{"type":"MemberExpression","start":1136,"end":1146,"object":{"type":"Identifier","start":1136,"end":1139,"name":"req"},"property":{"type":"Identifier","start":1140,"end":1146,"name":"params"},"computed":false},"property":{"type":"Identifier","start":1147,"end":1159,"name":"providerName"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":1162,"end":1397,"test":{"type":"MemberExpression","start":1166,"end":1189,"object":{"type":"MemberExpression","start":1166,"end":1179,"object":{"type":"Identifier","start":1166,"end":1169,"name":"req"},"property":{"type":"Identifier","start":1170,"end":1179,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1180,"end":1189,"name":"authToken"},"computed":false},"consequent":{"type":"BlockStatement","start":1191,"end":1397,"body":[{"type":"VariableDeclaration","start":1197,"end":1301,"declarations":[{"type":"VariableDeclarator","start":1203,"end":1301,"id":{"type":"ObjectPattern","start":1203,"end":1219,"properties":[{"type":"Property","start":1205,"end":1208,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1205,"end":1208,"name":"err"},"kind":"init","value":{"type":"Identifier","start":1205,"end":1208,"name":"err"}},{"type":"Property","start":1210,"end":1217,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1210,"end":1217,"name":"payload"},"kind":"init","value":{"type":"Identifier","start":1210,"end":1217,"name":"payload"}}]},"init":{"type":"CallExpression","start":1222,"end":1301,"callee":{"type":"MemberExpression","start":1222,"end":1246,"object":{"type":"Identifier","start":1222,"end":1234,"name":"tokenService"},"property":{"type":"Identifier","start":1235,"end":1246,"name":"verifyToken"},"computed":false},"arguments":[{"type":"MemberExpression","start":1247,"end":1270,"object":{"type":"MemberExpression","start":1247,"end":1260,"object":{"type":"Identifier","start":1247,"end":1250,"name":"req"},"property":{"type":"Identifier","start":1251,"end":1260,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1261,"end":1270,"name":"authToken"},"computed":false},{"type":"MemberExpression","start":1272,"end":1300,"object":{"type":"MemberExpression","start":1272,"end":1293,"object":{"type":"MemberExpression","start":1272,"end":1285,"object":{"type":"Identifier","start":1272,"end":1275,"name":"req"},"property":{"type":"Identifier","start":1276,"end":1285,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1286,"end":1293,"name":"options"},"computed":false},"property":{"type":"Identifier","start":1294,"end":1300,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"IfStatement","start":1306,"end":1393,"test":{"type":"LogicalExpression","start":1310,"end":1339,"left":{"type":"UnaryExpression","start":1310,"end":1314,"operator":"!","prefix":true,"argument":{"type":"Identifier","start":1311,"end":1314,"name":"err"}},"operator":"&&","right":{"type":"MemberExpression","start":1318,"end":1339,"object":{"type":"Identifier","start":1318,"end":1325,"name":"payload"},"property":{"type":"Identifier","start":1326,"end":1338,"name":"providerName"},"computed":true}},"consequent":{"type":"BlockStatement","start":1341,"end":1393,"body":[{"type":"ExpressionStatement","start":1349,"end":1387,"expression":{"type":"AssignmentExpression","start":1349,"end":1387,"operator":"=","left":{"type":"MemberExpression","start":1349,"end":1377,"object":{"type":"MemberExpression","start":1349,"end":1362,"object":{"type":"Identifier","start":1349,"end":1352,"name":"req"},"property":{"type":"Identifier","start":1353,"end":1362,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1363,"end":1377,"name":"providerTokens"},"computed":false},"right":{"type":"Identifier","start":1380,"end":1387,"name":"payload"}}}]},"alternate":null}]},"alternate":null},{"type":"ExpressionStatement","start":1400,"end":1406,"expression":{"type":"CallExpression","start":1400,"end":1406,"callee":{"type":"Identifier","start":1400,"end":1404,"name":"next"},"arguments":[]}}]}}}},{"type":"ExpressionStatement","start":1410,"end":1572,"expression":{"type":"AssignmentExpression","start":1410,"end":1572,"operator":"=","left":{"type":"MemberExpression","start":1410,"end":1433,"object":{"type":"Identifier","start":1410,"end":1417,"name":"exports"},"property":{"type":"Identifier","start":1418,"end":1433,"name":"cookieAuthToken"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":1436,"end":1572,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1437,"end":1440,"name":"req"},{"type":"Identifier","start":1442,"end":1445,"name":"res"},{"type":"Identifier","start":1447,"end":1451,"name":"next"}],"body":{"type":"BlockStatement","start":1456,"end":1572,"body":[{"type":"ExpressionStatement","start":1460,"end":1554,"expression":{"type":"AssignmentExpression","start":1460,"end":1554,"operator":"=","left":{"type":"MemberExpression","start":1460,"end":1483,"object":{"type":"MemberExpression","start":1460,"end":1473,"object":{"type":"Identifier","start":1460,"end":1463,"name":"req"},"property":{"type":"Identifier","start":1464,"end":1473,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1474,"end":1483,"name":"authToken"},"computed":false},"right":{"type":"MemberExpression","start":1486,"end":1554,"object":{"type":"MemberExpression","start":1486,"end":1497,"object":{"type":"Identifier","start":1486,"end":1489,"name":"req"},"property":{"type":"Identifier","start":1490,"end":1497,"name":"cookies"},"computed":false},"property":{"type":"TemplateLiteral","start":1498,"end":1553,"expressions":[{"type":"MemberExpression","start":1516,"end":1551,"object":{"type":"MemberExpression","start":1516,"end":1538,"object":{"type":"MemberExpression","start":1516,"end":1529,"object":{"type":"Identifier","start":1516,"end":1519,"name":"req"},"property":{"type":"Identifier","start":1520,"end":1529,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1530,"end":1538,"name":"provider"},"computed":false},"property":{"type":"Identifier","start":1539,"end":1551,"name":"authProvider"},"computed":false}],"quasis":[{"type":"TemplateElement","start":1499,"end":1514,"value":{"raw":"uppyAuthToken--","cooked":"uppyAuthToken--"},"tail":false},{"type":"TemplateElement","start":1552,"end":1552,"value":{"raw":"","cooked":""},"tail":true}]},"computed":true}}},{"type":"ReturnStatement","start":1557,"end":1570,"argument":{"type":"CallExpression","start":1564,"end":1570,"callee":{"type":"Identifier","start":1564,"end":1568,"name":"next"},"arguments":[]}}]}}}}],"sourceType":"script"}