{"type":"Program","start":0,"end":2403,"body":[{"type":"VariableDeclaration","start":46,"end":92,"declarations":[{"type":"VariableDeclarator","start":52,"end":92,"id":{"type":"Identifier","start":52,"end":64,"name":"tokenService"},"init":{"type":"CallExpression","start":67,"end":92,"callee":{"type":"Identifier","start":67,"end":74,"name":"require"},"arguments":[{"type":"Literal","start":75,"end":91,"value":"../helpers/jwt","raw":"'../helpers/jwt'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":93,"end":130,"declarations":[{"type":"VariableDeclarator","start":99,"end":130,"id":{"type":"Identifier","start":99,"end":107,"name":"parseUrl"},"init":{"type":"MemberExpression","start":110,"end":130,"object":{"type":"CallExpression","start":110,"end":124,"callee":{"type":"Identifier","start":110,"end":117,"name":"require"},"arguments":[{"type":"Literal","start":118,"end":123,"value":"url","raw":"'url'"}]},"property":{"type":"Identifier","start":125,"end":130,"name":"parse"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":177,"end":239,"declarations":[{"type":"VariableDeclarator","start":183,"end":239,"id":{"type":"ObjectPattern","start":183,"end":209,"properties":[{"type":"Property","start":185,"end":193,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":185,"end":193,"name":"hasMatch"},"kind":"init","value":{"type":"Identifier","start":185,"end":193,"name":"hasMatch"}},{"type":"Property","start":195,"end":207,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":195,"end":207,"name":"sanitizeHtml"},"kind":"init","value":{"type":"Identifier","start":195,"end":207,"name":"sanitizeHtml"}}]},"init":{"type":"CallExpression","start":212,"end":239,"callee":{"type":"Identifier","start":212,"end":219,"name":"require"},"arguments":[{"type":"Literal","start":220,"end":238,"value":"../helpers/utils","raw":"'../helpers/utils'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":240,"end":292,"declarations":[{"type":"VariableDeclarator","start":246,"end":292,"id":{"type":"Identifier","start":246,"end":256,"name":"oAuthState"},"init":{"type":"CallExpression","start":259,"end":292,"callee":{"type":"Identifier","start":259,"end":266,"name":"require"},"arguments":[{"type":"Literal","start":267,"end":291,"value":"../helpers/oauth-state","raw":"'../helpers/oauth-state'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":293,"end":341,"declarations":[{"type":"VariableDeclarator","start":299,"end":341,"id":{"type":"Identifier","start":299,"end":309,"name":"versionCmp"},"init":{"type":"CallExpression","start":312,"end":341,"callee":{"type":"Identifier","start":312,"end":319,"name":"require"},"arguments":[{"type":"Literal","start":320,"end":340,"value":"../helpers/version","raw":"'../helpers/version'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":426,"end":1522,"expression":{"type":"AssignmentExpression","start":426,"end":1522,"operator":"=","left":{"type":"MemberExpression","start":426,"end":440,"object":{"type":"Identifier","start":426,"end":432,"name":"module"},"property":{"type":"Identifier","start":433,"end":440,"name":"exports"},"computed":false},"right":{"type":"FunctionExpression","start":443,"end":1522,"id":{"type":"Identifier","start":452,"end":461,"name":"sendToken"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":463,"end":466,"name":"req"},{"type":"Identifier","start":468,"end":471,"name":"res"},{"type":"Identifier","start":473,"end":477,"name":"next"}],"body":{"type":"BlockStatement","start":479,"end":1522,"body":[{"type":"VariableDeclaration","start":483,"end":528,"declarations":[{"type":"VariableDeclarator","start":489,"end":528,"id":{"type":"Identifier","start":489,"end":502,"name":"uppyAuthToken"},"init":{"type":"MemberExpression","start":505,"end":528,"object":{"type":"MemberExpression","start":505,"end":518,"object":{"type":"Identifier","start":505,"end":508,"name":"req"},"property":{"type":"Identifier","start":509,"end":518,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":519,"end":528,"name":"authToken"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":606,"end":765,"test":{"type":"MemberExpression","start":610,"end":648,"object":{"type":"MemberExpression","start":610,"end":632,"object":{"type":"MemberExpression","start":610,"end":623,"object":{"type":"Identifier","start":610,"end":613,"name":"req"},"property":{"type":"Identifier","start":614,"end":623,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":624,"end":632,"name":"provider"},"computed":false},"property":{"type":"Identifier","start":633,"end":648,"name":"needsCookieAuth"},"computed":false},"consequent":{"type":"BlockStatement","start":650,"end":765,"body":[{"type":"ExpressionStatement","start":656,"end":761,"expression":{"type":"CallExpression","start":656,"end":761,"callee":{"type":"MemberExpression","start":656,"end":681,"object":{"type":"Identifier","start":656,"end":668,"name":"tokenService"},"property":{"type":"Identifier","start":669,"end":681,"name":"addToCookies"},"computed":false},"arguments":[{"type":"Identifier","start":682,"end":685,"name":"res"},{"type":"Identifier","start":687,"end":700,"name":"uppyAuthToken"},{"type":"MemberExpression","start":702,"end":723,"object":{"type":"MemberExpression","start":702,"end":715,"object":{"type":"Identifier","start":702,"end":705,"name":"req"},"property":{"type":"Identifier","start":706,"end":715,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":716,"end":723,"name":"options"},"computed":false},{"type":"MemberExpression","start":725,"end":760,"object":{"type":"MemberExpression","start":725,"end":747,"object":{"type":"MemberExpression","start":725,"end":738,"object":{"type":"Identifier","start":725,"end":728,"name":"req"},"property":{"type":"Identifier","start":729,"end":738,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":739,"end":747,"name":"provider"},"computed":false},"property":{"type":"Identifier","start":748,"end":760,"name":"authProvider"},"computed":false}]}}]},"alternate":null},{"type":"VariableDeclaration","start":769,"end":824,"declarations":[{"type":"VariableDeclarator","start":775,"end":824,"id":{"type":"Identifier","start":775,"end":782,"name":"dynamic"},"init":{"type":"LogicalExpression","start":785,"end":824,"left":{"type":"MemberExpression","start":785,"end":818,"object":{"type":"LogicalExpression","start":786,"end":809,"left":{"type":"MemberExpression","start":786,"end":803,"object":{"type":"MemberExpression","start":786,"end":797,"object":{"type":"Identifier","start":786,"end":789,"name":"req"},"property":{"type":"Identifier","start":790,"end":797,"name":"session"},"computed":false},"property":{"type":"Identifier","start":798,"end":803,"name":"grant"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":807,"end":809,"properties":[]}},"property":{"type":"Identifier","start":811,"end":818,"name":"dynamic"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":822,"end":824,"properties":[]}}}],"kind":"const"},{"type":"VariableDeclaration","start":827,"end":854,"declarations":[{"type":"VariableDeclarator","start":833,"end":854,"id":{"type":"Identifier","start":833,"end":838,"name":"state"},"init":{"type":"MemberExpression","start":841,"end":854,"object":{"type":"Identifier","start":841,"end":848,"name":"dynamic"},"property":{"type":"Identifier","start":849,"end":854,"name":"state"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":857,"end":1511,"test":{"type":"Identifier","start":861,"end":866,"name":"state"},"consequent":{"type":"BlockStatement","start":868,"end":1511,"body":[{"type":"VariableDeclaration","start":874,"end":959,"declarations":[{"type":"VariableDeclarator","start":880,"end":959,"id":{"type":"Identifier","start":880,"end":886,"name":"origin"},"init":{"type":"CallExpression","start":889,"end":959,"callee":{"type":"MemberExpression","start":889,"end":912,"object":{"type":"Identifier","start":889,"end":899,"name":"oAuthState"},"property":{"type":"Identifier","start":900,"end":912,"name":"getFromState"},"computed":false},"arguments":[{"type":"Identifier","start":913,"end":918,"name":"state"},{"type":"Literal","start":920,"end":928,"value":"origin","raw":"'origin'"},{"type":"MemberExpression","start":930,"end":958,"object":{"type":"MemberExpression","start":930,"end":951,"object":{"type":"MemberExpression","start":930,"end":943,"object":{"type":"Identifier","start":930,"end":933,"name":"req"},"property":{"type":"Identifier","start":934,"end":943,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":944,"end":951,"name":"options"},"computed":false},"property":{"type":"Identifier","start":952,"end":958,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"VariableDeclaration","start":964,"end":1087,"declarations":[{"type":"VariableDeclarator","start":970,"end":1087,"id":{"type":"Identifier","start":970,"end":983,"name":"clientVersion"},"init":{"type":"CallExpression","start":986,"end":1087,"callee":{"type":"MemberExpression","start":986,"end":1009,"object":{"type":"Identifier","start":986,"end":996,"name":"oAuthState"},"property":{"type":"Identifier","start":997,"end":1009,"name":"getFromState"},"computed":false},"arguments":[{"type":"Identifier","start":1017,"end":1022,"name":"state"},{"type":"Literal","start":1030,"end":1045,"value":"clientVersion","raw":"'clientVersion'"},{"type":"MemberExpression","start":1053,"end":1081,"object":{"type":"MemberExpression","start":1053,"end":1074,"object":{"type":"MemberExpression","start":1053,"end":1066,"object":{"type":"Identifier","start":1053,"end":1056,"name":"req"},"property":{"type":"Identifier","start":1057,"end":1066,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1067,"end":1074,"name":"options"},"computed":false},"property":{"type":"Identifier","start":1075,"end":1081,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"VariableDeclaration","start":1092,"end":1144,"declarations":[{"type":"VariableDeclarator","start":1098,"end":1144,"id":{"type":"Identifier","start":1098,"end":1112,"name":"allowedClients"},"init":{"type":"MemberExpression","start":1115,"end":1144,"object":{"type":"MemberExpression","start":1115,"end":1136,"object":{"type":"MemberExpression","start":1115,"end":1128,"object":{"type":"Identifier","start":1115,"end":1118,"name":"req"},"property":{"type":"Identifier","start":1119,"end":1128,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1129,"end":1136,"name":"options"},"computed":false},"property":{"type":"Identifier","start":1137,"end":1144,"name":"clients"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":1199,"end":1507,"test":{"type":"LogicalExpression","start":1203,"end":1305,"left":{"type":"LogicalExpression","start":1203,"end":1254,"left":{"type":"UnaryExpression","start":1203,"end":1218,"operator":"!","prefix":true,"argument":{"type":"Identifier","start":1204,"end":1218,"name":"allowedClients"}},"operator":"||","right":{"type":"CallExpression","start":1222,"end":1254,"callee":{"type":"Identifier","start":1222,"end":1230,"name":"hasMatch"},"arguments":[{"type":"Identifier","start":1231,"end":1237,"name":"origin"},{"type":"Identifier","start":1239,"end":1253,"name":"allowedClients"}]}},"operator":"||","right":{"type":"CallExpression","start":1258,"end":1305,"callee":{"type":"Identifier","start":1258,"end":1266,"name":"hasMatch"},"arguments":[{"type":"MemberExpression","start":1267,"end":1288,"object":{"type":"CallExpression","start":1267,"end":1283,"callee":{"type":"Identifier","start":1267,"end":1275,"name":"parseUrl"},"arguments":[{"type":"Identifier","start":1276,"end":1282,"name":"origin"}]},"property":{"type":"Identifier","start":1284,"end":1288,"name":"host"},"computed":false},{"type":"Identifier","start":1290,"end":1304,"name":"allowedClients"}]}},"consequent":{"type":"BlockStatement","start":1307,"end":1507,"body":[{"type":"VariableDeclaration","start":1315,"end":1381,"declarations":[{"type":"VariableDeclarator","start":1321,"end":1381,"id":{"type":"Identifier","start":1321,"end":1340,"name":"allowsStringMessage"},"init":{"type":"CallExpression","start":1343,"end":1381,"callee":{"type":"MemberExpression","start":1343,"end":1357,"object":{"type":"Identifier","start":1343,"end":1353,"name":"versionCmp"},"property":{"type":"Identifier","start":1354,"end":1357,"name":"gte"},"computed":false},"arguments":[{"type":"Identifier","start":1358,"end":1371,"name":"clientVersion"},{"type":"Literal","start":1373,"end":1380,"value":"1.0.2","raw":"'1.0.2'"}]}}],"kind":"const"},{"type":"ReturnStatement","start":1388,"end":1501,"argument":{"type":"CallExpression","start":1395,"end":1501,"callee":{"type":"MemberExpression","start":1395,"end":1403,"object":{"type":"Identifier","start":1395,"end":1398,"name":"res"},"property":{"type":"Identifier","start":1399,"end":1403,"name":"send"},"computed":false},"arguments":[{"type":"ConditionalExpression","start":1404,"end":1500,"test":{"type":"Identifier","start":1404,"end":1423,"name":"allowsStringMessage"},"consequent":{"type":"CallExpression","start":1426,"end":1460,"callee":{"type":"Identifier","start":1426,"end":1437,"name":"htmlContent"},"arguments":[{"type":"Identifier","start":1438,"end":1451,"name":"uppyAuthToken"},{"type":"Identifier","start":1453,"end":1459,"name":"origin"}]},"alternate":{"type":"CallExpression","start":1463,"end":1500,"callee":{"type":"Identifier","start":1463,"end":1477,"name":"oldHtmlContent"},"arguments":[{"type":"Identifier","start":1478,"end":1491,"name":"uppyAuthToken"},{"type":"Identifier","start":1493,"end":1499,"name":"origin"}]}}]}}]},"alternate":null}]},"alternate":null},{"type":"ExpressionStatement","start":1514,"end":1520,"expression":{"type":"CallExpression","start":1514,"end":1520,"callee":{"type":"Identifier","start":1514,"end":1518,"name":"next"},"arguments":[]}}]}}}},{"type":"VariableDeclaration","start":1613,"end":1944,"declarations":[{"type":"VariableDeclarator","start":1619,"end":1944,"id":{"type":"Identifier","start":1619,"end":1630,"name":"htmlContent"},"init":{"type":"ArrowFunctionExpression","start":1633,"end":1944,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1634,"end":1639,"name":"token"},{"type":"Identifier","start":1641,"end":1647,"name":"origin"}],"body":{"type":"BlockStatement","start":1652,"end":1944,"body":[{"type":"ReturnStatement","start":1656,"end":1942,"argument":{"type":"TemplateLiteral","start":1663,"end":1942,"expressions":[{"type":"Identifier","start":1819,"end":1824,"name":"token"},{"type":"CallExpression","start":1833,"end":1853,"callee":{"type":"Identifier","start":1833,"end":1845,"name":"sanitizeHtml"},"arguments":[{"type":"Identifier","start":1846,"end":1852,"name":"origin"}]}],"quasis":[{"type":"TemplateElement","start":1664,"end":1817,"value":{"raw":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage(JSON.stringify({token: \"","cooked":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage(JSON.stringify({token: \""},"tail":false},{"type":"TemplateElement","start":1825,"end":1831,"value":{"raw":"\"}), \"","cooked":"\"}), \""},"tail":false},{"type":"TemplateElement","start":1854,"end":1941,"value":{"raw":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>","cooked":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>"},"tail":true}]}}]}}}],"kind":"const"},{"type":"VariableDeclaration","start":2084,"end":2402,"declarations":[{"type":"VariableDeclarator","start":2090,"end":2402,"id":{"type":"Identifier","start":2090,"end":2104,"name":"oldHtmlContent"},"init":{"type":"ArrowFunctionExpression","start":2107,"end":2402,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":2108,"end":2113,"name":"token"},{"type":"Identifier","start":2115,"end":2121,"name":"origin"}],"body":{"type":"BlockStatement","start":2126,"end":2402,"body":[{"type":"ReturnStatement","start":2130,"end":2400,"argument":{"type":"TemplateLiteral","start":2137,"end":2400,"expressions":[{"type":"Identifier","start":2278,"end":2283,"name":"token"},{"type":"CallExpression","start":2291,"end":2311,"callee":{"type":"Identifier","start":2291,"end":2303,"name":"sanitizeHtml"},"arguments":[{"type":"Identifier","start":2304,"end":2310,"name":"origin"}]}],"quasis":[{"type":"TemplateElement","start":2138,"end":2276,"value":{"raw":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage({token: \"","cooked":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage({token: \""},"tail":false},{"type":"TemplateElement","start":2284,"end":2289,"value":{"raw":"\"}, \"","cooked":"\"}, \""},"tail":false},{"type":"TemplateElement","start":2312,"end":2399,"value":{"raw":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>","cooked":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>"},"tail":true}]}}]}}}],"kind":"const"}],"sourceType":"script"}