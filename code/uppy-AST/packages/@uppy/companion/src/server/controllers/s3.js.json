{"type":"Program","start":0,"end":9047,"body":[{"type":"VariableDeclaration","start":0,"end":40,"declarations":[{"type":"VariableDeclarator","start":6,"end":40,"id":{"type":"Identifier","start":6,"end":12,"name":"router"},"init":{"type":"MemberExpression","start":15,"end":40,"object":{"type":"CallExpression","start":15,"end":33,"callee":{"type":"Identifier","start":15,"end":22,"name":"require"},"arguments":[{"type":"Literal","start":23,"end":32,"value":"express","raw":"'express'"}]},"property":{"type":"Identifier","start":34,"end":40,"name":"Router"},"computed":false}}],"kind":"const"},{"type":"ExpressionStatement","start":42,"end":8899,"expression":{"type":"AssignmentExpression","start":42,"end":8899,"operator":"=","left":{"type":"MemberExpression","start":42,"end":56,"object":{"type":"Identifier","start":42,"end":48,"name":"module"},"property":{"type":"Identifier","start":49,"end":56,"name":"exports"},"computed":false},"right":{"type":"FunctionExpression","start":59,"end":8899,"id":{"type":"Identifier","start":68,"end":70,"name":"s3"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":72,"end":78,"name":"config"}],"body":{"type":"BlockStatement","start":80,"end":8899,"body":[{"type":"IfStatement","start":84,"end":190,"test":{"type":"BinaryExpression","start":88,"end":118,"left":{"type":"UnaryExpression","start":88,"end":105,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":95,"end":105,"object":{"type":"Identifier","start":95,"end":101,"name":"config"},"property":{"type":"Identifier","start":102,"end":105,"name":"acl"},"computed":false}},"operator":"!==","right":{"type":"Literal","start":110,"end":118,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":120,"end":190,"body":[{"type":"ThrowStatement","start":126,"end":186,"argument":{"type":"NewExpression","start":132,"end":186,"callee":{"type":"Identifier","start":136,"end":145,"name":"TypeError"},"arguments":[{"type":"Literal","start":146,"end":185,"value":"s3: The `acl` option must be a string","raw":"'s3: The `acl` option must be a string'"}]}}]},"alternate":null},{"type":"IfStatement","start":193,"end":309,"test":{"type":"BinaryExpression","start":197,"end":232,"left":{"type":"UnaryExpression","start":197,"end":217,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":204,"end":217,"object":{"type":"Identifier","start":204,"end":210,"name":"config"},"property":{"type":"Identifier","start":211,"end":217,"name":"getKey"},"computed":false}},"operator":"!==","right":{"type":"Literal","start":222,"end":232,"value":"function","raw":"'function'"}},"consequent":{"type":"BlockStatement","start":234,"end":309,"body":[{"type":"ThrowStatement","start":240,"end":305,"argument":{"type":"NewExpression","start":246,"end":305,"callee":{"type":"Identifier","start":250,"end":259,"name":"TypeError"},"arguments":[{"type":"Literal","start":260,"end":304,"value":"s3: The `getKey` option must be a function","raw":"'s3: The `getKey` option must be a function'"}]}}]},"alternate":null},{"type":"FunctionDeclaration","start":904,"end":1923,"id":{"type":"Identifier","start":913,"end":932,"name":"getUploadParameters"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":934,"end":937,"name":"req"},{"type":"Identifier","start":939,"end":942,"name":"res"},{"type":"Identifier","start":944,"end":948,"name":"next"}],"body":{"type":"BlockStatement","start":950,"end":1923,"body":[{"type":"VariableDeclaration","start":1044,"end":1081,"declarations":[{"type":"VariableDeclarator","start":1050,"end":1081,"id":{"type":"Identifier","start":1050,"end":1056,"name":"client"},"init":{"type":"MemberExpression","start":1059,"end":1081,"object":{"type":"MemberExpression","start":1059,"end":1072,"object":{"type":"Identifier","start":1059,"end":1062,"name":"req"},"property":{"type":"Identifier","start":1063,"end":1072,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1073,"end":1081,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":1086,"end":1127,"declarations":[{"type":"VariableDeclarator","start":1092,"end":1127,"id":{"type":"Identifier","start":1092,"end":1100,"name":"metadata"},"init":{"type":"LogicalExpression","start":1103,"end":1127,"left":{"type":"MemberExpression","start":1103,"end":1121,"object":{"type":"MemberExpression","start":1103,"end":1112,"object":{"type":"Identifier","start":1103,"end":1106,"name":"req"},"property":{"type":"Identifier","start":1107,"end":1112,"name":"query"},"computed":false},"property":{"type":"Identifier","start":1113,"end":1121,"name":"metadata"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":1125,"end":1127,"properties":[]}}}],"kind":"const"},{"type":"VariableDeclaration","start":1132,"end":1192,"declarations":[{"type":"VariableDeclarator","start":1138,"end":1192,"id":{"type":"Identifier","start":1138,"end":1141,"name":"key"},"init":{"type":"CallExpression","start":1144,"end":1192,"callee":{"type":"MemberExpression","start":1144,"end":1157,"object":{"type":"Identifier","start":1144,"end":1150,"name":"config"},"property":{"type":"Identifier","start":1151,"end":1157,"name":"getKey"},"computed":false},"arguments":[{"type":"Identifier","start":1158,"end":1161,"name":"req"},{"type":"MemberExpression","start":1163,"end":1181,"object":{"type":"MemberExpression","start":1163,"end":1172,"object":{"type":"Identifier","start":1163,"end":1166,"name":"req"},"property":{"type":"Identifier","start":1167,"end":1172,"name":"query"},"computed":false},"property":{"type":"Identifier","start":1173,"end":1181,"name":"filename"},"computed":false},{"type":"Identifier","start":1183,"end":1191,"name":"metadata"}]}}],"kind":"const"},{"type":"IfStatement","start":1197,"end":1334,"test":{"type":"BinaryExpression","start":1201,"end":1224,"left":{"type":"UnaryExpression","start":1201,"end":1211,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":1208,"end":1211,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":1216,"end":1224,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":1226,"end":1334,"body":[{"type":"ReturnStatement","start":1234,"end":1328,"argument":{"type":"CallExpression","start":1241,"end":1328,"callee":{"type":"MemberExpression","start":1241,"end":1261,"object":{"type":"CallExpression","start":1241,"end":1256,"callee":{"type":"MemberExpression","start":1241,"end":1251,"object":{"type":"Identifier","start":1241,"end":1244,"name":"res"},"property":{"type":"Identifier","start":1245,"end":1251,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":1252,"end":1255,"value":500,"raw":"500"}]},"property":{"type":"Identifier","start":1257,"end":1261,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":1262,"end":1327,"properties":[{"type":"Property","start":1264,"end":1325,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1264,"end":1269,"name":"error"},"value":{"type":"Literal","start":1271,"end":1325,"value":"s3: filename returned from `getKey` must be a string","raw":"'s3: filename returned from `getKey` must be a string'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"VariableDeclaration","start":1340,"end":1474,"declarations":[{"type":"VariableDeclarator","start":1346,"end":1474,"id":{"type":"Identifier","start":1346,"end":1352,"name":"fields"},"init":{"type":"ObjectExpression","start":1355,"end":1474,"properties":[{"type":"Property","start":1363,"end":1378,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1363,"end":1366,"name":"acl"},"value":{"type":"MemberExpression","start":1368,"end":1378,"object":{"type":"Identifier","start":1368,"end":1374,"name":"config"},"property":{"type":"Identifier","start":1375,"end":1378,"name":"acl"},"computed":false},"kind":"init"},{"type":"Property","start":1386,"end":1394,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1386,"end":1389,"name":"key"},"value":{"type":"Identifier","start":1391,"end":1394,"name":"key"},"kind":"init"},{"type":"Property","start":1402,"end":1430,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1402,"end":1423,"name":"success_action_status"},"value":{"type":"Literal","start":1425,"end":1430,"value":"201","raw":"'201'"},"kind":"init"},{"type":"Property","start":1438,"end":1468,"method":false,"shorthand":false,"computed":false,"key":{"type":"Literal","start":1438,"end":1452,"value":"content-type","raw":"'content-type'"},"value":{"type":"MemberExpression","start":1454,"end":1468,"object":{"type":"MemberExpression","start":1454,"end":1463,"object":{"type":"Identifier","start":1454,"end":1457,"name":"req"},"property":{"type":"Identifier","start":1458,"end":1463,"name":"query"},"computed":false},"property":{"type":"Identifier","start":1464,"end":1468,"name":"type"},"computed":false},"kind":"init"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":1480,"end":1577,"expression":{"type":"CallExpression","start":1480,"end":1577,"callee":{"type":"MemberExpression","start":1480,"end":1509,"object":{"type":"CallExpression","start":1480,"end":1501,"callee":{"type":"MemberExpression","start":1480,"end":1491,"object":{"type":"Identifier","start":1480,"end":1486,"name":"Object"},"property":{"type":"Identifier","start":1487,"end":1491,"name":"keys"},"computed":false},"arguments":[{"type":"Identifier","start":1492,"end":1500,"name":"metadata"}]},"property":{"type":"Identifier","start":1502,"end":1509,"name":"forEach"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":1510,"end":1576,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1511,"end":1514,"name":"key"}],"body":{"type":"BlockStatement","start":1519,"end":1576,"body":[{"type":"ExpressionStatement","start":1527,"end":1570,"expression":{"type":"AssignmentExpression","start":1527,"end":1570,"operator":"=","left":{"type":"MemberExpression","start":1527,"end":1554,"object":{"type":"Identifier","start":1527,"end":1533,"name":"fields"},"property":{"type":"TemplateLiteral","start":1534,"end":1553,"expressions":[{"type":"Identifier","start":1548,"end":1551,"name":"key"}],"quasis":[{"type":"TemplateElement","start":1535,"end":1546,"value":{"raw":"x-amz-meta-","cooked":"x-amz-meta-"},"tail":false},{"type":"TemplateElement","start":1552,"end":1552,"value":{"raw":"","cooked":""},"tail":true}]},"computed":true},"right":{"type":"MemberExpression","start":1557,"end":1570,"object":{"type":"Identifier","start":1557,"end":1565,"name":"metadata"},"property":{"type":"Identifier","start":1566,"end":1569,"name":"key"},"computed":true}}}]}}]}},{"type":"ExpressionStatement","start":1583,"end":1919,"expression":{"type":"CallExpression","start":1583,"end":1919,"callee":{"type":"MemberExpression","start":1583,"end":1609,"object":{"type":"Identifier","start":1583,"end":1589,"name":"client"},"property":{"type":"Identifier","start":1590,"end":1609,"name":"createPresignedPost"},"computed":false},"arguments":[{"type":"ObjectExpression","start":1610,"end":1735,"properties":[{"type":"Property","start":1618,"end":1639,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1618,"end":1624,"name":"Bucket"},"value":{"type":"MemberExpression","start":1626,"end":1639,"object":{"type":"Identifier","start":1626,"end":1632,"name":"config"},"property":{"type":"Identifier","start":1633,"end":1639,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":1647,"end":1670,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1647,"end":1654,"name":"Expires"},"value":{"type":"MemberExpression","start":1656,"end":1670,"object":{"type":"Identifier","start":1656,"end":1662,"name":"config"},"property":{"type":"Identifier","start":1663,"end":1670,"name":"expires"},"computed":false},"kind":"init"},{"type":"Property","start":1678,"end":1692,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1678,"end":1684,"name":"Fields"},"value":{"type":"Identifier","start":1686,"end":1692,"name":"fields"},"kind":"init"},{"type":"Property","start":1700,"end":1729,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1700,"end":1710,"name":"Conditions"},"value":{"type":"MemberExpression","start":1712,"end":1729,"object":{"type":"Identifier","start":1712,"end":1718,"name":"config"},"property":{"type":"Identifier","start":1719,"end":1729,"name":"conditions"},"computed":false},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":1737,"end":1918,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1738,"end":1741,"name":"err"},{"type":"Identifier","start":1743,"end":1747,"name":"data"}],"body":{"type":"BlockStatement","start":1752,"end":1918,"body":[{"type":"IfStatement","start":1760,"end":1811,"test":{"type":"Identifier","start":1764,"end":1767,"name":"err"},"consequent":{"type":"BlockStatement","start":1769,"end":1811,"body":[{"type":"ExpressionStatement","start":1779,"end":1788,"expression":{"type":"CallExpression","start":1779,"end":1788,"callee":{"type":"Identifier","start":1779,"end":1783,"name":"next"},"arguments":[{"type":"Identifier","start":1784,"end":1787,"name":"err"}]}},{"type":"ReturnStatement","start":1797,"end":1803,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":1818,"end":1912,"expression":{"type":"CallExpression","start":1818,"end":1912,"callee":{"type":"MemberExpression","start":1818,"end":1826,"object":{"type":"Identifier","start":1818,"end":1821,"name":"res"},"property":{"type":"Identifier","start":1822,"end":1826,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":1827,"end":1911,"properties":[{"type":"Property","start":1837,"end":1851,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1837,"end":1843,"name":"method"},"value":{"type":"Literal","start":1845,"end":1851,"value":"post","raw":"'post'"},"kind":"init"},{"type":"Property","start":1861,"end":1874,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1861,"end":1864,"name":"url"},"value":{"type":"MemberExpression","start":1866,"end":1874,"object":{"type":"Identifier","start":1866,"end":1870,"name":"data"},"property":{"type":"Identifier","start":1871,"end":1874,"name":"url"},"computed":false},"kind":"init"},{"type":"Property","start":1884,"end":1903,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1884,"end":1890,"name":"fields"},"value":{"type":"MemberExpression","start":1892,"end":1903,"object":{"type":"Identifier","start":1892,"end":1896,"name":"data"},"property":{"type":"Identifier","start":1897,"end":1903,"name":"fields"},"computed":false},"kind":"init"}]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":2519,"end":3442,"id":{"type":"Identifier","start":2528,"end":2549,"name":"createMultipartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":2551,"end":2554,"name":"req"},{"type":"Identifier","start":2556,"end":2559,"name":"res"},{"type":"Identifier","start":2561,"end":2565,"name":"next"}],"body":{"type":"BlockStatement","start":2567,"end":3442,"body":[{"type":"VariableDeclaration","start":2661,"end":2698,"declarations":[{"type":"VariableDeclarator","start":2667,"end":2698,"id":{"type":"Identifier","start":2667,"end":2673,"name":"client"},"init":{"type":"MemberExpression","start":2676,"end":2698,"object":{"type":"MemberExpression","start":2676,"end":2689,"object":{"type":"Identifier","start":2676,"end":2679,"name":"req"},"property":{"type":"Identifier","start":2680,"end":2689,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":2690,"end":2698,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":2703,"end":2777,"declarations":[{"type":"VariableDeclarator","start":2709,"end":2777,"id":{"type":"Identifier","start":2709,"end":2712,"name":"key"},"init":{"type":"CallExpression","start":2715,"end":2777,"callee":{"type":"MemberExpression","start":2715,"end":2728,"object":{"type":"Identifier","start":2715,"end":2721,"name":"config"},"property":{"type":"Identifier","start":2722,"end":2728,"name":"getKey"},"computed":false},"arguments":[{"type":"Identifier","start":2729,"end":2732,"name":"req"},{"type":"MemberExpression","start":2734,"end":2751,"object":{"type":"MemberExpression","start":2734,"end":2742,"object":{"type":"Identifier","start":2734,"end":2737,"name":"req"},"property":{"type":"Identifier","start":2738,"end":2742,"name":"body"},"computed":false},"property":{"type":"Identifier","start":2743,"end":2751,"name":"filename"},"computed":false},{"type":"LogicalExpression","start":2753,"end":2776,"left":{"type":"MemberExpression","start":2753,"end":2770,"object":{"type":"MemberExpression","start":2753,"end":2761,"object":{"type":"Identifier","start":2753,"end":2756,"name":"req"},"property":{"type":"Identifier","start":2757,"end":2761,"name":"body"},"computed":false},"property":{"type":"Identifier","start":2762,"end":2770,"name":"metadata"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":2774,"end":2776,"properties":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","start":2782,"end":2817,"declarations":[{"type":"VariableDeclarator","start":2788,"end":2817,"id":{"type":"ObjectPattern","start":2788,"end":2806,"properties":[{"type":"Property","start":2790,"end":2794,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":2790,"end":2794,"name":"type"},"kind":"init","value":{"type":"Identifier","start":2790,"end":2794,"name":"type"}},{"type":"Property","start":2796,"end":2804,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":2796,"end":2804,"name":"metadata"},"kind":"init","value":{"type":"Identifier","start":2796,"end":2804,"name":"metadata"}}]},"init":{"type":"MemberExpression","start":2809,"end":2817,"object":{"type":"Identifier","start":2809,"end":2812,"name":"req"},"property":{"type":"Identifier","start":2813,"end":2817,"name":"body"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":2822,"end":2959,"test":{"type":"BinaryExpression","start":2826,"end":2849,"left":{"type":"UnaryExpression","start":2826,"end":2836,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":2833,"end":2836,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":2841,"end":2849,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":2851,"end":2959,"body":[{"type":"ReturnStatement","start":2859,"end":2953,"argument":{"type":"CallExpression","start":2866,"end":2953,"callee":{"type":"MemberExpression","start":2866,"end":2886,"object":{"type":"CallExpression","start":2866,"end":2881,"callee":{"type":"MemberExpression","start":2866,"end":2876,"object":{"type":"Identifier","start":2866,"end":2869,"name":"res"},"property":{"type":"Identifier","start":2870,"end":2876,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":2877,"end":2880,"value":500,"raw":"500"}]},"property":{"type":"Identifier","start":2882,"end":2886,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":2887,"end":2952,"properties":[{"type":"Property","start":2889,"end":2950,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":2889,"end":2894,"name":"error"},"value":{"type":"Literal","start":2896,"end":2950,"value":"s3: filename returned from `getKey` must be a string","raw":"'s3: filename returned from `getKey` must be a string'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"IfStatement","start":2964,"end":3083,"test":{"type":"BinaryExpression","start":2968,"end":2992,"left":{"type":"UnaryExpression","start":2968,"end":2979,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":2975,"end":2979,"name":"type"}},"operator":"!==","right":{"type":"Literal","start":2984,"end":2992,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":2994,"end":3083,"body":[{"type":"ReturnStatement","start":3002,"end":3077,"argument":{"type":"CallExpression","start":3009,"end":3077,"callee":{"type":"MemberExpression","start":3009,"end":3029,"object":{"type":"CallExpression","start":3009,"end":3024,"callee":{"type":"MemberExpression","start":3009,"end":3019,"object":{"type":"Identifier","start":3009,"end":3012,"name":"res"},"property":{"type":"Identifier","start":3013,"end":3019,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":3020,"end":3023,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":3025,"end":3029,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":3030,"end":3076,"properties":[{"type":"Property","start":3032,"end":3074,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3032,"end":3037,"name":"error"},"value":{"type":"Literal","start":3039,"end":3074,"value":"s3: content type must be a string","raw":"'s3: content type must be a string'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":3089,"end":3438,"expression":{"type":"CallExpression","start":3089,"end":3438,"callee":{"type":"MemberExpression","start":3089,"end":3117,"object":{"type":"Identifier","start":3089,"end":3095,"name":"client"},"property":{"type":"Identifier","start":3096,"end":3117,"name":"createMultipartUpload"},"computed":false},"arguments":[{"type":"ObjectExpression","start":3118,"end":3274,"properties":[{"type":"Property","start":3126,"end":3147,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3126,"end":3132,"name":"Bucket"},"value":{"type":"MemberExpression","start":3134,"end":3147,"object":{"type":"Identifier","start":3134,"end":3140,"name":"config"},"property":{"type":"Identifier","start":3141,"end":3147,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":3155,"end":3163,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3155,"end":3158,"name":"Key"},"value":{"type":"Identifier","start":3160,"end":3163,"name":"key"},"kind":"init"},{"type":"Property","start":3171,"end":3186,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3171,"end":3174,"name":"ACL"},"value":{"type":"MemberExpression","start":3176,"end":3186,"object":{"type":"Identifier","start":3176,"end":3182,"name":"config"},"property":{"type":"Identifier","start":3183,"end":3186,"name":"acl"},"computed":false},"kind":"init"},{"type":"Property","start":3194,"end":3211,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3194,"end":3205,"name":"ContentType"},"value":{"type":"Identifier","start":3207,"end":3211,"name":"type"},"kind":"init"},{"type":"Property","start":3219,"end":3237,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3219,"end":3227,"name":"Metadata"},"value":{"type":"Identifier","start":3229,"end":3237,"name":"metadata"},"kind":"init"},{"type":"Property","start":3245,"end":3268,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3245,"end":3252,"name":"Expires"},"value":{"type":"MemberExpression","start":3254,"end":3268,"object":{"type":"Identifier","start":3254,"end":3260,"name":"config"},"property":{"type":"Identifier","start":3261,"end":3268,"name":"expires"},"computed":false},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":3276,"end":3437,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":3277,"end":3280,"name":"err"},{"type":"Identifier","start":3282,"end":3286,"name":"data"}],"body":{"type":"BlockStatement","start":3291,"end":3437,"body":[{"type":"IfStatement","start":3299,"end":3350,"test":{"type":"Identifier","start":3303,"end":3306,"name":"err"},"consequent":{"type":"BlockStatement","start":3308,"end":3350,"body":[{"type":"ExpressionStatement","start":3318,"end":3327,"expression":{"type":"CallExpression","start":3318,"end":3327,"callee":{"type":"Identifier","start":3318,"end":3322,"name":"next"},"arguments":[{"type":"Identifier","start":3323,"end":3326,"name":"err"}]}},{"type":"ReturnStatement","start":3336,"end":3342,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":3357,"end":3431,"expression":{"type":"CallExpression","start":3357,"end":3431,"callee":{"type":"MemberExpression","start":3357,"end":3365,"object":{"type":"Identifier","start":3357,"end":3360,"name":"res"},"property":{"type":"Identifier","start":3361,"end":3365,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":3366,"end":3430,"properties":[{"type":"Property","start":3376,"end":3389,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3376,"end":3379,"name":"key"},"value":{"type":"MemberExpression","start":3381,"end":3389,"object":{"type":"Identifier","start":3381,"end":3385,"name":"data"},"property":{"type":"Identifier","start":3386,"end":3389,"name":"Key"},"computed":false},"kind":"init"},{"type":"Property","start":3399,"end":3422,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3399,"end":3407,"name":"uploadId"},"value":{"type":"MemberExpression","start":3409,"end":3422,"object":{"type":"Identifier","start":3409,"end":3413,"name":"data"},"property":{"type":"Identifier","start":3414,"end":3422,"name":"UploadId"},"computed":false},"kind":"init"}]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":3921,"end":4917,"id":{"type":"Identifier","start":3930,"end":3946,"name":"getUploadedParts"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":3948,"end":3951,"name":"req"},{"type":"Identifier","start":3953,"end":3956,"name":"res"},{"type":"Identifier","start":3958,"end":3962,"name":"next"}],"body":{"type":"BlockStatement","start":3964,"end":4917,"body":[{"type":"VariableDeclaration","start":4058,"end":4095,"declarations":[{"type":"VariableDeclarator","start":4064,"end":4095,"id":{"type":"Identifier","start":4064,"end":4070,"name":"client"},"init":{"type":"MemberExpression","start":4073,"end":4095,"object":{"type":"MemberExpression","start":4073,"end":4086,"object":{"type":"Identifier","start":4073,"end":4076,"name":"req"},"property":{"type":"Identifier","start":4077,"end":4086,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":4087,"end":4095,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":4100,"end":4131,"declarations":[{"type":"VariableDeclarator","start":4106,"end":4131,"id":{"type":"ObjectPattern","start":4106,"end":4118,"properties":[{"type":"Property","start":4108,"end":4116,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":4108,"end":4116,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":4108,"end":4116,"name":"uploadId"}}]},"init":{"type":"MemberExpression","start":4121,"end":4131,"object":{"type":"Identifier","start":4121,"end":4124,"name":"req"},"property":{"type":"Identifier","start":4125,"end":4131,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":4136,"end":4161,"declarations":[{"type":"VariableDeclarator","start":4142,"end":4161,"id":{"type":"ObjectPattern","start":4142,"end":4149,"properties":[{"type":"Property","start":4144,"end":4147,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":4144,"end":4147,"name":"key"},"kind":"init","value":{"type":"Identifier","start":4144,"end":4147,"name":"key"}}]},"init":{"type":"MemberExpression","start":4152,"end":4161,"object":{"type":"Identifier","start":4152,"end":4155,"name":"req"},"property":{"type":"Identifier","start":4156,"end":4161,"name":"query"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":4167,"end":4335,"test":{"type":"BinaryExpression","start":4171,"end":4194,"left":{"type":"UnaryExpression","start":4171,"end":4181,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":4178,"end":4181,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":4186,"end":4194,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":4196,"end":4335,"body":[{"type":"ReturnStatement","start":4204,"end":4329,"argument":{"type":"CallExpression","start":4211,"end":4329,"callee":{"type":"MemberExpression","start":4211,"end":4231,"object":{"type":"CallExpression","start":4211,"end":4226,"callee":{"type":"MemberExpression","start":4211,"end":4221,"object":{"type":"Identifier","start":4211,"end":4214,"name":"res"},"property":{"type":"Identifier","start":4215,"end":4221,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":4222,"end":4225,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":4227,"end":4231,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":4232,"end":4328,"properties":[{"type":"Property","start":4234,"end":4326,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4234,"end":4239,"name":"error"},"value":{"type":"Literal","start":4241,"end":4326,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"VariableDeclaration","start":4341,"end":4355,"declarations":[{"type":"VariableDeclarator","start":4345,"end":4355,"id":{"type":"Identifier","start":4345,"end":4350,"name":"parts"},"init":{"type":"ArrayExpression","start":4353,"end":4355,"elements":[]}}],"kind":"let"},{"type":"ExpressionStatement","start":4360,"end":4376,"expression":{"type":"CallExpression","start":4360,"end":4376,"callee":{"type":"Identifier","start":4360,"end":4373,"name":"listPartsPage"},"arguments":[{"type":"Literal","start":4374,"end":4375,"value":0,"raw":"0"}]}},{"type":"FunctionDeclaration","start":4382,"end":4861,"id":{"type":"Identifier","start":4391,"end":4404,"name":"listPartsPage"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":4406,"end":4413,"name":"startAt"}],"body":{"type":"BlockStatement","start":4415,"end":4861,"body":[{"type":"ExpressionStatement","start":4423,"end":4855,"expression":{"type":"CallExpression","start":4423,"end":4855,"callee":{"type":"MemberExpression","start":4423,"end":4439,"object":{"type":"Identifier","start":4423,"end":4429,"name":"client"},"property":{"type":"Identifier","start":4430,"end":4439,"name":"listParts"},"computed":false},"arguments":[{"type":"ObjectExpression","start":4440,"end":4560,"properties":[{"type":"Property","start":4450,"end":4471,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4450,"end":4456,"name":"Bucket"},"value":{"type":"MemberExpression","start":4458,"end":4471,"object":{"type":"Identifier","start":4458,"end":4464,"name":"config"},"property":{"type":"Identifier","start":4465,"end":4471,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":4481,"end":4489,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4481,"end":4484,"name":"Key"},"value":{"type":"Identifier","start":4486,"end":4489,"name":"key"},"kind":"init"},{"type":"Property","start":4499,"end":4517,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4499,"end":4507,"name":"UploadId"},"value":{"type":"Identifier","start":4509,"end":4517,"name":"uploadId"},"kind":"init"},{"type":"Property","start":4527,"end":4552,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4527,"end":4543,"name":"PartNumberMarker"},"value":{"type":"Identifier","start":4545,"end":4552,"name":"startAt"},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":4562,"end":4854,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":4563,"end":4566,"name":"err"},{"type":"Identifier","start":4568,"end":4572,"name":"data"}],"body":{"type":"BlockStatement","start":4577,"end":4854,"body":[{"type":"IfStatement","start":4587,"end":4644,"test":{"type":"Identifier","start":4591,"end":4594,"name":"err"},"consequent":{"type":"BlockStatement","start":4596,"end":4644,"body":[{"type":"ExpressionStatement","start":4608,"end":4617,"expression":{"type":"CallExpression","start":4608,"end":4617,"callee":{"type":"Identifier","start":4608,"end":4612,"name":"next"},"arguments":[{"type":"Identifier","start":4613,"end":4616,"name":"err"}]}},{"type":"ReturnStatement","start":4628,"end":4634,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":4654,"end":4686,"expression":{"type":"AssignmentExpression","start":4654,"end":4686,"operator":"=","left":{"type":"Identifier","start":4654,"end":4659,"name":"parts"},"right":{"type":"CallExpression","start":4662,"end":4686,"callee":{"type":"MemberExpression","start":4662,"end":4674,"object":{"type":"Identifier","start":4662,"end":4667,"name":"parts"},"property":{"type":"Identifier","start":4668,"end":4674,"name":"concat"},"computed":false},"arguments":[{"type":"MemberExpression","start":4675,"end":4685,"object":{"type":"Identifier","start":4675,"end":4679,"name":"data"},"property":{"type":"Identifier","start":4680,"end":4685,"name":"Parts"},"computed":false}]}}},{"type":"IfStatement","start":4696,"end":4846,"test":{"type":"MemberExpression","start":4700,"end":4716,"object":{"type":"Identifier","start":4700,"end":4704,"name":"data"},"property":{"type":"Identifier","start":4705,"end":4716,"name":"IsTruncated"},"computed":false},"consequent":{"type":"BlockStatement","start":4718,"end":4812,"body":[{"type":"ExpressionStatement","start":4762,"end":4802,"expression":{"type":"CallExpression","start":4762,"end":4802,"callee":{"type":"Identifier","start":4762,"end":4775,"name":"listPartsPage"},"arguments":[{"type":"MemberExpression","start":4776,"end":4801,"object":{"type":"Identifier","start":4776,"end":4780,"name":"data"},"property":{"type":"Identifier","start":4781,"end":4801,"name":"NextPartNumberMarker"},"computed":false}]}}]},"alternate":{"type":"BlockStatement","start":4818,"end":4846,"body":[{"type":"ExpressionStatement","start":4830,"end":4836,"expression":{"type":"CallExpression","start":4830,"end":4836,"callee":{"type":"Identifier","start":4830,"end":4834,"name":"done"},"arguments":[]}}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":4867,"end":4913,"id":{"type":"Identifier","start":4876,"end":4880,"name":"done"},"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":4884,"end":4913,"body":[{"type":"ExpressionStatement","start":4892,"end":4907,"expression":{"type":"CallExpression","start":4892,"end":4907,"callee":{"type":"MemberExpression","start":4892,"end":4900,"object":{"type":"Identifier","start":4892,"end":4895,"name":"res"},"property":{"type":"Identifier","start":4896,"end":4900,"name":"json"},"computed":false},"arguments":[{"type":"Identifier","start":4901,"end":4906,"name":"parts"}]}}]}}]}},{"type":"FunctionDeclaration","start":5315,"end":6192,"id":{"type":"Identifier","start":5324,"end":5338,"name":"signPartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":5340,"end":5343,"name":"req"},{"type":"Identifier","start":5345,"end":5348,"name":"res"},{"type":"Identifier","start":5350,"end":5354,"name":"next"}],"body":{"type":"BlockStatement","start":5356,"end":6192,"body":[{"type":"VariableDeclaration","start":5450,"end":5487,"declarations":[{"type":"VariableDeclarator","start":5456,"end":5487,"id":{"type":"Identifier","start":5456,"end":5462,"name":"client"},"init":{"type":"MemberExpression","start":5465,"end":5487,"object":{"type":"MemberExpression","start":5465,"end":5478,"object":{"type":"Identifier","start":5465,"end":5468,"name":"req"},"property":{"type":"Identifier","start":5469,"end":5478,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":5479,"end":5487,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":5492,"end":5535,"declarations":[{"type":"VariableDeclarator","start":5498,"end":5535,"id":{"type":"ObjectPattern","start":5498,"end":5522,"properties":[{"type":"Property","start":5500,"end":5508,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":5500,"end":5508,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":5500,"end":5508,"name":"uploadId"}},{"type":"Property","start":5510,"end":5520,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":5510,"end":5520,"name":"partNumber"},"kind":"init","value":{"type":"Identifier","start":5510,"end":5520,"name":"partNumber"}}]},"init":{"type":"MemberExpression","start":5525,"end":5535,"object":{"type":"Identifier","start":5525,"end":5528,"name":"req"},"property":{"type":"Identifier","start":5529,"end":5535,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":5540,"end":5565,"declarations":[{"type":"VariableDeclarator","start":5546,"end":5565,"id":{"type":"ObjectPattern","start":5546,"end":5553,"properties":[{"type":"Property","start":5548,"end":5551,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":5548,"end":5551,"name":"key"},"kind":"init","value":{"type":"Identifier","start":5548,"end":5551,"name":"key"}}]},"init":{"type":"MemberExpression","start":5556,"end":5565,"object":{"type":"Identifier","start":5556,"end":5559,"name":"req"},"property":{"type":"Identifier","start":5560,"end":5565,"name":"query"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":5571,"end":5739,"test":{"type":"BinaryExpression","start":5575,"end":5598,"left":{"type":"UnaryExpression","start":5575,"end":5585,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":5582,"end":5585,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":5590,"end":5598,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":5600,"end":5739,"body":[{"type":"ReturnStatement","start":5608,"end":5733,"argument":{"type":"CallExpression","start":5615,"end":5733,"callee":{"type":"MemberExpression","start":5615,"end":5635,"object":{"type":"CallExpression","start":5615,"end":5630,"callee":{"type":"MemberExpression","start":5615,"end":5625,"object":{"type":"Identifier","start":5615,"end":5618,"name":"res"},"property":{"type":"Identifier","start":5619,"end":5625,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":5626,"end":5629,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":5631,"end":5635,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":5636,"end":5732,"properties":[{"type":"Property","start":5638,"end":5730,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":5638,"end":5643,"name":"error"},"value":{"type":"Literal","start":5645,"end":5730,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"IfStatement","start":5744,"end":5888,"test":{"type":"UnaryExpression","start":5748,"end":5773,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":5749,"end":5773,"callee":{"type":"Identifier","start":5749,"end":5757,"name":"parseInt"},"arguments":[{"type":"Identifier","start":5758,"end":5768,"name":"partNumber"},{"type":"Literal","start":5770,"end":5772,"value":10,"raw":"10"}]}},"consequent":{"type":"BlockStatement","start":5775,"end":5888,"body":[{"type":"ReturnStatement","start":5783,"end":5882,"argument":{"type":"CallExpression","start":5790,"end":5882,"callee":{"type":"MemberExpression","start":5790,"end":5810,"object":{"type":"CallExpression","start":5790,"end":5805,"callee":{"type":"MemberExpression","start":5790,"end":5800,"object":{"type":"Identifier","start":5790,"end":5793,"name":"res"},"property":{"type":"Identifier","start":5794,"end":5800,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":5801,"end":5804,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":5806,"end":5810,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":5811,"end":5881,"properties":[{"type":"Property","start":5813,"end":5879,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":5813,"end":5818,"name":"error"},"value":{"type":"Literal","start":5820,"end":5879,"value":"s3: the part number must be a number between 1 and 10000.","raw":"'s3: the part number must be a number between 1 and 10000.'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":5894,"end":6188,"expression":{"type":"CallExpression","start":5894,"end":6188,"callee":{"type":"MemberExpression","start":5894,"end":5913,"object":{"type":"Identifier","start":5894,"end":5900,"name":"client"},"property":{"type":"Identifier","start":5901,"end":5913,"name":"getSignedUrl"},"computed":false},"arguments":[{"type":"Literal","start":5914,"end":5926,"value":"uploadPart","raw":"'uploadPart'"},{"type":"ObjectExpression","start":5928,"end":6082,"properties":[{"type":"Property","start":5936,"end":5957,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":5936,"end":5942,"name":"Bucket"},"value":{"type":"MemberExpression","start":5944,"end":5957,"object":{"type":"Identifier","start":5944,"end":5950,"name":"config"},"property":{"type":"Identifier","start":5951,"end":5957,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":5965,"end":5973,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":5965,"end":5968,"name":"Key"},"value":{"type":"Identifier","start":5970,"end":5973,"name":"key"},"kind":"init"},{"type":"Property","start":5981,"end":5999,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":5981,"end":5989,"name":"UploadId"},"value":{"type":"Identifier","start":5991,"end":5999,"name":"uploadId"},"kind":"init"},{"type":"Property","start":6007,"end":6029,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6007,"end":6017,"name":"PartNumber"},"value":{"type":"Identifier","start":6019,"end":6029,"name":"partNumber"},"kind":"init"},{"type":"Property","start":6037,"end":6045,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6037,"end":6041,"name":"Body"},"value":{"type":"Literal","start":6043,"end":6045,"value":"","raw":"''"},"kind":"init"},{"type":"Property","start":6053,"end":6076,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6053,"end":6060,"name":"Expires"},"value":{"type":"MemberExpression","start":6062,"end":6076,"object":{"type":"Identifier","start":6062,"end":6068,"name":"config"},"property":{"type":"Identifier","start":6069,"end":6076,"name":"expires"},"computed":false},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":6084,"end":6187,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":6085,"end":6088,"name":"err"},{"type":"Identifier","start":6090,"end":6093,"name":"url"}],"body":{"type":"BlockStatement","start":6098,"end":6187,"body":[{"type":"IfStatement","start":6106,"end":6157,"test":{"type":"Identifier","start":6110,"end":6113,"name":"err"},"consequent":{"type":"BlockStatement","start":6115,"end":6157,"body":[{"type":"ExpressionStatement","start":6125,"end":6134,"expression":{"type":"CallExpression","start":6125,"end":6134,"callee":{"type":"Identifier","start":6125,"end":6129,"name":"next"},"arguments":[{"type":"Identifier","start":6130,"end":6133,"name":"err"}]}},{"type":"ReturnStatement","start":6143,"end":6149,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":6164,"end":6181,"expression":{"type":"CallExpression","start":6164,"end":6181,"callee":{"type":"MemberExpression","start":6164,"end":6172,"object":{"type":"Identifier","start":6164,"end":6167,"name":"res"},"property":{"type":"Identifier","start":6168,"end":6172,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":6173,"end":6180,"properties":[{"type":"Property","start":6175,"end":6178,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":6175,"end":6178,"name":"url"},"kind":"init","value":{"type":"Identifier","start":6175,"end":6178,"name":"url"}}]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":6491,"end":7126,"id":{"type":"Identifier","start":6500,"end":6520,"name":"abortMultipartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":6522,"end":6525,"name":"req"},{"type":"Identifier","start":6527,"end":6530,"name":"res"},{"type":"Identifier","start":6532,"end":6536,"name":"next"}],"body":{"type":"BlockStatement","start":6538,"end":7126,"body":[{"type":"VariableDeclaration","start":6632,"end":6669,"declarations":[{"type":"VariableDeclarator","start":6638,"end":6669,"id":{"type":"Identifier","start":6638,"end":6644,"name":"client"},"init":{"type":"MemberExpression","start":6647,"end":6669,"object":{"type":"MemberExpression","start":6647,"end":6660,"object":{"type":"Identifier","start":6647,"end":6650,"name":"req"},"property":{"type":"Identifier","start":6651,"end":6660,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":6661,"end":6669,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":6674,"end":6705,"declarations":[{"type":"VariableDeclarator","start":6680,"end":6705,"id":{"type":"ObjectPattern","start":6680,"end":6692,"properties":[{"type":"Property","start":6682,"end":6690,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":6682,"end":6690,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":6682,"end":6690,"name":"uploadId"}}]},"init":{"type":"MemberExpression","start":6695,"end":6705,"object":{"type":"Identifier","start":6695,"end":6698,"name":"req"},"property":{"type":"Identifier","start":6699,"end":6705,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":6710,"end":6735,"declarations":[{"type":"VariableDeclarator","start":6716,"end":6735,"id":{"type":"ObjectPattern","start":6716,"end":6723,"properties":[{"type":"Property","start":6718,"end":6721,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":6718,"end":6721,"name":"key"},"kind":"init","value":{"type":"Identifier","start":6718,"end":6721,"name":"key"}}]},"init":{"type":"MemberExpression","start":6726,"end":6735,"object":{"type":"Identifier","start":6726,"end":6729,"name":"req"},"property":{"type":"Identifier","start":6730,"end":6735,"name":"query"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":6741,"end":6909,"test":{"type":"BinaryExpression","start":6745,"end":6768,"left":{"type":"UnaryExpression","start":6745,"end":6755,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":6752,"end":6755,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":6760,"end":6768,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":6770,"end":6909,"body":[{"type":"ReturnStatement","start":6778,"end":6903,"argument":{"type":"CallExpression","start":6785,"end":6903,"callee":{"type":"MemberExpression","start":6785,"end":6805,"object":{"type":"CallExpression","start":6785,"end":6800,"callee":{"type":"MemberExpression","start":6785,"end":6795,"object":{"type":"Identifier","start":6785,"end":6788,"name":"res"},"property":{"type":"Identifier","start":6789,"end":6795,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":6796,"end":6799,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":6801,"end":6805,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":6806,"end":6902,"properties":[{"type":"Property","start":6808,"end":6900,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6808,"end":6813,"name":"error"},"value":{"type":"Literal","start":6815,"end":6900,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":6915,"end":7122,"expression":{"type":"CallExpression","start":6915,"end":7122,"callee":{"type":"MemberExpression","start":6915,"end":6942,"object":{"type":"Identifier","start":6915,"end":6921,"name":"client"},"property":{"type":"Identifier","start":6922,"end":6942,"name":"abortMultipartUpload"},"computed":false},"arguments":[{"type":"ObjectExpression","start":6943,"end":7020,"properties":[{"type":"Property","start":6951,"end":6972,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6951,"end":6957,"name":"Bucket"},"value":{"type":"MemberExpression","start":6959,"end":6972,"object":{"type":"Identifier","start":6959,"end":6965,"name":"config"},"property":{"type":"Identifier","start":6966,"end":6972,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":6980,"end":6988,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6980,"end":6983,"name":"Key"},"value":{"type":"Identifier","start":6985,"end":6988,"name":"key"},"kind":"init"},{"type":"Property","start":6996,"end":7014,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6996,"end":7004,"name":"UploadId"},"value":{"type":"Identifier","start":7006,"end":7014,"name":"uploadId"},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":7022,"end":7121,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":7023,"end":7026,"name":"err"},{"type":"Identifier","start":7028,"end":7032,"name":"data"}],"body":{"type":"BlockStatement","start":7037,"end":7121,"body":[{"type":"IfStatement","start":7045,"end":7096,"test":{"type":"Identifier","start":7049,"end":7052,"name":"err"},"consequent":{"type":"BlockStatement","start":7054,"end":7096,"body":[{"type":"ExpressionStatement","start":7064,"end":7073,"expression":{"type":"CallExpression","start":7064,"end":7073,"callee":{"type":"Identifier","start":7064,"end":7068,"name":"next"},"arguments":[{"type":"Identifier","start":7069,"end":7072,"name":"err"}]}},{"type":"ReturnStatement","start":7082,"end":7088,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":7103,"end":7115,"expression":{"type":"CallExpression","start":7103,"end":7115,"callee":{"type":"MemberExpression","start":7103,"end":7111,"object":{"type":"Identifier","start":7103,"end":7106,"name":"res"},"property":{"type":"Identifier","start":7107,"end":7111,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":7112,"end":7114,"properties":[]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":7610,"end":8552,"id":{"type":"Identifier","start":7619,"end":7642,"name":"completeMultipartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":7644,"end":7647,"name":"req"},{"type":"Identifier","start":7649,"end":7652,"name":"res"},{"type":"Identifier","start":7654,"end":7658,"name":"next"}],"body":{"type":"BlockStatement","start":7660,"end":8552,"body":[{"type":"VariableDeclaration","start":7754,"end":7791,"declarations":[{"type":"VariableDeclarator","start":7760,"end":7791,"id":{"type":"Identifier","start":7760,"end":7766,"name":"client"},"init":{"type":"MemberExpression","start":7769,"end":7791,"object":{"type":"MemberExpression","start":7769,"end":7782,"object":{"type":"Identifier","start":7769,"end":7772,"name":"req"},"property":{"type":"Identifier","start":7773,"end":7782,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":7783,"end":7791,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":7796,"end":7827,"declarations":[{"type":"VariableDeclarator","start":7802,"end":7827,"id":{"type":"ObjectPattern","start":7802,"end":7814,"properties":[{"type":"Property","start":7804,"end":7812,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":7804,"end":7812,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":7804,"end":7812,"name":"uploadId"}}]},"init":{"type":"MemberExpression","start":7817,"end":7827,"object":{"type":"Identifier","start":7817,"end":7820,"name":"req"},"property":{"type":"Identifier","start":7821,"end":7827,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":7832,"end":7857,"declarations":[{"type":"VariableDeclarator","start":7838,"end":7857,"id":{"type":"ObjectPattern","start":7838,"end":7845,"properties":[{"type":"Property","start":7840,"end":7843,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":7840,"end":7843,"name":"key"},"kind":"init","value":{"type":"Identifier","start":7840,"end":7843,"name":"key"}}]},"init":{"type":"MemberExpression","start":7848,"end":7857,"object":{"type":"Identifier","start":7848,"end":7851,"name":"req"},"property":{"type":"Identifier","start":7852,"end":7857,"name":"query"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":7862,"end":7888,"declarations":[{"type":"VariableDeclarator","start":7868,"end":7888,"id":{"type":"ObjectPattern","start":7868,"end":7877,"properties":[{"type":"Property","start":7870,"end":7875,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":7870,"end":7875,"name":"parts"},"kind":"init","value":{"type":"Identifier","start":7870,"end":7875,"name":"parts"}}]},"init":{"type":"MemberExpression","start":7880,"end":7888,"object":{"type":"Identifier","start":7880,"end":7883,"name":"req"},"property":{"type":"Identifier","start":7884,"end":7888,"name":"body"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":7894,"end":8062,"test":{"type":"BinaryExpression","start":7898,"end":7921,"left":{"type":"UnaryExpression","start":7898,"end":7908,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":7905,"end":7908,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":7913,"end":7921,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":7923,"end":8062,"body":[{"type":"ReturnStatement","start":7931,"end":8056,"argument":{"type":"CallExpression","start":7938,"end":8056,"callee":{"type":"MemberExpression","start":7938,"end":7958,"object":{"type":"CallExpression","start":7938,"end":7953,"callee":{"type":"MemberExpression","start":7938,"end":7948,"object":{"type":"Identifier","start":7938,"end":7941,"name":"res"},"property":{"type":"Identifier","start":7942,"end":7948,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":7949,"end":7952,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":7954,"end":7958,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":7959,"end":8055,"properties":[{"type":"Property","start":7961,"end":8053,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":7961,"end":7966,"name":"error"},"value":{"type":"Literal","start":7968,"end":8053,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"IfStatement","start":8067,"end":8238,"test":{"type":"LogicalExpression","start":8071,"end":8121,"left":{"type":"UnaryExpression","start":8071,"end":8092,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":8072,"end":8092,"callee":{"type":"MemberExpression","start":8072,"end":8085,"object":{"type":"Identifier","start":8072,"end":8077,"name":"Array"},"property":{"type":"Identifier","start":8078,"end":8085,"name":"isArray"},"computed":false},"arguments":[{"type":"Identifier","start":8086,"end":8091,"name":"parts"}]}},"operator":"||","right":{"type":"UnaryExpression","start":8096,"end":8121,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":8097,"end":8121,"callee":{"type":"MemberExpression","start":8097,"end":8108,"object":{"type":"Identifier","start":8097,"end":8102,"name":"parts"},"property":{"type":"Identifier","start":8103,"end":8108,"name":"every"},"computed":false},"arguments":[{"type":"Identifier","start":8109,"end":8120,"name":"isValidPart"}]}}},"consequent":{"type":"BlockStatement","start":8123,"end":8238,"body":[{"type":"ReturnStatement","start":8131,"end":8232,"argument":{"type":"CallExpression","start":8138,"end":8232,"callee":{"type":"MemberExpression","start":8138,"end":8158,"object":{"type":"CallExpression","start":8138,"end":8153,"callee":{"type":"MemberExpression","start":8138,"end":8148,"object":{"type":"Identifier","start":8138,"end":8141,"name":"res"},"property":{"type":"Identifier","start":8142,"end":8148,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":8149,"end":8152,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":8154,"end":8158,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":8159,"end":8231,"properties":[{"type":"Property","start":8161,"end":8229,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8161,"end":8166,"name":"error"},"value":{"type":"Literal","start":8168,"end":8229,"value":"s3: `parts` must be an array of {ETag, PartNumber} objects.","raw":"'s3: `parts` must be an array of {ETag, PartNumber} objects.'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":8244,"end":8548,"expression":{"type":"CallExpression","start":8244,"end":8548,"callee":{"type":"MemberExpression","start":8244,"end":8274,"object":{"type":"Identifier","start":8244,"end":8250,"name":"client"},"property":{"type":"Identifier","start":8251,"end":8274,"name":"completeMultipartUpload"},"computed":false},"arguments":[{"type":"ObjectExpression","start":8275,"end":8407,"properties":[{"type":"Property","start":8283,"end":8304,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8283,"end":8289,"name":"Bucket"},"value":{"type":"MemberExpression","start":8291,"end":8304,"object":{"type":"Identifier","start":8291,"end":8297,"name":"config"},"property":{"type":"Identifier","start":8298,"end":8304,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":8312,"end":8320,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8312,"end":8315,"name":"Key"},"value":{"type":"Identifier","start":8317,"end":8320,"name":"key"},"kind":"init"},{"type":"Property","start":8328,"end":8346,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8328,"end":8336,"name":"UploadId"},"value":{"type":"Identifier","start":8338,"end":8346,"name":"uploadId"},"kind":"init"},{"type":"Property","start":8354,"end":8401,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8354,"end":8369,"name":"MultipartUpload"},"value":{"type":"ObjectExpression","start":8371,"end":8401,"properties":[{"type":"Property","start":8381,"end":8393,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8381,"end":8386,"name":"Parts"},"value":{"type":"Identifier","start":8388,"end":8393,"name":"parts"},"kind":"init"}]},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":8409,"end":8547,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":8410,"end":8413,"name":"err"},{"type":"Identifier","start":8415,"end":8419,"name":"data"}],"body":{"type":"BlockStatement","start":8424,"end":8547,"body":[{"type":"IfStatement","start":8432,"end":8483,"test":{"type":"Identifier","start":8436,"end":8439,"name":"err"},"consequent":{"type":"BlockStatement","start":8441,"end":8483,"body":[{"type":"ExpressionStatement","start":8451,"end":8460,"expression":{"type":"CallExpression","start":8451,"end":8460,"callee":{"type":"Identifier","start":8451,"end":8455,"name":"next"},"arguments":[{"type":"Identifier","start":8456,"end":8459,"name":"err"}]}},{"type":"ReturnStatement","start":8469,"end":8475,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":8490,"end":8541,"expression":{"type":"CallExpression","start":8490,"end":8541,"callee":{"type":"MemberExpression","start":8490,"end":8498,"object":{"type":"Identifier","start":8490,"end":8493,"name":"res"},"property":{"type":"Identifier","start":8494,"end":8498,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":8499,"end":8540,"properties":[{"type":"Property","start":8509,"end":8532,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8509,"end":8517,"name":"location"},"value":{"type":"MemberExpression","start":8519,"end":8532,"object":{"type":"Identifier","start":8519,"end":8523,"name":"data"},"property":{"type":"Identifier","start":8524,"end":8532,"name":"Location"},"computed":false},"kind":"init"}]}]}}]}}]}}]}},{"type":"ReturnStatement","start":8556,"end":8897,"argument":{"type":"CallExpression","start":8563,"end":8897,"callee":{"type":"MemberExpression","start":8563,"end":8851,"object":{"type":"CallExpression","start":8563,"end":8839,"callee":{"type":"MemberExpression","start":8563,"end":8781,"object":{"type":"CallExpression","start":8563,"end":8771,"callee":{"type":"MemberExpression","start":8563,"end":8719,"object":{"type":"CallExpression","start":8563,"end":8710,"callee":{"type":"MemberExpression","start":8563,"end":8668,"object":{"type":"CallExpression","start":8563,"end":8659,"callee":{"type":"MemberExpression","start":8563,"end":8622,"object":{"type":"CallExpression","start":8563,"end":8612,"callee":{"type":"MemberExpression","start":8563,"end":8580,"object":{"type":"CallExpression","start":8563,"end":8571,"callee":{"type":"Identifier","start":8563,"end":8569,"name":"router"},"arguments":[]},"property":{"type":"Identifier","start":8577,"end":8580,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":8581,"end":8590,"value":"/params","raw":"'/params'"},{"type":"Identifier","start":8592,"end":8611,"name":"getUploadParameters"}]},"property":{"type":"Identifier","start":8618,"end":8622,"name":"post"},"computed":false},"arguments":[{"type":"Literal","start":8623,"end":8635,"value":"/multipart","raw":"'/multipart'"},{"type":"Identifier","start":8637,"end":8658,"name":"createMultipartUpload"}]},"property":{"type":"Identifier","start":8665,"end":8668,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":8669,"end":8691,"value":"/multipart/:uploadId","raw":"'/multipart/:uploadId'"},{"type":"Identifier","start":8693,"end":8709,"name":"getUploadedParts"}]},"property":{"type":"Identifier","start":8716,"end":8719,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":8720,"end":8754,"value":"/multipart/:uploadId/:partNumber","raw":"'/multipart/:uploadId/:partNumber'"},{"type":"Identifier","start":8756,"end":8770,"name":"signPartUpload"}]},"property":{"type":"Identifier","start":8777,"end":8781,"name":"post"},"computed":false},"arguments":[{"type":"Literal","start":8782,"end":8813,"value":"/multipart/:uploadId/complete","raw":"'/multipart/:uploadId/complete'"},{"type":"Identifier","start":8815,"end":8838,"name":"completeMultipartUpload"}]},"property":{"type":"Identifier","start":8845,"end":8851,"name":"delete"},"computed":false},"arguments":[{"type":"Literal","start":8852,"end":8874,"value":"/multipart/:uploadId","raw":"'/multipart/:uploadId'"},{"type":"Identifier","start":8876,"end":8896,"name":"abortMultipartUpload"}]}}]}}}},{"type":"FunctionDeclaration","start":8901,"end":9046,"id":{"type":"Identifier","start":8910,"end":8921,"name":"isValidPart"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":8923,"end":8927,"name":"part"}],"body":{"type":"BlockStatement","start":8929,"end":9046,"body":[{"type":"ReturnStatement","start":8933,"end":9044,"argument":{"type":"LogicalExpression","start":8940,"end":9044,"left":{"type":"LogicalExpression","start":8940,"end":9011,"left":{"type":"LogicalExpression","start":8940,"end":8972,"left":{"type":"Identifier","start":8940,"end":8944,"name":"part"},"operator":"&&","right":{"type":"BinaryExpression","start":8948,"end":8972,"left":{"type":"UnaryExpression","start":8948,"end":8959,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":8955,"end":8959,"name":"part"}},"operator":"===","right":{"type":"Literal","start":8964,"end":8972,"value":"object","raw":"'object'"}}},"operator":"&&","right":{"type":"BinaryExpression","start":8976,"end":9011,"left":{"type":"UnaryExpression","start":8976,"end":8998,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":8983,"end":8998,"object":{"type":"Identifier","start":8983,"end":8987,"name":"part"},"property":{"type":"Identifier","start":8988,"end":8998,"name":"PartNumber"},"computed":false}},"operator":"===","right":{"type":"Literal","start":9003,"end":9011,"value":"number","raw":"'number'"}}},"operator":"&&","right":{"type":"BinaryExpression","start":9015,"end":9044,"left":{"type":"UnaryExpression","start":9015,"end":9031,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":9022,"end":9031,"object":{"type":"Identifier","start":9022,"end":9026,"name":"part"},"property":{"type":"Identifier","start":9027,"end":9031,"name":"ETag"},"computed":false}},"operator":"===","right":{"type":"Literal","start":9036,"end":9044,"value":"string","raw":"'string'"}}}}]}}],"sourceType":"script"}