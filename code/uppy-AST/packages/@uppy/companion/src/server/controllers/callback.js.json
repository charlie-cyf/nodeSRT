{"type":"Program","start":0,"end":1100,"body":[{"type":"VariableDeclaration","start":97,"end":143,"declarations":[{"type":"VariableDeclarator","start":103,"end":143,"id":{"type":"Identifier","start":103,"end":115,"name":"tokenService"},"init":{"type":"CallExpression","start":118,"end":143,"callee":{"type":"Identifier","start":118,"end":125,"name":"require"},"arguments":[{"type":"Literal","start":126,"end":142,"value":"../helpers/jwt","raw":"'../helpers/jwt'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":144,"end":179,"declarations":[{"type":"VariableDeclarator","start":150,"end":179,"id":{"type":"Identifier","start":150,"end":156,"name":"logger"},"init":{"type":"CallExpression","start":159,"end":179,"callee":{"type":"Identifier","start":159,"end":166,"name":"require"},"arguments":[{"type":"Literal","start":167,"end":178,"value":"../logger","raw":"'../logger'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":264,"end":1099,"expression":{"type":"AssignmentExpression","start":264,"end":1099,"operator":"=","left":{"type":"MemberExpression","start":264,"end":278,"object":{"type":"Identifier","start":264,"end":270,"name":"module"},"property":{"type":"Identifier","start":271,"end":278,"name":"exports"},"computed":false},"right":{"type":"FunctionExpression","start":281,"end":1099,"id":{"type":"Identifier","start":290,"end":298,"name":"callback"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":300,"end":303,"name":"req"},{"type":"Identifier","start":305,"end":308,"name":"res"},{"type":"Identifier","start":310,"end":314,"name":"next"}],"body":{"type":"BlockStatement","start":316,"end":1099,"body":[{"type":"VariableDeclaration","start":320,"end":364,"declarations":[{"type":"VariableDeclarator","start":326,"end":364,"id":{"type":"Identifier","start":326,"end":338,"name":"providerName"},"init":{"type":"MemberExpression","start":341,"end":364,"object":{"type":"MemberExpression","start":341,"end":351,"object":{"type":"Identifier","start":341,"end":344,"name":"req"},"property":{"type":"Identifier","start":345,"end":351,"name":"params"},"computed":false},"property":{"type":"Identifier","start":352,"end":364,"name":"providerName"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":368,"end":446,"test":{"type":"UnaryExpression","start":372,"end":401,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":373,"end":401,"object":{"type":"MemberExpression","start":373,"end":386,"object":{"type":"Identifier","start":373,"end":376,"name":"req"},"property":{"type":"Identifier","start":377,"end":386,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":387,"end":401,"name":"providerTokens"},"computed":false}},"consequent":{"type":"BlockStatement","start":403,"end":446,"body":[{"type":"ExpressionStatement","start":409,"end":442,"expression":{"type":"AssignmentExpression","start":409,"end":442,"operator":"=","left":{"type":"MemberExpression","start":409,"end":437,"object":{"type":"MemberExpression","start":409,"end":422,"object":{"type":"Identifier","start":409,"end":412,"name":"req"},"property":{"type":"Identifier","start":413,"end":422,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":423,"end":437,"name":"providerTokens"},"computed":false},"right":{"type":"ObjectExpression","start":440,"end":442,"properties":[]}}}]},"alternate":null},{"type":"IfStatement","start":450,"end":903,"test":{"type":"MemberExpression","start":454,"end":493,"object":{"type":"MemberExpression","start":454,"end":480,"object":{"type":"MemberExpression","start":454,"end":471,"object":{"type":"MemberExpression","start":454,"end":465,"object":{"type":"Identifier","start":454,"end":457,"name":"req"},"property":{"type":"Identifier","start":458,"end":465,"name":"session"},"computed":false},"property":{"type":"Identifier","start":466,"end":471,"name":"grant"},"computed":false},"property":{"type":"Identifier","start":472,"end":480,"name":"response"},"computed":false},"property":{"type":"Identifier","start":481,"end":493,"name":"access_token"},"computed":false},"consequent":{"type":"BlockStatement","start":495,"end":903,"body":[{"type":"ExpressionStatement","start":501,"end":585,"expression":{"type":"AssignmentExpression","start":501,"end":585,"operator":"=","left":{"type":"MemberExpression","start":501,"end":543,"object":{"type":"MemberExpression","start":501,"end":529,"object":{"type":"MemberExpression","start":501,"end":514,"object":{"type":"Identifier","start":501,"end":504,"name":"req"},"property":{"type":"Identifier","start":505,"end":514,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":515,"end":529,"name":"providerTokens"},"computed":false},"property":{"type":"Identifier","start":530,"end":542,"name":"providerName"},"computed":true},"right":{"type":"MemberExpression","start":546,"end":585,"object":{"type":"MemberExpression","start":546,"end":572,"object":{"type":"MemberExpression","start":546,"end":563,"object":{"type":"MemberExpression","start":546,"end":557,"object":{"type":"Identifier","start":546,"end":549,"name":"req"},"property":{"type":"Identifier","start":550,"end":557,"name":"session"},"computed":false},"property":{"type":"Identifier","start":558,"end":563,"name":"grant"},"computed":false},"property":{"type":"Identifier","start":564,"end":572,"name":"response"},"computed":false},"property":{"type":"Identifier","start":573,"end":585,"name":"access_token"},"computed":false}}},{"type":"ExpressionStatement","start":590,"end":670,"expression":{"type":"CallExpression","start":590,"end":670,"callee":{"type":"MemberExpression","start":590,"end":602,"object":{"type":"Identifier","start":590,"end":596,"name":"logger"},"property":{"type":"Identifier","start":597,"end":602,"name":"debug"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":603,"end":655,"expressions":[{"type":"Identifier","start":641,"end":653,"name":"providerName"}],"quasis":[{"type":"TemplateElement","start":604,"end":639,"value":{"raw":"Generating auth token for provider ","cooked":"Generating auth token for provider "},"tail":false},{"type":"TemplateElement","start":654,"end":654,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":657,"end":661,"value":null,"raw":"null"},{"type":"MemberExpression","start":663,"end":669,"object":{"type":"Identifier","start":663,"end":666,"name":"req"},"property":{"type":"Identifier","start":667,"end":669,"name":"id"},"computed":false}]}},{"type":"VariableDeclaration","start":675,"end":783,"declarations":[{"type":"VariableDeclarator","start":681,"end":783,"id":{"type":"Identifier","start":681,"end":694,"name":"uppyAuthToken"},"init":{"type":"CallExpression","start":697,"end":783,"callee":{"type":"MemberExpression","start":697,"end":723,"object":{"type":"Identifier","start":697,"end":709,"name":"tokenService"},"property":{"type":"Identifier","start":710,"end":723,"name":"generateToken"},"computed":false},"arguments":[{"type":"MemberExpression","start":724,"end":752,"object":{"type":"MemberExpression","start":724,"end":737,"object":{"type":"Identifier","start":724,"end":727,"name":"req"},"property":{"type":"Identifier","start":728,"end":737,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":738,"end":752,"name":"providerTokens"},"computed":false},{"type":"MemberExpression","start":754,"end":782,"object":{"type":"MemberExpression","start":754,"end":775,"object":{"type":"MemberExpression","start":754,"end":767,"object":{"type":"Identifier","start":754,"end":757,"name":"req"},"property":{"type":"Identifier","start":758,"end":767,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":768,"end":775,"name":"options"},"computed":false},"property":{"type":"Identifier","start":776,"end":782,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"ReturnStatement","start":788,"end":899,"argument":{"type":"CallExpression","start":795,"end":899,"callee":{"type":"MemberExpression","start":795,"end":807,"object":{"type":"Identifier","start":795,"end":798,"name":"res"},"property":{"type":"Identifier","start":799,"end":807,"name":"redirect"},"computed":false},"arguments":[{"type":"CallExpression","start":808,"end":898,"callee":{"type":"MemberExpression","start":808,"end":830,"object":{"type":"MemberExpression","start":808,"end":821,"object":{"type":"Identifier","start":808,"end":811,"name":"req"},"property":{"type":"Identifier","start":812,"end":821,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":822,"end":830,"name":"buildURL"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":831,"end":891,"expressions":[{"type":"Identifier","start":835,"end":847,"name":"providerName"},{"type":"Identifier","start":876,"end":889,"name":"uppyAuthToken"}],"quasis":[{"type":"TemplateElement","start":832,"end":833,"value":{"raw":"/","cooked":"/"},"tail":false},{"type":"TemplateElement","start":848,"end":874,"value":{"raw":"/send-token?uppyAuthToken=","cooked":"/send-token?uppyAuthToken="},"tail":false},{"type":"TemplateElement","start":890,"end":890,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":893,"end":897,"value":true,"raw":"true"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":907,"end":994,"expression":{"type":"CallExpression","start":907,"end":994,"callee":{"type":"MemberExpression","start":907,"end":919,"object":{"type":"Identifier","start":907,"end":913,"name":"logger"},"property":{"type":"Identifier","start":914,"end":919,"name":"debug"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":920,"end":979,"expressions":[{"type":"Identifier","start":965,"end":977,"name":"providerName"}],"quasis":[{"type":"TemplateElement","start":921,"end":963,"value":{"raw":"Did not receive access token for provider ","cooked":"Did not receive access token for provider "},"tail":false},{"type":"TemplateElement","start":978,"end":978,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":981,"end":985,"value":null,"raw":"null"},{"type":"MemberExpression","start":987,"end":993,"object":{"type":"Identifier","start":987,"end":990,"name":"req"},"property":{"type":"Identifier","start":991,"end":993,"name":"id"},"computed":false}]}},{"type":"ExpressionStatement","start":997,"end":1068,"expression":{"type":"CallExpression","start":997,"end":1068,"callee":{"type":"MemberExpression","start":997,"end":1009,"object":{"type":"Identifier","start":997,"end":1003,"name":"logger"},"property":{"type":"Identifier","start":1004,"end":1009,"name":"debug"},"computed":false},"arguments":[{"type":"MemberExpression","start":1010,"end":1036,"object":{"type":"MemberExpression","start":1010,"end":1027,"object":{"type":"MemberExpression","start":1010,"end":1021,"object":{"type":"Identifier","start":1010,"end":1013,"name":"req"},"property":{"type":"Identifier","start":1014,"end":1021,"name":"session"},"computed":false},"property":{"type":"Identifier","start":1022,"end":1027,"name":"grant"},"computed":false},"property":{"type":"Identifier","start":1028,"end":1036,"name":"response"},"computed":false},{"type":"Literal","start":1038,"end":1059,"value":"callback.oauth.resp","raw":"'callback.oauth.resp'"},{"type":"MemberExpression","start":1061,"end":1067,"object":{"type":"Identifier","start":1061,"end":1064,"name":"req"},"property":{"type":"Identifier","start":1065,"end":1067,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":1071,"end":1097,"argument":{"type":"CallExpression","start":1078,"end":1097,"callee":{"type":"MemberExpression","start":1078,"end":1092,"object":{"type":"Identifier","start":1078,"end":1081,"name":"res"},"property":{"type":"Identifier","start":1082,"end":1092,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":1093,"end":1096,"value":400,"raw":"400"}]}}]}}}}],"sourceType":"script"}