{"type":"Program","start":0,"end":1751,"body":[{"type":"VariableDeclaration","start":0,"end":39,"declarations":[{"type":"VariableDeclarator","start":6,"end":39,"id":{"type":"Identifier","start":6,"end":14,"name":"Uploader"},"init":{"type":"CallExpression","start":17,"end":39,"callee":{"type":"Identifier","start":17,"end":24,"name":"require"},"arguments":[{"type":"Literal","start":25,"end":38,"value":"../Uploader","raw":"'../Uploader'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":40,"end":75,"declarations":[{"type":"VariableDeclarator","start":46,"end":75,"id":{"type":"Identifier","start":46,"end":52,"name":"logger"},"init":{"type":"CallExpression","start":55,"end":75,"callee":{"type":"Identifier","start":55,"end":62,"name":"require"},"arguments":[{"type":"Literal","start":63,"end":74,"value":"../logger","raw":"'../logger'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":76,"end":132,"declarations":[{"type":"VariableDeclarator","start":82,"end":132,"id":{"type":"ObjectPattern","start":82,"end":101,"properties":[{"type":"Property","start":84,"end":99,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":84,"end":99,"name":"errorToResponse"},"kind":"init","value":{"type":"Identifier","start":84,"end":99,"name":"errorToResponse"}}]},"init":{"type":"CallExpression","start":104,"end":132,"callee":{"type":"Identifier","start":104,"end":111,"name":"require"},"arguments":[{"type":"Literal","start":112,"end":131,"value":"../provider/error","raw":"'../provider/error'"}]}}],"kind":"const"},{"type":"FunctionDeclaration","start":134,"end":1728,"id":{"type":"Identifier","start":143,"end":146,"name":"get"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":148,"end":151,"name":"req"},{"type":"Identifier","start":153,"end":156,"name":"res"},{"type":"Identifier","start":158,"end":162,"name":"next"}],"body":{"type":"BlockStatement","start":164,"end":1728,"body":[{"type":"VariableDeclaration","start":168,"end":212,"declarations":[{"type":"VariableDeclarator","start":174,"end":212,"id":{"type":"Identifier","start":174,"end":186,"name":"providerName"},"init":{"type":"MemberExpression","start":189,"end":212,"object":{"type":"MemberExpression","start":189,"end":199,"object":{"type":"Identifier","start":189,"end":192,"name":"req"},"property":{"type":"Identifier","start":193,"end":199,"name":"params"},"computed":false},"property":{"type":"Identifier","start":200,"end":212,"name":"providerName"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":215,"end":239,"declarations":[{"type":"VariableDeclarator","start":221,"end":239,"id":{"type":"Identifier","start":221,"end":223,"name":"id"},"init":{"type":"MemberExpression","start":226,"end":239,"object":{"type":"MemberExpression","start":226,"end":236,"object":{"type":"Identifier","start":226,"end":229,"name":"req"},"property":{"type":"Identifier","start":230,"end":236,"name":"params"},"computed":false},"property":{"type":"Identifier","start":237,"end":239,"name":"id"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":242,"end":298,"declarations":[{"type":"VariableDeclarator","start":248,"end":298,"id":{"type":"Identifier","start":248,"end":253,"name":"token"},"init":{"type":"MemberExpression","start":256,"end":298,"object":{"type":"MemberExpression","start":256,"end":284,"object":{"type":"MemberExpression","start":256,"end":269,"object":{"type":"Identifier","start":256,"end":259,"name":"req"},"property":{"type":"Identifier","start":260,"end":269,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":270,"end":284,"name":"providerTokens"},"computed":false},"property":{"type":"Identifier","start":285,"end":297,"name":"providerName"},"computed":true}}],"kind":"const"},{"type":"VariableDeclaration","start":301,"end":340,"declarations":[{"type":"VariableDeclarator","start":307,"end":340,"id":{"type":"Identifier","start":307,"end":315,"name":"provider"},"init":{"type":"MemberExpression","start":318,"end":340,"object":{"type":"MemberExpression","start":318,"end":331,"object":{"type":"Identifier","start":318,"end":321,"name":"req"},"property":{"type":"Identifier","start":322,"end":331,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":332,"end":340,"name":"provider"},"computed":false}}],"kind":"const"},{"type":"ExpressionStatement","start":385,"end":1726,"expression":{"type":"CallExpression","start":385,"end":1726,"callee":{"type":"MemberExpression","start":385,"end":398,"object":{"type":"Identifier","start":385,"end":393,"name":"provider"},"property":{"type":"Identifier","start":394,"end":398,"name":"size"},"computed":false},"arguments":[{"type":"ObjectExpression","start":399,"end":430,"properties":[{"type":"Property","start":401,"end":403,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":401,"end":403,"name":"id"},"kind":"init","value":{"type":"Identifier","start":401,"end":403,"name":"id"}},{"type":"Property","start":405,"end":410,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":405,"end":410,"name":"token"},"kind":"init","value":{"type":"Identifier","start":405,"end":410,"name":"token"}},{"type":"Property","start":412,"end":428,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":412,"end":417,"name":"query"},"value":{"type":"MemberExpression","start":419,"end":428,"object":{"type":"Identifier","start":419,"end":422,"name":"req"},"property":{"type":"Identifier","start":423,"end":428,"name":"query"},"computed":false},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":432,"end":1725,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":433,"end":436,"name":"err"},{"type":"Identifier","start":438,"end":442,"name":"size"}],"body":{"type":"BlockStatement","start":447,"end":1725,"body":[{"type":"IfStatement","start":453,"end":639,"test":{"type":"Identifier","start":457,"end":460,"name":"err"},"consequent":{"type":"BlockStatement","start":462,"end":639,"body":[{"type":"VariableDeclaration","start":470,"end":506,"declarations":[{"type":"VariableDeclarator","start":476,"end":506,"id":{"type":"Identifier","start":476,"end":483,"name":"errResp"},"init":{"type":"CallExpression","start":486,"end":506,"callee":{"type":"Identifier","start":486,"end":501,"name":"errorToResponse"},"arguments":[{"type":"Identifier","start":502,"end":505,"name":"err"}]}}],"kind":"const"},{"type":"IfStatement","start":513,"end":610,"test":{"type":"Identifier","start":517,"end":524,"name":"errResp"},"consequent":{"type":"BlockStatement","start":526,"end":610,"body":[{"type":"ReturnStatement","start":536,"end":602,"argument":{"type":"CallExpression","start":543,"end":602,"callee":{"type":"MemberExpression","start":543,"end":572,"object":{"type":"CallExpression","start":543,"end":567,"callee":{"type":"MemberExpression","start":543,"end":553,"object":{"type":"Identifier","start":543,"end":546,"name":"res"},"property":{"type":"Identifier","start":547,"end":553,"name":"status"},"computed":false},"arguments":[{"type":"MemberExpression","start":554,"end":566,"object":{"type":"Identifier","start":554,"end":561,"name":"errResp"},"property":{"type":"Identifier","start":562,"end":566,"name":"code"},"computed":false}]},"property":{"type":"Identifier","start":568,"end":572,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":573,"end":601,"properties":[{"type":"Property","start":575,"end":599,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":575,"end":582,"name":"message"},"value":{"type":"MemberExpression","start":584,"end":599,"object":{"type":"Identifier","start":584,"end":591,"name":"errResp"},"property":{"type":"Identifier","start":592,"end":599,"name":"message"},"computed":false},"kind":"init"}]}]}}]},"alternate":null},{"type":"ReturnStatement","start":617,"end":633,"argument":{"type":"CallExpression","start":624,"end":633,"callee":{"type":"Identifier","start":624,"end":628,"name":"next"},"arguments":[{"type":"Identifier","start":629,"end":632,"name":"err"}]}}]},"alternate":null},{"type":"IfStatement","start":645,"end":835,"test":{"type":"UnaryExpression","start":649,"end":654,"operator":"!","prefix":true,"argument":{"type":"Identifier","start":650,"end":654,"name":"size"}},"consequent":{"type":"BlockStatement","start":656,"end":835,"body":[{"type":"ExpressionStatement","start":664,"end":749,"expression":{"type":"CallExpression","start":664,"end":749,"callee":{"type":"MemberExpression","start":664,"end":676,"object":{"type":"Identifier","start":664,"end":670,"name":"logger"},"property":{"type":"Identifier","start":671,"end":676,"name":"error"},"computed":false},"arguments":[{"type":"Literal","start":677,"end":708,"value":"unable to determine file size","raw":"'unable to determine file size'"},{"type":"Literal","start":710,"end":740,"value":"controller.get.provider.size","raw":"'controller.get.provider.size'"},{"type":"MemberExpression","start":742,"end":748,"object":{"type":"Identifier","start":742,"end":745,"name":"req"},"property":{"type":"Identifier","start":746,"end":748,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":756,"end":829,"argument":{"type":"CallExpression","start":763,"end":829,"callee":{"type":"MemberExpression","start":763,"end":783,"object":{"type":"CallExpression","start":763,"end":778,"callee":{"type":"MemberExpression","start":763,"end":773,"object":{"type":"Identifier","start":763,"end":766,"name":"res"},"property":{"type":"Identifier","start":767,"end":773,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":774,"end":777,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":779,"end":783,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":784,"end":828,"properties":[{"type":"Property","start":786,"end":826,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":786,"end":793,"name":"message"},"value":{"type":"Literal","start":795,"end":826,"value":"unable to determine file size","raw":"'unable to determine file size'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":841,"end":894,"expression":{"type":"CallExpression","start":841,"end":894,"callee":{"type":"MemberExpression","start":841,"end":853,"object":{"type":"Identifier","start":841,"end":847,"name":"logger"},"property":{"type":"Identifier","start":848,"end":853,"name":"debug"},"computed":false},"arguments":[{"type":"Literal","start":854,"end":879,"value":"Instantiating uploader.","raw":"'Instantiating uploader.'"},{"type":"Literal","start":881,"end":885,"value":null,"raw":"null"},{"type":"MemberExpression","start":887,"end":893,"object":{"type":"Identifier","start":887,"end":890,"name":"req"},"property":{"type":"Identifier","start":891,"end":893,"name":"id"},"computed":false}]}},{"type":"VariableDeclaration","start":899,"end":962,"declarations":[{"type":"VariableDeclarator","start":905,"end":962,"id":{"type":"Identifier","start":905,"end":913,"name":"uploader"},"init":{"type":"NewExpression","start":916,"end":962,"callee":{"type":"Identifier","start":920,"end":928,"name":"Uploader"},"arguments":[{"type":"CallExpression","start":929,"end":961,"callee":{"type":"MemberExpression","start":929,"end":950,"object":{"type":"Identifier","start":929,"end":937,"name":"Uploader"},"property":{"type":"Identifier","start":938,"end":950,"name":"reqToOptions"},"computed":false},"arguments":[{"type":"Identifier","start":951,"end":954,"name":"req"},{"type":"Identifier","start":956,"end":960,"name":"size"}]}]}}],"kind":"const"},{"type":"IfStatement","start":968,"end":1113,"test":{"type":"CallExpression","start":972,"end":991,"callee":{"type":"MemberExpression","start":972,"end":989,"object":{"type":"Identifier","start":972,"end":980,"name":"uploader"},"property":{"type":"Identifier","start":981,"end":989,"name":"hasError"},"computed":false},"arguments":[]},"consequent":{"type":"BlockStatement","start":993,"end":1113,"body":[{"type":"VariableDeclaration","start":1001,"end":1040,"declarations":[{"type":"VariableDeclarator","start":1007,"end":1040,"id":{"type":"Identifier","start":1007,"end":1015,"name":"response"},"init":{"type":"CallExpression","start":1018,"end":1040,"callee":{"type":"MemberExpression","start":1018,"end":1038,"object":{"type":"Identifier","start":1018,"end":1026,"name":"uploader"},"property":{"type":"Identifier","start":1027,"end":1038,"name":"getResponse"},"computed":false},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","start":1047,"end":1094,"expression":{"type":"CallExpression","start":1047,"end":1094,"callee":{"type":"MemberExpression","start":1047,"end":1079,"object":{"type":"CallExpression","start":1047,"end":1074,"callee":{"type":"MemberExpression","start":1047,"end":1057,"object":{"type":"Identifier","start":1047,"end":1050,"name":"res"},"property":{"type":"Identifier","start":1051,"end":1057,"name":"status"},"computed":false},"arguments":[{"type":"MemberExpression","start":1058,"end":1073,"object":{"type":"Identifier","start":1058,"end":1066,"name":"response"},"property":{"type":"Identifier","start":1067,"end":1073,"name":"status"},"computed":false}]},"property":{"type":"Identifier","start":1075,"end":1079,"name":"json"},"computed":false},"arguments":[{"type":"MemberExpression","start":1080,"end":1093,"object":{"type":"Identifier","start":1080,"end":1088,"name":"response"},"property":{"type":"Identifier","start":1089,"end":1093,"name":"body"},"computed":false}]}},{"type":"ReturnStatement","start":1101,"end":1107,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":1274,"end":1367,"expression":{"type":"CallExpression","start":1274,"end":1367,"callee":{"type":"MemberExpression","start":1274,"end":1286,"object":{"type":"Identifier","start":1274,"end":1280,"name":"logger"},"property":{"type":"Identifier","start":1281,"end":1286,"name":"debug"},"computed":false},"arguments":[{"type":"Literal","start":1287,"end":1352,"value":"Waiting for socket connection before beginning remote download.","raw":"'Waiting for socket connection before beginning remote download.'"},{"type":"Literal","start":1354,"end":1358,"value":null,"raw":"null"},{"type":"MemberExpression","start":1360,"end":1366,"object":{"type":"Identifier","start":1360,"end":1363,"name":"req"},"property":{"type":"Identifier","start":1364,"end":1366,"name":"id"},"computed":false}]}},{"type":"ExpressionStatement","start":1404,"end":1625,"expression":{"type":"CallExpression","start":1404,"end":1625,"callee":{"type":"MemberExpression","start":1404,"end":1426,"object":{"type":"Identifier","start":1404,"end":1412,"name":"uploader"},"property":{"type":"Identifier","start":1413,"end":1426,"name":"onSocketReady"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":1427,"end":1624,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":1433,"end":1624,"body":[{"type":"ExpressionStatement","start":1441,"end":1524,"expression":{"type":"CallExpression","start":1441,"end":1524,"callee":{"type":"MemberExpression","start":1441,"end":1453,"object":{"type":"Identifier","start":1441,"end":1447,"name":"logger"},"property":{"type":"Identifier","start":1448,"end":1453,"name":"debug"},"computed":false},"arguments":[{"type":"Literal","start":1454,"end":1509,"value":"Socket connection received. Starting remote download.","raw":"'Socket connection received. Starting remote download.'"},{"type":"Literal","start":1511,"end":1515,"value":null,"raw":"null"},{"type":"MemberExpression","start":1517,"end":1523,"object":{"type":"Identifier","start":1517,"end":1520,"name":"req"},"property":{"type":"Identifier","start":1521,"end":1523,"name":"id"},"computed":false}]}},{"type":"ExpressionStatement","start":1531,"end":1618,"expression":{"type":"CallExpression","start":1531,"end":1618,"callee":{"type":"MemberExpression","start":1531,"end":1548,"object":{"type":"Identifier","start":1531,"end":1539,"name":"provider"},"property":{"type":"Identifier","start":1540,"end":1548,"name":"download"},"computed":false},"arguments":[{"type":"ObjectExpression","start":1549,"end":1580,"properties":[{"type":"Property","start":1551,"end":1553,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1551,"end":1553,"name":"id"},"kind":"init","value":{"type":"Identifier","start":1551,"end":1553,"name":"id"}},{"type":"Property","start":1555,"end":1560,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1555,"end":1560,"name":"token"},"kind":"init","value":{"type":"Identifier","start":1555,"end":1560,"name":"token"}},{"type":"Property","start":1562,"end":1578,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1562,"end":1567,"name":"query"},"value":{"type":"MemberExpression","start":1569,"end":1578,"object":{"type":"Identifier","start":1569,"end":1572,"name":"req"},"property":{"type":"Identifier","start":1573,"end":1578,"name":"query"},"computed":false},"kind":"init"}]},{"type":"CallExpression","start":1582,"end":1617,"callee":{"type":"MemberExpression","start":1582,"end":1607,"object":{"type":"MemberExpression","start":1582,"end":1602,"object":{"type":"Identifier","start":1582,"end":1590,"name":"uploader"},"property":{"type":"Identifier","start":1591,"end":1602,"name":"handleChunk"},"computed":false},"property":{"type":"Identifier","start":1603,"end":1607,"name":"bind"},"computed":false},"arguments":[{"type":"Identifier","start":1608,"end":1616,"name":"uploader"}]}]}}]}}]}},{"type":"VariableDeclaration","start":1630,"end":1669,"declarations":[{"type":"VariableDeclarator","start":1636,"end":1669,"id":{"type":"Identifier","start":1636,"end":1644,"name":"response"},"init":{"type":"CallExpression","start":1647,"end":1669,"callee":{"type":"MemberExpression","start":1647,"end":1667,"object":{"type":"Identifier","start":1647,"end":1655,"name":"uploader"},"property":{"type":"Identifier","start":1656,"end":1667,"name":"getResponse"},"computed":false},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","start":1674,"end":1721,"expression":{"type":"CallExpression","start":1674,"end":1721,"callee":{"type":"MemberExpression","start":1674,"end":1706,"object":{"type":"CallExpression","start":1674,"end":1701,"callee":{"type":"MemberExpression","start":1674,"end":1684,"object":{"type":"Identifier","start":1674,"end":1677,"name":"res"},"property":{"type":"Identifier","start":1678,"end":1684,"name":"status"},"computed":false},"arguments":[{"type":"MemberExpression","start":1685,"end":1700,"object":{"type":"Identifier","start":1685,"end":1693,"name":"response"},"property":{"type":"Identifier","start":1694,"end":1700,"name":"status"},"computed":false}]},"property":{"type":"Identifier","start":1702,"end":1706,"name":"json"},"computed":false},"arguments":[{"type":"MemberExpression","start":1707,"end":1720,"object":{"type":"Identifier","start":1707,"end":1715,"name":"response"},"property":{"type":"Identifier","start":1716,"end":1720,"name":"body"},"computed":false}]}}]}}]}}]}},{"type":"ExpressionStatement","start":1730,"end":1750,"expression":{"type":"AssignmentExpression","start":1730,"end":1750,"operator":"=","left":{"type":"MemberExpression","start":1730,"end":1744,"object":{"type":"Identifier","start":1730,"end":1736,"name":"module"},"property":{"type":"Identifier","start":1737,"end":1744,"name":"exports"},"computed":false},"right":{"type":"Identifier","start":1747,"end":1750,"name":"get"}}}],"sourceType":"script"}