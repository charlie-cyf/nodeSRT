{"type":"Program","start":0,"end":2283,"body":[{"type":"VariableDeclaration","start":0,"end":42,"declarations":[{"type":"VariableDeclarator","start":6,"end":41,"id":{"type":"Identifier","start":6,"end":14,"name":"schedule"},"init":{"type":"CallExpression","start":17,"end":41,"callee":{"type":"Identifier","start":17,"end":24,"name":"require"},"arguments":[{"type":"Literal","start":25,"end":40,"value":"node-schedule","raw":"'node-schedule'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":43,"end":94,"declarations":[{"type":"VariableDeclarator","start":49,"end":93,"id":{"type":"ObjectPattern","start":49,"end":69,"properties":[{"type":"Property","start":51,"end":67,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":51,"end":67,"name":"FILE_NAME_PREFIX"},"kind":"init","value":{"type":"Identifier","start":51,"end":67,"name":"FILE_NAME_PREFIX"}}]},"init":{"type":"CallExpression","start":72,"end":93,"callee":{"type":"Identifier","start":72,"end":79,"name":"require"},"arguments":[{"type":"Literal","start":80,"end":92,"value":"./Uploader","raw":"'./Uploader'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":95,"end":120,"declarations":[{"type":"VariableDeclarator","start":101,"end":119,"id":{"type":"Identifier","start":101,"end":103,"name":"fs"},"init":{"type":"CallExpression","start":106,"end":119,"callee":{"type":"Identifier","start":106,"end":113,"name":"require"},"arguments":[{"type":"Literal","start":114,"end":118,"value":"fs","raw":"'fs'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":121,"end":150,"declarations":[{"type":"VariableDeclarator","start":127,"end":149,"id":{"type":"Identifier","start":127,"end":131,"name":"path"},"init":{"type":"CallExpression","start":134,"end":149,"callee":{"type":"Identifier","start":134,"end":141,"name":"require"},"arguments":[{"type":"Literal","start":142,"end":148,"value":"path","raw":"'path'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":151,"end":186,"declarations":[{"type":"VariableDeclarator","start":157,"end":185,"id":{"type":"Identifier","start":157,"end":163,"name":"logger"},"init":{"type":"CallExpression","start":166,"end":185,"callee":{"type":"Identifier","start":166,"end":173,"name":"require"},"arguments":[{"type":"Literal","start":174,"end":184,"value":"./logger","raw":"'./logger'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":344,"end":552,"expression":{"type":"AssignmentExpression","start":344,"end":551,"operator":"=","left":{"type":"MemberExpression","start":344,"end":367,"object":{"type":"Identifier","start":344,"end":351,"name":"exports"},"property":{"type":"Identifier","start":352,"end":367,"name":"startCleanUpJob"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":370,"end":551,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":371,"end":378,"name":"dirPath"}],"body":{"type":"BlockStatement","start":383,"end":551,"body":[{"type":"ExpressionStatement","start":389,"end":448,"expression":{"type":"CallExpression","start":389,"end":447,"callee":{"type":"MemberExpression","start":389,"end":400,"object":{"type":"Identifier","start":389,"end":395,"name":"logger"},"property":{"type":"Identifier","start":396,"end":400,"name":"info"},"computed":false},"arguments":[{"type":"Literal","start":401,"end":424,"value":"starting clean up job","raw":"'starting clean up job'"},{"type":"Literal","start":426,"end":446,"value":"jobs.cleanup.start","raw":"'jobs.cleanup.start'"}]}},{"type":"ExpressionStatement","start":475,"end":549,"expression":{"type":"CallExpression","start":475,"end":548,"callee":{"type":"MemberExpression","start":475,"end":495,"object":{"type":"Identifier","start":475,"end":483,"name":"schedule"},"property":{"type":"Identifier","start":484,"end":495,"name":"scheduleJob"},"computed":false},"arguments":[{"type":"Literal","start":496,"end":508,"value":"0 23 * * *","raw":"'0 23 * * *'"},{"type":"ArrowFunctionExpression","start":510,"end":547,"id":null,"expression":true,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","start":516,"end":547,"callee":{"type":"Identifier","start":516,"end":538,"name":"cleanUpFinishedUploads"},"arguments":[{"type":"Identifier","start":539,"end":546,"name":"dirPath"}]}}]}}]}}}},{"type":"VariableDeclaration","start":553,"end":2282,"declarations":[{"type":"VariableDeclarator","start":559,"end":2281,"id":{"type":"Identifier","start":559,"end":581,"name":"cleanUpFinishedUploads"},"init":{"type":"ArrowFunctionExpression","start":584,"end":2281,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":585,"end":592,"name":"dirPath"}],"body":{"type":"BlockStatement","start":597,"end":2281,"body":[{"type":"ExpressionStatement","start":603,"end":690,"expression":{"type":"CallExpression","start":603,"end":689,"callee":{"type":"MemberExpression","start":603,"end":614,"object":{"type":"Identifier","start":603,"end":609,"name":"logger"},"property":{"type":"Identifier","start":610,"end":614,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":615,"end":658,"expressions":[{"type":"Identifier","start":649,"end":656,"name":"dirPath"}],"quasis":[{"type":"TemplateElement","start":616,"end":647,"value":{"raw":"running clean up job for path: ","cooked":"running clean up job for path: "},"tail":false},{"type":"TemplateElement","start":657,"end":657,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":660,"end":688,"value":"jobs.cleanup.progress.read","raw":"'jobs.cleanup.progress.read'"}]}},{"type":"ExpressionStatement","start":695,"end":2279,"expression":{"type":"CallExpression","start":695,"end":2278,"callee":{"type":"MemberExpression","start":695,"end":705,"object":{"type":"Identifier","start":695,"end":697,"name":"fs"},"property":{"type":"Identifier","start":698,"end":705,"name":"readdir"},"computed":false},"arguments":[{"type":"Identifier","start":706,"end":713,"name":"dirPath"},{"type":"ArrowFunctionExpression","start":715,"end":2277,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":716,"end":719,"name":"err"},{"type":"Identifier","start":721,"end":726,"name":"files"}],"body":{"type":"BlockStatement","start":731,"end":2277,"body":[{"type":"IfStatement","start":741,"end":839,"test":{"type":"Identifier","start":745,"end":748,"name":"err"},"consequent":{"type":"BlockStatement","start":750,"end":839,"body":[{"type":"ExpressionStatement","start":764,"end":809,"expression":{"type":"CallExpression","start":764,"end":808,"callee":{"type":"MemberExpression","start":764,"end":776,"object":{"type":"Identifier","start":764,"end":770,"name":"logger"},"property":{"type":"Identifier","start":771,"end":776,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":777,"end":780,"name":"err"},{"type":"Literal","start":782,"end":807,"value":"jobs.cleanup.read.error","raw":"'jobs.cleanup.read.error'"}]}},{"type":"ReturnStatement","start":822,"end":829,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":848,"end":913,"expression":{"type":"CallExpression","start":848,"end":912,"callee":{"type":"MemberExpression","start":848,"end":859,"object":{"type":"Identifier","start":848,"end":854,"name":"logger"},"property":{"type":"Identifier","start":855,"end":859,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":860,"end":889,"expressions":[{"type":"MemberExpression","start":869,"end":881,"object":{"type":"Identifier","start":869,"end":874,"name":"files"},"property":{"type":"Identifier","start":875,"end":881,"name":"length"},"computed":false}],"quasis":[{"type":"TemplateElement","start":861,"end":867,"value":{"raw":"found ","cooked":"found "},"tail":false},{"type":"TemplateElement","start":882,"end":888,"value":{"raw":" files","cooked":" files"},"tail":true}]},{"type":"Literal","start":891,"end":911,"value":"jobs.cleanup.files","raw":"'jobs.cleanup.files'"}]}},{"type":"ExpressionStatement","start":922,"end":2271,"expression":{"type":"CallExpression","start":922,"end":2270,"callee":{"type":"MemberExpression","start":922,"end":935,"object":{"type":"Identifier","start":922,"end":927,"name":"files"},"property":{"type":"Identifier","start":928,"end":935,"name":"forEach"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":936,"end":2269,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":937,"end":941,"name":"file"},{"type":"Identifier","start":943,"end":952,"name":"fileIndex"}],"body":{"type":"BlockStatement","start":957,"end":2269,"body":[{"type":"IfStatement","start":1205,"end":1359,"test":{"type":"UnaryExpression","start":1209,"end":1243,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":1210,"end":1243,"callee":{"type":"MemberExpression","start":1210,"end":1225,"object":{"type":"Identifier","start":1210,"end":1214,"name":"file"},"property":{"type":"Identifier","start":1215,"end":1225,"name":"startsWith"},"computed":false},"arguments":[{"type":"Identifier","start":1226,"end":1242,"name":"FILE_NAME_PREFIX"}]}},"consequent":{"type":"BlockStatement","start":1245,"end":1359,"body":[{"type":"ExpressionStatement","start":1263,"end":1321,"expression":{"type":"CallExpression","start":1263,"end":1320,"callee":{"type":"MemberExpression","start":1263,"end":1274,"object":{"type":"Identifier","start":1263,"end":1269,"name":"logger"},"property":{"type":"Identifier","start":1270,"end":1274,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":1275,"end":1298,"expressions":[{"type":"Identifier","start":1292,"end":1296,"name":"file"}],"quasis":[{"type":"TemplateElement","start":1276,"end":1290,"value":{"raw":"skipping file ","cooked":"skipping file "},"tail":false},{"type":"TemplateElement","start":1297,"end":1297,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":1300,"end":1319,"value":"jobs.cleanup.skip","raw":"'jobs.cleanup.skip'"}]}},{"type":"ReturnStatement","start":1338,"end":1345,"argument":null}]},"alternate":null},{"type":"VariableDeclaration","start":1372,"end":1414,"declarations":[{"type":"VariableDeclarator","start":1378,"end":1413,"id":{"type":"Identifier","start":1378,"end":1386,"name":"fullPath"},"init":{"type":"CallExpression","start":1389,"end":1413,"callee":{"type":"MemberExpression","start":1389,"end":1398,"object":{"type":"Identifier","start":1389,"end":1393,"name":"path"},"property":{"type":"Identifier","start":1394,"end":1398,"name":"join"},"computed":false},"arguments":[{"type":"Identifier","start":1399,"end":1406,"name":"dirPath"},{"type":"Identifier","start":1408,"end":1412,"name":"file"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":1427,"end":2259,"expression":{"type":"CallExpression","start":1427,"end":2258,"callee":{"type":"MemberExpression","start":1427,"end":1434,"object":{"type":"Identifier","start":1427,"end":1429,"name":"fs"},"property":{"type":"Identifier","start":1430,"end":1434,"name":"stat"},"computed":false},"arguments":[{"type":"Identifier","start":1435,"end":1443,"name":"fullPath"},{"type":"ArrowFunctionExpression","start":1445,"end":2257,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1446,"end":1449,"name":"err"},{"type":"Identifier","start":1451,"end":1456,"name":"stats"}],"body":{"type":"BlockStatement","start":1461,"end":2257,"body":[{"type":"VariableDeclaration","start":1479,"end":1522,"declarations":[{"type":"VariableDeclarator","start":1485,"end":1521,"id":{"type":"Identifier","start":1485,"end":1499,"name":"twelveHoursAgo"},"init":{"type":"BinaryExpression","start":1502,"end":1521,"left":{"type":"BinaryExpression","start":1502,"end":1514,"left":{"type":"BinaryExpression","start":1502,"end":1509,"left":{"type":"Literal","start":1502,"end":1504,"value":12,"raw":"12"},"operator":"*","right":{"type":"Literal","start":1507,"end":1509,"value":60,"raw":"60"}},"operator":"*","right":{"type":"Literal","start":1512,"end":1514,"value":60,"raw":"60"}},"operator":"*","right":{"type":"Literal","start":1517,"end":1521,"value":1000,"raw":"1000"}}}],"kind":"const"},{"type":"IfStatement","start":1539,"end":1989,"test":{"type":"Identifier","start":1543,"end":1546,"name":"err"},"consequent":{"type":"BlockStatement","start":1548,"end":1790,"body":[{"type":"ExpressionStatement","start":1693,"end":1738,"expression":{"type":"CallExpression","start":1693,"end":1737,"callee":{"type":"MemberExpression","start":1693,"end":1705,"object":{"type":"Identifier","start":1693,"end":1699,"name":"logger"},"property":{"type":"Identifier","start":1700,"end":1705,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":1706,"end":1709,"name":"err"},{"type":"Literal","start":1711,"end":1736,"value":"jobs.cleanup.stat.error","raw":"'jobs.cleanup.stat.error'"}]}}]},"alternate":{"type":"IfStatement","start":1812,"end":1989,"test":{"type":"BinaryExpression","start":1816,"end":1861,"left":{"type":"BinaryExpression","start":1817,"end":1843,"left":{"type":"NewExpression","start":1818,"end":1828,"callee":{"type":"Identifier","start":1822,"end":1826,"name":"Date"},"arguments":[]},"operator":"-","right":{"type":"MemberExpression","start":1832,"end":1843,"object":{"type":"Identifier","start":1832,"end":1837,"name":"stats"},"property":{"type":"Identifier","start":1838,"end":1843,"name":"mtime"},"computed":false}},"operator":"<","right":{"type":"Identifier","start":1847,"end":1861,"name":"twelveHoursAgo"}},"consequent":{"type":"BlockStatement","start":1863,"end":1989,"body":[{"type":"ExpressionStatement","start":1885,"end":1943,"expression":{"type":"CallExpression","start":1885,"end":1942,"callee":{"type":"MemberExpression","start":1885,"end":1896,"object":{"type":"Identifier","start":1885,"end":1891,"name":"logger"},"property":{"type":"Identifier","start":1892,"end":1896,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":1897,"end":1920,"expressions":[{"type":"Identifier","start":1914,"end":1918,"name":"file"}],"quasis":[{"type":"TemplateElement","start":1898,"end":1912,"value":{"raw":"skipping file ","cooked":"skipping file "},"tail":false},{"type":"TemplateElement","start":1919,"end":1919,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":1922,"end":1941,"value":"jobs.cleanup.skip","raw":"'jobs.cleanup.skip'"}]}},{"type":"ReturnStatement","start":1964,"end":1971,"argument":null}]},"alternate":null}},{"type":"ExpressionStatement","start":2006,"end":2075,"expression":{"type":"CallExpression","start":2006,"end":2074,"callee":{"type":"MemberExpression","start":2006,"end":2017,"object":{"type":"Identifier","start":2006,"end":2012,"name":"logger"},"property":{"type":"Identifier","start":2013,"end":2017,"name":"info"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":2018,"end":2041,"expressions":[{"type":"Identifier","start":2035,"end":2039,"name":"file"}],"quasis":[{"type":"TemplateElement","start":2019,"end":2033,"value":{"raw":"deleting file ","cooked":"deleting file "},"tail":false},{"type":"TemplateElement","start":2040,"end":2040,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":2043,"end":2073,"value":"jobs.cleanup.progress.delete","raw":"'jobs.cleanup.progress.delete'"}]}},{"type":"ExpressionStatement","start":2092,"end":2243,"expression":{"type":"CallExpression","start":2092,"end":2242,"callee":{"type":"MemberExpression","start":2092,"end":2101,"object":{"type":"Identifier","start":2092,"end":2094,"name":"fs"},"property":{"type":"Identifier","start":2095,"end":2101,"name":"unlink"},"computed":false},"arguments":[{"type":"Identifier","start":2102,"end":2110,"name":"fullPath"},{"type":"ArrowFunctionExpression","start":2112,"end":2241,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":2113,"end":2116,"name":"err"}],"body":{"type":"BlockStatement","start":2121,"end":2241,"body":[{"type":"IfStatement","start":2143,"end":2223,"test":{"type":"Identifier","start":2147,"end":2150,"name":"err"},"consequent":{"type":"ExpressionStatement","start":2176,"end":2223,"expression":{"type":"CallExpression","start":2176,"end":2222,"callee":{"type":"MemberExpression","start":2176,"end":2188,"object":{"type":"Identifier","start":2176,"end":2182,"name":"logger"},"property":{"type":"Identifier","start":2183,"end":2188,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":2189,"end":2192,"name":"err"},{"type":"Literal","start":2194,"end":2221,"value":"jobs.cleanup.delete.error","raw":"'jobs.cleanup.delete.error'"}]}},"alternate":null}]}}]}}]}}]}}]}}]}}]}}]}}]}}}],"kind":"const"}],"sourceType":"script"}