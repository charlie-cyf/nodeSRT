{"type":"Program","start":0,"end":1143,"body":[{"type":"VariableDeclaration","start":97,"end":144,"declarations":[{"type":"VariableDeclarator","start":103,"end":143,"id":{"type":"Identifier","start":103,"end":115,"name":"tokenService"},"init":{"type":"CallExpression","start":118,"end":143,"callee":{"type":"Identifier","start":118,"end":125,"name":"require"},"arguments":[{"type":"Literal","start":126,"end":142,"value":"../helpers/jwt","raw":"'../helpers/jwt'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":145,"end":181,"declarations":[{"type":"VariableDeclarator","start":151,"end":180,"id":{"type":"Identifier","start":151,"end":157,"name":"logger"},"init":{"type":"CallExpression","start":160,"end":180,"callee":{"type":"Identifier","start":160,"end":167,"name":"require"},"arguments":[{"type":"Literal","start":168,"end":179,"value":"../logger","raw":"'../logger'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":265,"end":1142,"expression":{"type":"AssignmentExpression","start":265,"end":1141,"operator":"=","left":{"type":"MemberExpression","start":265,"end":279,"object":{"type":"Identifier","start":265,"end":271,"name":"module"},"property":{"type":"Identifier","start":272,"end":279,"name":"exports"},"computed":false},"right":{"type":"FunctionExpression","start":282,"end":1141,"id":{"type":"Identifier","start":291,"end":299,"name":"callback"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":300,"end":303,"name":"req"},{"type":"Identifier","start":305,"end":308,"name":"res"},{"type":"Identifier","start":310,"end":314,"name":"next"}],"body":{"type":"BlockStatement","start":316,"end":1141,"body":[{"type":"VariableDeclaration","start":322,"end":367,"declarations":[{"type":"VariableDeclarator","start":328,"end":366,"id":{"type":"Identifier","start":328,"end":340,"name":"providerName"},"init":{"type":"MemberExpression","start":343,"end":366,"object":{"type":"MemberExpression","start":343,"end":353,"object":{"type":"Identifier","start":343,"end":346,"name":"req"},"property":{"type":"Identifier","start":347,"end":353,"name":"params"},"computed":false},"property":{"type":"Identifier","start":354,"end":366,"name":"providerName"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":372,"end":457,"test":{"type":"UnaryExpression","start":376,"end":405,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":377,"end":405,"object":{"type":"MemberExpression","start":377,"end":390,"object":{"type":"Identifier","start":377,"end":380,"name":"req"},"property":{"type":"Identifier","start":381,"end":390,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":391,"end":405,"name":"providerTokens"},"computed":false}},"consequent":{"type":"BlockStatement","start":407,"end":457,"body":[{"type":"ExpressionStatement","start":417,"end":451,"expression":{"type":"AssignmentExpression","start":417,"end":450,"operator":"=","left":{"type":"MemberExpression","start":417,"end":445,"object":{"type":"MemberExpression","start":417,"end":430,"object":{"type":"Identifier","start":417,"end":420,"name":"req"},"property":{"type":"Identifier","start":421,"end":430,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":431,"end":445,"name":"providerTokens"},"computed":false},"right":{"type":"ObjectExpression","start":448,"end":450,"properties":[]}}}]},"alternate":null},{"type":"IfStatement","start":462,"end":937,"test":{"type":"MemberExpression","start":466,"end":505,"object":{"type":"MemberExpression","start":466,"end":492,"object":{"type":"MemberExpression","start":466,"end":483,"object":{"type":"MemberExpression","start":466,"end":477,"object":{"type":"Identifier","start":466,"end":469,"name":"req"},"property":{"type":"Identifier","start":470,"end":477,"name":"session"},"computed":false},"property":{"type":"Identifier","start":478,"end":483,"name":"grant"},"computed":false},"property":{"type":"Identifier","start":484,"end":492,"name":"response"},"computed":false},"property":{"type":"Identifier","start":493,"end":505,"name":"access_token"},"computed":false},"consequent":{"type":"BlockStatement","start":507,"end":937,"body":[{"type":"ExpressionStatement","start":517,"end":602,"expression":{"type":"AssignmentExpression","start":517,"end":601,"operator":"=","left":{"type":"MemberExpression","start":517,"end":559,"object":{"type":"MemberExpression","start":517,"end":545,"object":{"type":"MemberExpression","start":517,"end":530,"object":{"type":"Identifier","start":517,"end":520,"name":"req"},"property":{"type":"Identifier","start":521,"end":530,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":531,"end":545,"name":"providerTokens"},"computed":false},"property":{"type":"Identifier","start":546,"end":558,"name":"providerName"},"computed":true},"right":{"type":"MemberExpression","start":562,"end":601,"object":{"type":"MemberExpression","start":562,"end":588,"object":{"type":"MemberExpression","start":562,"end":579,"object":{"type":"MemberExpression","start":562,"end":573,"object":{"type":"Identifier","start":562,"end":565,"name":"req"},"property":{"type":"Identifier","start":566,"end":573,"name":"session"},"computed":false},"property":{"type":"Identifier","start":574,"end":579,"name":"grant"},"computed":false},"property":{"type":"Identifier","start":580,"end":588,"name":"response"},"computed":false},"property":{"type":"Identifier","start":589,"end":601,"name":"access_token"},"computed":false}}},{"type":"ExpressionStatement","start":611,"end":692,"expression":{"type":"CallExpression","start":611,"end":691,"callee":{"type":"MemberExpression","start":611,"end":623,"object":{"type":"Identifier","start":611,"end":617,"name":"logger"},"property":{"type":"Identifier","start":618,"end":623,"name":"debug"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":624,"end":676,"expressions":[{"type":"Identifier","start":662,"end":674,"name":"providerName"}],"quasis":[{"type":"TemplateElement","start":625,"end":660,"value":{"raw":"Generating auth token for provider ","cooked":"Generating auth token for provider "},"tail":false},{"type":"TemplateElement","start":675,"end":675,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":678,"end":682,"value":null,"raw":"null"},{"type":"MemberExpression","start":684,"end":690,"object":{"type":"Identifier","start":684,"end":687,"name":"req"},"property":{"type":"Identifier","start":688,"end":690,"name":"id"},"computed":false}]}},{"type":"VariableDeclaration","start":701,"end":810,"declarations":[{"type":"VariableDeclarator","start":707,"end":809,"id":{"type":"Identifier","start":707,"end":720,"name":"uppyAuthToken"},"init":{"type":"CallExpression","start":723,"end":809,"callee":{"type":"MemberExpression","start":723,"end":749,"object":{"type":"Identifier","start":723,"end":735,"name":"tokenService"},"property":{"type":"Identifier","start":736,"end":749,"name":"generateToken"},"computed":false},"arguments":[{"type":"MemberExpression","start":750,"end":778,"object":{"type":"MemberExpression","start":750,"end":763,"object":{"type":"Identifier","start":750,"end":753,"name":"req"},"property":{"type":"Identifier","start":754,"end":763,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":764,"end":778,"name":"providerTokens"},"computed":false},{"type":"MemberExpression","start":780,"end":808,"object":{"type":"MemberExpression","start":780,"end":801,"object":{"type":"MemberExpression","start":780,"end":793,"object":{"type":"Identifier","start":780,"end":783,"name":"req"},"property":{"type":"Identifier","start":784,"end":793,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":794,"end":801,"name":"options"},"computed":false},"property":{"type":"Identifier","start":802,"end":808,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"ReturnStatement","start":819,"end":931,"argument":{"type":"CallExpression","start":826,"end":930,"callee":{"type":"MemberExpression","start":826,"end":838,"object":{"type":"Identifier","start":826,"end":829,"name":"res"},"property":{"type":"Identifier","start":830,"end":838,"name":"redirect"},"computed":false},"arguments":[{"type":"CallExpression","start":839,"end":929,"callee":{"type":"MemberExpression","start":839,"end":861,"object":{"type":"MemberExpression","start":839,"end":852,"object":{"type":"Identifier","start":839,"end":842,"name":"req"},"property":{"type":"Identifier","start":843,"end":852,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":853,"end":861,"name":"buildURL"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":862,"end":922,"expressions":[{"type":"Identifier","start":866,"end":878,"name":"providerName"},{"type":"Identifier","start":907,"end":920,"name":"uppyAuthToken"}],"quasis":[{"type":"TemplateElement","start":863,"end":864,"value":{"raw":"/","cooked":"/"},"tail":false},{"type":"TemplateElement","start":879,"end":905,"value":{"raw":"/send-token?uppyAuthToken=","cooked":"/send-token?uppyAuthToken="},"tail":false},{"type":"TemplateElement","start":921,"end":921,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":924,"end":928,"value":true,"raw":"true"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":942,"end":1030,"expression":{"type":"CallExpression","start":942,"end":1029,"callee":{"type":"MemberExpression","start":942,"end":954,"object":{"type":"Identifier","start":942,"end":948,"name":"logger"},"property":{"type":"Identifier","start":949,"end":954,"name":"debug"},"computed":false},"arguments":[{"type":"TemplateLiteral","start":955,"end":1014,"expressions":[{"type":"Identifier","start":1000,"end":1012,"name":"providerName"}],"quasis":[{"type":"TemplateElement","start":956,"end":998,"value":{"raw":"Did not receive access token for provider ","cooked":"Did not receive access token for provider "},"tail":false},{"type":"TemplateElement","start":1013,"end":1013,"value":{"raw":"","cooked":""},"tail":true}]},{"type":"Literal","start":1016,"end":1020,"value":null,"raw":"null"},{"type":"MemberExpression","start":1022,"end":1028,"object":{"type":"Identifier","start":1022,"end":1025,"name":"req"},"property":{"type":"Identifier","start":1026,"end":1028,"name":"id"},"computed":false}]}},{"type":"ExpressionStatement","start":1035,"end":1107,"expression":{"type":"CallExpression","start":1035,"end":1106,"callee":{"type":"MemberExpression","start":1035,"end":1047,"object":{"type":"Identifier","start":1035,"end":1041,"name":"logger"},"property":{"type":"Identifier","start":1042,"end":1047,"name":"debug"},"computed":false},"arguments":[{"type":"MemberExpression","start":1048,"end":1074,"object":{"type":"MemberExpression","start":1048,"end":1065,"object":{"type":"MemberExpression","start":1048,"end":1059,"object":{"type":"Identifier","start":1048,"end":1051,"name":"req"},"property":{"type":"Identifier","start":1052,"end":1059,"name":"session"},"computed":false},"property":{"type":"Identifier","start":1060,"end":1065,"name":"grant"},"computed":false},"property":{"type":"Identifier","start":1066,"end":1074,"name":"response"},"computed":false},{"type":"Literal","start":1076,"end":1097,"value":"callback.oauth.resp","raw":"'callback.oauth.resp'"},{"type":"MemberExpression","start":1099,"end":1105,"object":{"type":"Identifier","start":1099,"end":1102,"name":"req"},"property":{"type":"Identifier","start":1103,"end":1105,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":1112,"end":1139,"argument":{"type":"CallExpression","start":1119,"end":1138,"callee":{"type":"MemberExpression","start":1119,"end":1133,"object":{"type":"Identifier","start":1119,"end":1122,"name":"res"},"property":{"type":"Identifier","start":1123,"end":1133,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":1134,"end":1137,"value":400,"raw":"400"}]}}]}}}}],"sourceType":"script"}