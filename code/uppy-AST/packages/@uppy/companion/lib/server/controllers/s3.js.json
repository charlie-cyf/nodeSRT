{"type":"Program","start":0,"end":10210,"body":[{"type":"VariableDeclaration","start":0,"end":41,"declarations":[{"type":"VariableDeclarator","start":6,"end":40,"id":{"type":"Identifier","start":6,"end":12,"name":"router"},"init":{"type":"MemberExpression","start":15,"end":40,"object":{"type":"CallExpression","start":15,"end":33,"callee":{"type":"Identifier","start":15,"end":22,"name":"require"},"arguments":[{"type":"Literal","start":23,"end":32,"value":"express","raw":"'express'"}]},"property":{"type":"Identifier","start":34,"end":40,"name":"Router"},"computed":false}}],"kind":"const"},{"type":"ExpressionStatement","start":42,"end":10061,"expression":{"type":"AssignmentExpression","start":42,"end":10060,"operator":"=","left":{"type":"MemberExpression","start":42,"end":56,"object":{"type":"Identifier","start":42,"end":48,"name":"module"},"property":{"type":"Identifier","start":49,"end":56,"name":"exports"},"computed":false},"right":{"type":"FunctionExpression","start":59,"end":10060,"id":{"type":"Identifier","start":68,"end":70,"name":"s3"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":71,"end":77,"name":"config"}],"body":{"type":"BlockStatement","start":79,"end":10060,"body":[{"type":"IfStatement","start":85,"end":198,"test":{"type":"BinaryExpression","start":89,"end":119,"left":{"type":"UnaryExpression","start":89,"end":106,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":96,"end":106,"object":{"type":"Identifier","start":96,"end":102,"name":"config"},"property":{"type":"Identifier","start":103,"end":106,"name":"acl"},"computed":false}},"operator":"!==","right":{"type":"Literal","start":111,"end":119,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":121,"end":198,"body":[{"type":"ThrowStatement","start":131,"end":192,"argument":{"type":"NewExpression","start":137,"end":191,"callee":{"type":"Identifier","start":141,"end":150,"name":"TypeError"},"arguments":[{"type":"Literal","start":151,"end":190,"value":"s3: The `acl` option must be a string","raw":"'s3: The `acl` option must be a string'"}]}}]},"alternate":null},{"type":"IfStatement","start":203,"end":326,"test":{"type":"BinaryExpression","start":207,"end":242,"left":{"type":"UnaryExpression","start":207,"end":227,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":214,"end":227,"object":{"type":"Identifier","start":214,"end":220,"name":"config"},"property":{"type":"Identifier","start":221,"end":227,"name":"getKey"},"computed":false}},"operator":"!==","right":{"type":"Literal","start":232,"end":242,"value":"function","raw":"'function'"}},"consequent":{"type":"BlockStatement","start":244,"end":326,"body":[{"type":"ThrowStatement","start":254,"end":320,"argument":{"type":"NewExpression","start":260,"end":319,"callee":{"type":"Identifier","start":264,"end":273,"name":"TypeError"},"arguments":[{"type":"Literal","start":274,"end":318,"value":"s3: The `getKey` option must be a function","raw":"'s3: The `getKey` option must be a function'"}]}}]},"alternate":null},{"type":"FunctionDeclaration","start":952,"end":2156,"id":{"type":"Identifier","start":961,"end":980,"name":"getUploadParameters"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":981,"end":984,"name":"req"},{"type":"Identifier","start":986,"end":989,"name":"res"},{"type":"Identifier","start":991,"end":995,"name":"next"}],"body":{"type":"BlockStatement","start":997,"end":2156,"body":[{"type":"VariableDeclaration","start":1099,"end":1137,"declarations":[{"type":"VariableDeclarator","start":1105,"end":1136,"id":{"type":"Identifier","start":1105,"end":1111,"name":"client"},"init":{"type":"MemberExpression","start":1114,"end":1136,"object":{"type":"MemberExpression","start":1114,"end":1127,"object":{"type":"Identifier","start":1114,"end":1117,"name":"req"},"property":{"type":"Identifier","start":1118,"end":1127,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1128,"end":1136,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":1146,"end":1188,"declarations":[{"type":"VariableDeclarator","start":1152,"end":1187,"id":{"type":"Identifier","start":1152,"end":1160,"name":"metadata"},"init":{"type":"LogicalExpression","start":1163,"end":1187,"left":{"type":"MemberExpression","start":1163,"end":1181,"object":{"type":"MemberExpression","start":1163,"end":1172,"object":{"type":"Identifier","start":1163,"end":1166,"name":"req"},"property":{"type":"Identifier","start":1167,"end":1172,"name":"query"},"computed":false},"property":{"type":"Identifier","start":1173,"end":1181,"name":"metadata"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":1185,"end":1187,"properties":[]}}}],"kind":"const"},{"type":"VariableDeclaration","start":1197,"end":1258,"declarations":[{"type":"VariableDeclarator","start":1203,"end":1257,"id":{"type":"Identifier","start":1203,"end":1206,"name":"key"},"init":{"type":"CallExpression","start":1209,"end":1257,"callee":{"type":"MemberExpression","start":1209,"end":1222,"object":{"type":"Identifier","start":1209,"end":1215,"name":"config"},"property":{"type":"Identifier","start":1216,"end":1222,"name":"getKey"},"computed":false},"arguments":[{"type":"Identifier","start":1223,"end":1226,"name":"req"},{"type":"MemberExpression","start":1228,"end":1246,"object":{"type":"MemberExpression","start":1228,"end":1237,"object":{"type":"Identifier","start":1228,"end":1231,"name":"req"},"property":{"type":"Identifier","start":1232,"end":1237,"name":"query"},"computed":false},"property":{"type":"Identifier","start":1238,"end":1246,"name":"filename"},"computed":false},{"type":"Identifier","start":1248,"end":1256,"name":"metadata"}]}}],"kind":"const"},{"type":"IfStatement","start":1267,"end":1415,"test":{"type":"BinaryExpression","start":1271,"end":1294,"left":{"type":"UnaryExpression","start":1271,"end":1281,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":1278,"end":1281,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":1286,"end":1294,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":1296,"end":1415,"body":[{"type":"ReturnStatement","start":1310,"end":1405,"argument":{"type":"CallExpression","start":1317,"end":1404,"callee":{"type":"MemberExpression","start":1317,"end":1337,"object":{"type":"CallExpression","start":1317,"end":1332,"callee":{"type":"MemberExpression","start":1317,"end":1327,"object":{"type":"Identifier","start":1317,"end":1320,"name":"res"},"property":{"type":"Identifier","start":1321,"end":1327,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":1328,"end":1331,"value":500,"raw":"500"}]},"property":{"type":"Identifier","start":1333,"end":1337,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":1338,"end":1403,"properties":[{"type":"Property","start":1340,"end":1401,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1340,"end":1345,"name":"error"},"value":{"type":"Literal","start":1347,"end":1401,"value":"s3: filename returned from `getKey` must be a string","raw":"'s3: filename returned from `getKey` must be a string'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"VariableDeclaration","start":1424,"end":1587,"declarations":[{"type":"VariableDeclarator","start":1430,"end":1586,"id":{"type":"Identifier","start":1430,"end":1436,"name":"fields"},"init":{"type":"ObjectExpression","start":1439,"end":1586,"properties":[{"type":"Property","start":1453,"end":1468,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1453,"end":1456,"name":"acl"},"value":{"type":"MemberExpression","start":1458,"end":1468,"object":{"type":"Identifier","start":1458,"end":1464,"name":"config"},"property":{"type":"Identifier","start":1465,"end":1468,"name":"acl"},"computed":false},"kind":"init"},{"type":"Property","start":1482,"end":1490,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1482,"end":1485,"name":"key"},"value":{"type":"Identifier","start":1487,"end":1490,"name":"key"},"kind":"init"},{"type":"Property","start":1504,"end":1532,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1504,"end":1525,"name":"success_action_status"},"value":{"type":"Literal","start":1527,"end":1532,"value":"201","raw":"'201'"},"kind":"init"},{"type":"Property","start":1546,"end":1576,"method":false,"shorthand":false,"computed":false,"key":{"type":"Literal","start":1546,"end":1560,"value":"content-type","raw":"'content-type'"},"value":{"type":"MemberExpression","start":1562,"end":1576,"object":{"type":"MemberExpression","start":1562,"end":1571,"object":{"type":"Identifier","start":1562,"end":1565,"name":"req"},"property":{"type":"Identifier","start":1566,"end":1571,"name":"query"},"computed":false},"property":{"type":"Identifier","start":1572,"end":1576,"name":"type"},"computed":false},"kind":"init"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":1596,"end":1705,"expression":{"type":"CallExpression","start":1596,"end":1704,"callee":{"type":"MemberExpression","start":1596,"end":1625,"object":{"type":"CallExpression","start":1596,"end":1617,"callee":{"type":"MemberExpression","start":1596,"end":1607,"object":{"type":"Identifier","start":1596,"end":1602,"name":"Object"},"property":{"type":"Identifier","start":1603,"end":1607,"name":"keys"},"computed":false},"arguments":[{"type":"Identifier","start":1608,"end":1616,"name":"metadata"}]},"property":{"type":"Identifier","start":1618,"end":1625,"name":"forEach"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":1626,"end":1703,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1627,"end":1630,"name":"key"}],"body":{"type":"BlockStatement","start":1635,"end":1703,"body":[{"type":"ExpressionStatement","start":1649,"end":1693,"expression":{"type":"AssignmentExpression","start":1649,"end":1692,"operator":"=","left":{"type":"MemberExpression","start":1649,"end":1676,"object":{"type":"Identifier","start":1649,"end":1655,"name":"fields"},"property":{"type":"TemplateLiteral","start":1656,"end":1675,"expressions":[{"type":"Identifier","start":1670,"end":1673,"name":"key"}],"quasis":[{"type":"TemplateElement","start":1657,"end":1668,"value":{"raw":"x-amz-meta-","cooked":"x-amz-meta-"},"tail":false},{"type":"TemplateElement","start":1674,"end":1674,"value":{"raw":"","cooked":""},"tail":true}]},"computed":true},"right":{"type":"MemberExpression","start":1679,"end":1692,"object":{"type":"Identifier","start":1679,"end":1687,"name":"metadata"},"property":{"type":"Identifier","start":1688,"end":1691,"name":"key"},"computed":true}}}]}}]}},{"type":"ExpressionStatement","start":1714,"end":2150,"expression":{"type":"CallExpression","start":1714,"end":2149,"callee":{"type":"MemberExpression","start":1714,"end":1740,"object":{"type":"Identifier","start":1714,"end":1720,"name":"client"},"property":{"type":"Identifier","start":1721,"end":1740,"name":"createPresignedPost"},"computed":false},"arguments":[{"type":"ObjectExpression","start":1741,"end":1894,"properties":[{"type":"Property","start":1755,"end":1776,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1755,"end":1761,"name":"Bucket"},"value":{"type":"MemberExpression","start":1763,"end":1776,"object":{"type":"Identifier","start":1763,"end":1769,"name":"config"},"property":{"type":"Identifier","start":1770,"end":1776,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":1790,"end":1813,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1790,"end":1797,"name":"Expires"},"value":{"type":"MemberExpression","start":1799,"end":1813,"object":{"type":"Identifier","start":1799,"end":1805,"name":"config"},"property":{"type":"Identifier","start":1806,"end":1813,"name":"expires"},"computed":false},"kind":"init"},{"type":"Property","start":1827,"end":1841,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1827,"end":1833,"name":"Fields"},"value":{"type":"Identifier","start":1835,"end":1841,"name":"fields"},"kind":"init"},{"type":"Property","start":1855,"end":1884,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":1855,"end":1865,"name":"Conditions"},"value":{"type":"MemberExpression","start":1867,"end":1884,"object":{"type":"Identifier","start":1867,"end":1873,"name":"config"},"property":{"type":"Identifier","start":1874,"end":1884,"name":"conditions"},"computed":false},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":1896,"end":2148,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1897,"end":1900,"name":"err"},{"type":"Identifier","start":1902,"end":1906,"name":"data"}],"body":{"type":"BlockStatement","start":1911,"end":2148,"body":[{"type":"IfStatement","start":1925,"end":2000,"test":{"type":"Identifier","start":1929,"end":1932,"name":"err"},"consequent":{"type":"BlockStatement","start":1934,"end":2000,"body":[{"type":"ExpressionStatement","start":1952,"end":1962,"expression":{"type":"CallExpression","start":1952,"end":1961,"callee":{"type":"Identifier","start":1952,"end":1956,"name":"next"},"arguments":[{"type":"Identifier","start":1957,"end":1960,"name":"err"}]}},{"type":"ReturnStatement","start":1979,"end":1986,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":2013,"end":2138,"expression":{"type":"CallExpression","start":2013,"end":2137,"callee":{"type":"MemberExpression","start":2013,"end":2021,"object":{"type":"Identifier","start":2013,"end":2016,"name":"res"},"property":{"type":"Identifier","start":2017,"end":2021,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":2022,"end":2136,"properties":[{"type":"Property","start":2040,"end":2054,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":2040,"end":2046,"name":"method"},"value":{"type":"Literal","start":2048,"end":2054,"value":"post","raw":"'post'"},"kind":"init"},{"type":"Property","start":2072,"end":2085,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":2072,"end":2075,"name":"url"},"value":{"type":"MemberExpression","start":2077,"end":2085,"object":{"type":"Identifier","start":2077,"end":2081,"name":"data"},"property":{"type":"Identifier","start":2082,"end":2085,"name":"url"},"computed":false},"kind":"init"},{"type":"Property","start":2103,"end":2122,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":2103,"end":2109,"name":"fields"},"value":{"type":"MemberExpression","start":2111,"end":2122,"object":{"type":"Identifier","start":2111,"end":2115,"name":"data"},"property":{"type":"Identifier","start":2116,"end":2122,"name":"fields"},"computed":false},"kind":"init"}]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":2781,"end":3861,"id":{"type":"Identifier","start":2790,"end":2811,"name":"createMultipartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":2812,"end":2815,"name":"req"},{"type":"Identifier","start":2817,"end":2820,"name":"res"},{"type":"Identifier","start":2822,"end":2826,"name":"next"}],"body":{"type":"BlockStatement","start":2828,"end":3861,"body":[{"type":"VariableDeclaration","start":2930,"end":2968,"declarations":[{"type":"VariableDeclarator","start":2936,"end":2967,"id":{"type":"Identifier","start":2936,"end":2942,"name":"client"},"init":{"type":"MemberExpression","start":2945,"end":2967,"object":{"type":"MemberExpression","start":2945,"end":2958,"object":{"type":"Identifier","start":2945,"end":2948,"name":"req"},"property":{"type":"Identifier","start":2949,"end":2958,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":2959,"end":2967,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":2977,"end":3052,"declarations":[{"type":"VariableDeclarator","start":2983,"end":3051,"id":{"type":"Identifier","start":2983,"end":2986,"name":"key"},"init":{"type":"CallExpression","start":2989,"end":3051,"callee":{"type":"MemberExpression","start":2989,"end":3002,"object":{"type":"Identifier","start":2989,"end":2995,"name":"config"},"property":{"type":"Identifier","start":2996,"end":3002,"name":"getKey"},"computed":false},"arguments":[{"type":"Identifier","start":3003,"end":3006,"name":"req"},{"type":"MemberExpression","start":3008,"end":3025,"object":{"type":"MemberExpression","start":3008,"end":3016,"object":{"type":"Identifier","start":3008,"end":3011,"name":"req"},"property":{"type":"Identifier","start":3012,"end":3016,"name":"body"},"computed":false},"property":{"type":"Identifier","start":3017,"end":3025,"name":"filename"},"computed":false},{"type":"LogicalExpression","start":3027,"end":3050,"left":{"type":"MemberExpression","start":3027,"end":3044,"object":{"type":"MemberExpression","start":3027,"end":3035,"object":{"type":"Identifier","start":3027,"end":3030,"name":"req"},"property":{"type":"Identifier","start":3031,"end":3035,"name":"body"},"computed":false},"property":{"type":"Identifier","start":3036,"end":3044,"name":"metadata"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":3048,"end":3050,"properties":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","start":3061,"end":3097,"declarations":[{"type":"VariableDeclarator","start":3067,"end":3096,"id":{"type":"ObjectPattern","start":3067,"end":3085,"properties":[{"type":"Property","start":3069,"end":3073,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":3069,"end":3073,"name":"type"},"kind":"init","value":{"type":"Identifier","start":3069,"end":3073,"name":"type"}},{"type":"Property","start":3075,"end":3083,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":3075,"end":3083,"name":"metadata"},"kind":"init","value":{"type":"Identifier","start":3075,"end":3083,"name":"metadata"}}]},"init":{"type":"MemberExpression","start":3088,"end":3096,"object":{"type":"Identifier","start":3088,"end":3091,"name":"req"},"property":{"type":"Identifier","start":3092,"end":3096,"name":"body"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":3106,"end":3254,"test":{"type":"BinaryExpression","start":3110,"end":3133,"left":{"type":"UnaryExpression","start":3110,"end":3120,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":3117,"end":3120,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":3125,"end":3133,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":3135,"end":3254,"body":[{"type":"ReturnStatement","start":3149,"end":3244,"argument":{"type":"CallExpression","start":3156,"end":3243,"callee":{"type":"MemberExpression","start":3156,"end":3176,"object":{"type":"CallExpression","start":3156,"end":3171,"callee":{"type":"MemberExpression","start":3156,"end":3166,"object":{"type":"Identifier","start":3156,"end":3159,"name":"res"},"property":{"type":"Identifier","start":3160,"end":3166,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":3167,"end":3170,"value":500,"raw":"500"}]},"property":{"type":"Identifier","start":3172,"end":3176,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":3177,"end":3242,"properties":[{"type":"Property","start":3179,"end":3240,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3179,"end":3184,"name":"error"},"value":{"type":"Literal","start":3186,"end":3240,"value":"s3: filename returned from `getKey` must be a string","raw":"'s3: filename returned from `getKey` must be a string'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"IfStatement","start":3263,"end":3393,"test":{"type":"BinaryExpression","start":3267,"end":3291,"left":{"type":"UnaryExpression","start":3267,"end":3278,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":3274,"end":3278,"name":"type"}},"operator":"!==","right":{"type":"Literal","start":3283,"end":3291,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":3293,"end":3393,"body":[{"type":"ReturnStatement","start":3307,"end":3383,"argument":{"type":"CallExpression","start":3314,"end":3382,"callee":{"type":"MemberExpression","start":3314,"end":3334,"object":{"type":"CallExpression","start":3314,"end":3329,"callee":{"type":"MemberExpression","start":3314,"end":3324,"object":{"type":"Identifier","start":3314,"end":3317,"name":"res"},"property":{"type":"Identifier","start":3318,"end":3324,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":3325,"end":3328,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":3330,"end":3334,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":3335,"end":3381,"properties":[{"type":"Property","start":3337,"end":3379,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3337,"end":3342,"name":"error"},"value":{"type":"Literal","start":3344,"end":3379,"value":"s3: content type must be a string","raw":"'s3: content type must be a string'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":3402,"end":3855,"expression":{"type":"CallExpression","start":3402,"end":3854,"callee":{"type":"MemberExpression","start":3402,"end":3430,"object":{"type":"Identifier","start":3402,"end":3408,"name":"client"},"property":{"type":"Identifier","start":3409,"end":3430,"name":"createMultipartUpload"},"computed":false},"arguments":[{"type":"ObjectExpression","start":3431,"end":3627,"properties":[{"type":"Property","start":3445,"end":3466,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3445,"end":3451,"name":"Bucket"},"value":{"type":"MemberExpression","start":3453,"end":3466,"object":{"type":"Identifier","start":3453,"end":3459,"name":"config"},"property":{"type":"Identifier","start":3460,"end":3466,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":3480,"end":3488,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3480,"end":3483,"name":"Key"},"value":{"type":"Identifier","start":3485,"end":3488,"name":"key"},"kind":"init"},{"type":"Property","start":3502,"end":3517,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3502,"end":3505,"name":"ACL"},"value":{"type":"MemberExpression","start":3507,"end":3517,"object":{"type":"Identifier","start":3507,"end":3513,"name":"config"},"property":{"type":"Identifier","start":3514,"end":3517,"name":"acl"},"computed":false},"kind":"init"},{"type":"Property","start":3531,"end":3548,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3531,"end":3542,"name":"ContentType"},"value":{"type":"Identifier","start":3544,"end":3548,"name":"type"},"kind":"init"},{"type":"Property","start":3562,"end":3580,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3562,"end":3570,"name":"Metadata"},"value":{"type":"Identifier","start":3572,"end":3580,"name":"metadata"},"kind":"init"},{"type":"Property","start":3594,"end":3617,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3594,"end":3601,"name":"Expires"},"value":{"type":"MemberExpression","start":3603,"end":3617,"object":{"type":"Identifier","start":3603,"end":3609,"name":"config"},"property":{"type":"Identifier","start":3610,"end":3617,"name":"expires"},"computed":false},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":3629,"end":3853,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":3630,"end":3633,"name":"err"},{"type":"Identifier","start":3635,"end":3639,"name":"data"}],"body":{"type":"BlockStatement","start":3644,"end":3853,"body":[{"type":"IfStatement","start":3658,"end":3733,"test":{"type":"Identifier","start":3662,"end":3665,"name":"err"},"consequent":{"type":"BlockStatement","start":3667,"end":3733,"body":[{"type":"ExpressionStatement","start":3685,"end":3695,"expression":{"type":"CallExpression","start":3685,"end":3694,"callee":{"type":"Identifier","start":3685,"end":3689,"name":"next"},"arguments":[{"type":"Identifier","start":3690,"end":3693,"name":"err"}]}},{"type":"ReturnStatement","start":3712,"end":3719,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":3746,"end":3843,"expression":{"type":"CallExpression","start":3746,"end":3842,"callee":{"type":"MemberExpression","start":3746,"end":3754,"object":{"type":"Identifier","start":3746,"end":3749,"name":"res"},"property":{"type":"Identifier","start":3750,"end":3754,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":3755,"end":3841,"properties":[{"type":"Property","start":3773,"end":3786,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3773,"end":3776,"name":"key"},"value":{"type":"MemberExpression","start":3778,"end":3786,"object":{"type":"Identifier","start":3778,"end":3782,"name":"data"},"property":{"type":"Identifier","start":3783,"end":3786,"name":"Key"},"computed":false},"kind":"init"},{"type":"Property","start":3804,"end":3827,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":3804,"end":3812,"name":"uploadId"},"value":{"type":"MemberExpression","start":3814,"end":3827,"object":{"type":"Identifier","start":3814,"end":3818,"name":"data"},"property":{"type":"Identifier","start":3819,"end":3827,"name":"UploadId"},"computed":false},"kind":"init"}]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":4367,"end":5593,"id":{"type":"Identifier","start":4376,"end":4392,"name":"getUploadedParts"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":4393,"end":4396,"name":"req"},{"type":"Identifier","start":4398,"end":4401,"name":"res"},{"type":"Identifier","start":4403,"end":4407,"name":"next"}],"body":{"type":"BlockStatement","start":4409,"end":5593,"body":[{"type":"VariableDeclaration","start":4511,"end":4549,"declarations":[{"type":"VariableDeclarator","start":4517,"end":4548,"id":{"type":"Identifier","start":4517,"end":4523,"name":"client"},"init":{"type":"MemberExpression","start":4526,"end":4548,"object":{"type":"MemberExpression","start":4526,"end":4539,"object":{"type":"Identifier","start":4526,"end":4529,"name":"req"},"property":{"type":"Identifier","start":4530,"end":4539,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":4540,"end":4548,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":4558,"end":4590,"declarations":[{"type":"VariableDeclarator","start":4564,"end":4589,"id":{"type":"ObjectPattern","start":4564,"end":4576,"properties":[{"type":"Property","start":4566,"end":4574,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":4566,"end":4574,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":4566,"end":4574,"name":"uploadId"}}]},"init":{"type":"MemberExpression","start":4579,"end":4589,"object":{"type":"Identifier","start":4579,"end":4582,"name":"req"},"property":{"type":"Identifier","start":4583,"end":4589,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":4599,"end":4625,"declarations":[{"type":"VariableDeclarator","start":4605,"end":4624,"id":{"type":"ObjectPattern","start":4605,"end":4612,"properties":[{"type":"Property","start":4607,"end":4610,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":4607,"end":4610,"name":"key"},"kind":"init","value":{"type":"Identifier","start":4607,"end":4610,"name":"key"}}]},"init":{"type":"MemberExpression","start":4615,"end":4624,"object":{"type":"Identifier","start":4615,"end":4618,"name":"req"},"property":{"type":"Identifier","start":4619,"end":4624,"name":"query"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":4634,"end":4813,"test":{"type":"BinaryExpression","start":4638,"end":4661,"left":{"type":"UnaryExpression","start":4638,"end":4648,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":4645,"end":4648,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":4653,"end":4661,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":4663,"end":4813,"body":[{"type":"ReturnStatement","start":4677,"end":4803,"argument":{"type":"CallExpression","start":4684,"end":4802,"callee":{"type":"MemberExpression","start":4684,"end":4704,"object":{"type":"CallExpression","start":4684,"end":4699,"callee":{"type":"MemberExpression","start":4684,"end":4694,"object":{"type":"Identifier","start":4684,"end":4687,"name":"res"},"property":{"type":"Identifier","start":4688,"end":4694,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":4695,"end":4698,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":4700,"end":4704,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":4705,"end":4801,"properties":[{"type":"Property","start":4707,"end":4799,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4707,"end":4712,"name":"error"},"value":{"type":"Literal","start":4714,"end":4799,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"VariableDeclaration","start":4822,"end":4837,"declarations":[{"type":"VariableDeclarator","start":4826,"end":4836,"id":{"type":"Identifier","start":4826,"end":4831,"name":"parts"},"init":{"type":"ArrayExpression","start":4834,"end":4836,"elements":[]}}],"kind":"let"},{"type":"ExpressionStatement","start":4846,"end":4863,"expression":{"type":"CallExpression","start":4846,"end":4862,"callee":{"type":"Identifier","start":4846,"end":4859,"name":"listPartsPage"},"arguments":[{"type":"Literal","start":4860,"end":4861,"value":0,"raw":"0"}]}},{"type":"FunctionDeclaration","start":4872,"end":5522,"id":{"type":"Identifier","start":4881,"end":4894,"name":"listPartsPage"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":4895,"end":4902,"name":"startAt"}],"body":{"type":"BlockStatement","start":4904,"end":5522,"body":[{"type":"ExpressionStatement","start":4918,"end":5512,"expression":{"type":"CallExpression","start":4918,"end":5511,"callee":{"type":"MemberExpression","start":4918,"end":4934,"object":{"type":"Identifier","start":4918,"end":4924,"name":"client"},"property":{"type":"Identifier","start":4925,"end":4934,"name":"listParts"},"computed":false},"arguments":[{"type":"ObjectExpression","start":4935,"end":5093,"properties":[{"type":"Property","start":4953,"end":4974,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4953,"end":4959,"name":"Bucket"},"value":{"type":"MemberExpression","start":4961,"end":4974,"object":{"type":"Identifier","start":4961,"end":4967,"name":"config"},"property":{"type":"Identifier","start":4968,"end":4974,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":4992,"end":5000,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":4992,"end":4995,"name":"Key"},"value":{"type":"Identifier","start":4997,"end":5000,"name":"key"},"kind":"init"},{"type":"Property","start":5018,"end":5036,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":5018,"end":5026,"name":"UploadId"},"value":{"type":"Identifier","start":5028,"end":5036,"name":"uploadId"},"kind":"init"},{"type":"Property","start":5054,"end":5079,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":5054,"end":5070,"name":"PartNumberMarker"},"value":{"type":"Identifier","start":5072,"end":5079,"name":"startAt"},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":5095,"end":5510,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":5096,"end":5099,"name":"err"},{"type":"Identifier","start":5101,"end":5105,"name":"data"}],"body":{"type":"BlockStatement","start":5110,"end":5510,"body":[{"type":"IfStatement","start":5128,"end":5215,"test":{"type":"Identifier","start":5132,"end":5135,"name":"err"},"consequent":{"type":"BlockStatement","start":5137,"end":5215,"body":[{"type":"ExpressionStatement","start":5159,"end":5169,"expression":{"type":"CallExpression","start":5159,"end":5168,"callee":{"type":"Identifier","start":5159,"end":5163,"name":"next"},"arguments":[{"type":"Identifier","start":5164,"end":5167,"name":"err"}]}},{"type":"ReturnStatement","start":5190,"end":5197,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":5232,"end":5265,"expression":{"type":"AssignmentExpression","start":5232,"end":5264,"operator":"=","left":{"type":"Identifier","start":5232,"end":5237,"name":"parts"},"right":{"type":"CallExpression","start":5240,"end":5264,"callee":{"type":"MemberExpression","start":5240,"end":5252,"object":{"type":"Identifier","start":5240,"end":5245,"name":"parts"},"property":{"type":"Identifier","start":5246,"end":5252,"name":"concat"},"computed":false},"arguments":[{"type":"MemberExpression","start":5253,"end":5263,"object":{"type":"Identifier","start":5253,"end":5257,"name":"data"},"property":{"type":"Identifier","start":5258,"end":5263,"name":"Parts"},"computed":false}]}}},{"type":"IfStatement","start":5282,"end":5496,"test":{"type":"MemberExpression","start":5286,"end":5302,"object":{"type":"Identifier","start":5286,"end":5290,"name":"data"},"property":{"type":"Identifier","start":5291,"end":5302,"name":"IsTruncated"},"computed":false},"consequent":{"type":"BlockStatement","start":5304,"end":5427,"body":[{"type":"ExpressionStatement","start":5368,"end":5409,"expression":{"type":"CallExpression","start":5368,"end":5408,"callee":{"type":"Identifier","start":5368,"end":5381,"name":"listPartsPage"},"arguments":[{"type":"MemberExpression","start":5382,"end":5407,"object":{"type":"Identifier","start":5382,"end":5386,"name":"data"},"property":{"type":"Identifier","start":5387,"end":5407,"name":"NextPartNumberMarker"},"computed":false}]}}]},"alternate":{"type":"BlockStatement","start":5449,"end":5496,"body":[{"type":"ExpressionStatement","start":5471,"end":5478,"expression":{"type":"CallExpression","start":5471,"end":5477,"callee":{"type":"Identifier","start":5471,"end":5475,"name":"done"},"arguments":[]}}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":5531,"end":5587,"id":{"type":"Identifier","start":5540,"end":5544,"name":"done"},"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":5547,"end":5587,"body":[{"type":"ExpressionStatement","start":5561,"end":5577,"expression":{"type":"CallExpression","start":5561,"end":5576,"callee":{"type":"MemberExpression","start":5561,"end":5569,"object":{"type":"Identifier","start":5561,"end":5564,"name":"res"},"property":{"type":"Identifier","start":5565,"end":5569,"name":"json"},"computed":false},"arguments":[{"type":"Identifier","start":5570,"end":5575,"name":"parts"}]}}]}}]}},{"type":"FunctionDeclaration","start":6014,"end":7025,"id":{"type":"Identifier","start":6023,"end":6037,"name":"signPartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":6038,"end":6041,"name":"req"},{"type":"Identifier","start":6043,"end":6046,"name":"res"},{"type":"Identifier","start":6048,"end":6052,"name":"next"}],"body":{"type":"BlockStatement","start":6054,"end":7025,"body":[{"type":"VariableDeclaration","start":6156,"end":6194,"declarations":[{"type":"VariableDeclarator","start":6162,"end":6193,"id":{"type":"Identifier","start":6162,"end":6168,"name":"client"},"init":{"type":"MemberExpression","start":6171,"end":6193,"object":{"type":"MemberExpression","start":6171,"end":6184,"object":{"type":"Identifier","start":6171,"end":6174,"name":"req"},"property":{"type":"Identifier","start":6175,"end":6184,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":6185,"end":6193,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":6203,"end":6247,"declarations":[{"type":"VariableDeclarator","start":6209,"end":6246,"id":{"type":"ObjectPattern","start":6209,"end":6233,"properties":[{"type":"Property","start":6211,"end":6219,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":6211,"end":6219,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":6211,"end":6219,"name":"uploadId"}},{"type":"Property","start":6221,"end":6231,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":6221,"end":6231,"name":"partNumber"},"kind":"init","value":{"type":"Identifier","start":6221,"end":6231,"name":"partNumber"}}]},"init":{"type":"MemberExpression","start":6236,"end":6246,"object":{"type":"Identifier","start":6236,"end":6239,"name":"req"},"property":{"type":"Identifier","start":6240,"end":6246,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":6256,"end":6282,"declarations":[{"type":"VariableDeclarator","start":6262,"end":6281,"id":{"type":"ObjectPattern","start":6262,"end":6269,"properties":[{"type":"Property","start":6264,"end":6267,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":6264,"end":6267,"name":"key"},"kind":"init","value":{"type":"Identifier","start":6264,"end":6267,"name":"key"}}]},"init":{"type":"MemberExpression","start":6272,"end":6281,"object":{"type":"Identifier","start":6272,"end":6275,"name":"req"},"property":{"type":"Identifier","start":6276,"end":6281,"name":"query"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":6291,"end":6470,"test":{"type":"BinaryExpression","start":6295,"end":6318,"left":{"type":"UnaryExpression","start":6295,"end":6305,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":6302,"end":6305,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":6310,"end":6318,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":6320,"end":6470,"body":[{"type":"ReturnStatement","start":6334,"end":6460,"argument":{"type":"CallExpression","start":6341,"end":6459,"callee":{"type":"MemberExpression","start":6341,"end":6361,"object":{"type":"CallExpression","start":6341,"end":6356,"callee":{"type":"MemberExpression","start":6341,"end":6351,"object":{"type":"Identifier","start":6341,"end":6344,"name":"res"},"property":{"type":"Identifier","start":6345,"end":6351,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":6352,"end":6355,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":6357,"end":6361,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":6362,"end":6458,"properties":[{"type":"Property","start":6364,"end":6456,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6364,"end":6369,"name":"error"},"value":{"type":"Literal","start":6371,"end":6456,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"IfStatement","start":6479,"end":6634,"test":{"type":"UnaryExpression","start":6483,"end":6508,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":6484,"end":6508,"callee":{"type":"Identifier","start":6484,"end":6492,"name":"parseInt"},"arguments":[{"type":"Identifier","start":6493,"end":6503,"name":"partNumber"},{"type":"Literal","start":6505,"end":6507,"value":10,"raw":"10"}]}},"consequent":{"type":"BlockStatement","start":6510,"end":6634,"body":[{"type":"ReturnStatement","start":6524,"end":6624,"argument":{"type":"CallExpression","start":6531,"end":6623,"callee":{"type":"MemberExpression","start":6531,"end":6551,"object":{"type":"CallExpression","start":6531,"end":6546,"callee":{"type":"MemberExpression","start":6531,"end":6541,"object":{"type":"Identifier","start":6531,"end":6534,"name":"res"},"property":{"type":"Identifier","start":6535,"end":6541,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":6542,"end":6545,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":6547,"end":6551,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":6552,"end":6622,"properties":[{"type":"Property","start":6554,"end":6620,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6554,"end":6559,"name":"error"},"value":{"type":"Literal","start":6561,"end":6620,"value":"s3: the part number must be a number between 1 and 10000.","raw":"'s3: the part number must be a number between 1 and 10000.'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":6643,"end":7019,"expression":{"type":"CallExpression","start":6643,"end":7018,"callee":{"type":"MemberExpression","start":6643,"end":6662,"object":{"type":"Identifier","start":6643,"end":6649,"name":"client"},"property":{"type":"Identifier","start":6650,"end":6662,"name":"getSignedUrl"},"computed":false},"arguments":[{"type":"Literal","start":6663,"end":6675,"value":"uploadPart","raw":"'uploadPart'"},{"type":"ObjectExpression","start":6677,"end":6871,"properties":[{"type":"Property","start":6691,"end":6712,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6691,"end":6697,"name":"Bucket"},"value":{"type":"MemberExpression","start":6699,"end":6712,"object":{"type":"Identifier","start":6699,"end":6705,"name":"config"},"property":{"type":"Identifier","start":6706,"end":6712,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":6726,"end":6734,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6726,"end":6729,"name":"Key"},"value":{"type":"Identifier","start":6731,"end":6734,"name":"key"},"kind":"init"},{"type":"Property","start":6748,"end":6766,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6748,"end":6756,"name":"UploadId"},"value":{"type":"Identifier","start":6758,"end":6766,"name":"uploadId"},"kind":"init"},{"type":"Property","start":6780,"end":6802,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6780,"end":6790,"name":"PartNumber"},"value":{"type":"Identifier","start":6792,"end":6802,"name":"partNumber"},"kind":"init"},{"type":"Property","start":6816,"end":6824,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6816,"end":6820,"name":"Body"},"value":{"type":"Literal","start":6822,"end":6824,"value":"","raw":"''"},"kind":"init"},{"type":"Property","start":6838,"end":6861,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":6838,"end":6845,"name":"Expires"},"value":{"type":"MemberExpression","start":6847,"end":6861,"object":{"type":"Identifier","start":6847,"end":6853,"name":"config"},"property":{"type":"Identifier","start":6854,"end":6861,"name":"expires"},"computed":false},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":6873,"end":7017,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":6874,"end":6877,"name":"err"},{"type":"Identifier","start":6879,"end":6882,"name":"url"}],"body":{"type":"BlockStatement","start":6887,"end":7017,"body":[{"type":"IfStatement","start":6901,"end":6976,"test":{"type":"Identifier","start":6905,"end":6908,"name":"err"},"consequent":{"type":"BlockStatement","start":6910,"end":6976,"body":[{"type":"ExpressionStatement","start":6928,"end":6938,"expression":{"type":"CallExpression","start":6928,"end":6937,"callee":{"type":"Identifier","start":6928,"end":6932,"name":"next"},"arguments":[{"type":"Identifier","start":6933,"end":6936,"name":"err"}]}},{"type":"ReturnStatement","start":6955,"end":6962,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":6989,"end":7007,"expression":{"type":"CallExpression","start":6989,"end":7006,"callee":{"type":"MemberExpression","start":6989,"end":6997,"object":{"type":"Identifier","start":6989,"end":6992,"name":"res"},"property":{"type":"Identifier","start":6993,"end":6997,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":6998,"end":7005,"properties":[{"type":"Property","start":7000,"end":7003,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":7000,"end":7003,"name":"url"},"kind":"init","value":{"type":"Identifier","start":7000,"end":7003,"name":"url"}}]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":7345,"end":8081,"id":{"type":"Identifier","start":7354,"end":7374,"name":"abortMultipartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":7375,"end":7378,"name":"req"},{"type":"Identifier","start":7380,"end":7383,"name":"res"},{"type":"Identifier","start":7385,"end":7389,"name":"next"}],"body":{"type":"BlockStatement","start":7391,"end":8081,"body":[{"type":"VariableDeclaration","start":7493,"end":7531,"declarations":[{"type":"VariableDeclarator","start":7499,"end":7530,"id":{"type":"Identifier","start":7499,"end":7505,"name":"client"},"init":{"type":"MemberExpression","start":7508,"end":7530,"object":{"type":"MemberExpression","start":7508,"end":7521,"object":{"type":"Identifier","start":7508,"end":7511,"name":"req"},"property":{"type":"Identifier","start":7512,"end":7521,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":7522,"end":7530,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":7540,"end":7572,"declarations":[{"type":"VariableDeclarator","start":7546,"end":7571,"id":{"type":"ObjectPattern","start":7546,"end":7558,"properties":[{"type":"Property","start":7548,"end":7556,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":7548,"end":7556,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":7548,"end":7556,"name":"uploadId"}}]},"init":{"type":"MemberExpression","start":7561,"end":7571,"object":{"type":"Identifier","start":7561,"end":7564,"name":"req"},"property":{"type":"Identifier","start":7565,"end":7571,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":7581,"end":7607,"declarations":[{"type":"VariableDeclarator","start":7587,"end":7606,"id":{"type":"ObjectPattern","start":7587,"end":7594,"properties":[{"type":"Property","start":7589,"end":7592,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":7589,"end":7592,"name":"key"},"kind":"init","value":{"type":"Identifier","start":7589,"end":7592,"name":"key"}}]},"init":{"type":"MemberExpression","start":7597,"end":7606,"object":{"type":"Identifier","start":7597,"end":7600,"name":"req"},"property":{"type":"Identifier","start":7601,"end":7606,"name":"query"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":7616,"end":7795,"test":{"type":"BinaryExpression","start":7620,"end":7643,"left":{"type":"UnaryExpression","start":7620,"end":7630,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":7627,"end":7630,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":7635,"end":7643,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":7645,"end":7795,"body":[{"type":"ReturnStatement","start":7659,"end":7785,"argument":{"type":"CallExpression","start":7666,"end":7784,"callee":{"type":"MemberExpression","start":7666,"end":7686,"object":{"type":"CallExpression","start":7666,"end":7681,"callee":{"type":"MemberExpression","start":7666,"end":7676,"object":{"type":"Identifier","start":7666,"end":7669,"name":"res"},"property":{"type":"Identifier","start":7670,"end":7676,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":7677,"end":7680,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":7682,"end":7686,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":7687,"end":7783,"properties":[{"type":"Property","start":7689,"end":7781,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":7689,"end":7694,"name":"error"},"value":{"type":"Literal","start":7696,"end":7781,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":7804,"end":8075,"expression":{"type":"CallExpression","start":7804,"end":8074,"callee":{"type":"MemberExpression","start":7804,"end":7831,"object":{"type":"Identifier","start":7804,"end":7810,"name":"client"},"property":{"type":"Identifier","start":7811,"end":7831,"name":"abortMultipartUpload"},"computed":false},"arguments":[{"type":"ObjectExpression","start":7832,"end":7931,"properties":[{"type":"Property","start":7846,"end":7867,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":7846,"end":7852,"name":"Bucket"},"value":{"type":"MemberExpression","start":7854,"end":7867,"object":{"type":"Identifier","start":7854,"end":7860,"name":"config"},"property":{"type":"Identifier","start":7861,"end":7867,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":7881,"end":7889,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":7881,"end":7884,"name":"Key"},"value":{"type":"Identifier","start":7886,"end":7889,"name":"key"},"kind":"init"},{"type":"Property","start":7903,"end":7921,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":7903,"end":7911,"name":"UploadId"},"value":{"type":"Identifier","start":7913,"end":7921,"name":"uploadId"},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":7933,"end":8073,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":7934,"end":7937,"name":"err"},{"type":"Identifier","start":7939,"end":7943,"name":"data"}],"body":{"type":"BlockStatement","start":7948,"end":8073,"body":[{"type":"IfStatement","start":7962,"end":8037,"test":{"type":"Identifier","start":7966,"end":7969,"name":"err"},"consequent":{"type":"BlockStatement","start":7971,"end":8037,"body":[{"type":"ExpressionStatement","start":7989,"end":7999,"expression":{"type":"CallExpression","start":7989,"end":7998,"callee":{"type":"Identifier","start":7989,"end":7993,"name":"next"},"arguments":[{"type":"Identifier","start":7994,"end":7997,"name":"err"}]}},{"type":"ReturnStatement","start":8016,"end":8023,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":8050,"end":8063,"expression":{"type":"CallExpression","start":8050,"end":8062,"callee":{"type":"MemberExpression","start":8050,"end":8058,"object":{"type":"Identifier","start":8050,"end":8053,"name":"res"},"property":{"type":"Identifier","start":8054,"end":8058,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":8059,"end":8061,"properties":[]}]}}]}}]}}]}},{"type":"FunctionDeclaration","start":8590,"end":9687,"id":{"type":"Identifier","start":8599,"end":8622,"name":"completeMultipartUpload"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":8623,"end":8626,"name":"req"},{"type":"Identifier","start":8628,"end":8631,"name":"res"},{"type":"Identifier","start":8633,"end":8637,"name":"next"}],"body":{"type":"BlockStatement","start":8639,"end":9687,"body":[{"type":"VariableDeclaration","start":8741,"end":8779,"declarations":[{"type":"VariableDeclarator","start":8747,"end":8778,"id":{"type":"Identifier","start":8747,"end":8753,"name":"client"},"init":{"type":"MemberExpression","start":8756,"end":8778,"object":{"type":"MemberExpression","start":8756,"end":8769,"object":{"type":"Identifier","start":8756,"end":8759,"name":"req"},"property":{"type":"Identifier","start":8760,"end":8769,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":8770,"end":8778,"name":"s3Client"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":8788,"end":8820,"declarations":[{"type":"VariableDeclarator","start":8794,"end":8819,"id":{"type":"ObjectPattern","start":8794,"end":8806,"properties":[{"type":"Property","start":8796,"end":8804,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":8796,"end":8804,"name":"uploadId"},"kind":"init","value":{"type":"Identifier","start":8796,"end":8804,"name":"uploadId"}}]},"init":{"type":"MemberExpression","start":8809,"end":8819,"object":{"type":"Identifier","start":8809,"end":8812,"name":"req"},"property":{"type":"Identifier","start":8813,"end":8819,"name":"params"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":8829,"end":8855,"declarations":[{"type":"VariableDeclarator","start":8835,"end":8854,"id":{"type":"ObjectPattern","start":8835,"end":8842,"properties":[{"type":"Property","start":8837,"end":8840,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":8837,"end":8840,"name":"key"},"kind":"init","value":{"type":"Identifier","start":8837,"end":8840,"name":"key"}}]},"init":{"type":"MemberExpression","start":8845,"end":8854,"object":{"type":"Identifier","start":8845,"end":8848,"name":"req"},"property":{"type":"Identifier","start":8849,"end":8854,"name":"query"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":8864,"end":8891,"declarations":[{"type":"VariableDeclarator","start":8870,"end":8890,"id":{"type":"ObjectPattern","start":8870,"end":8879,"properties":[{"type":"Property","start":8872,"end":8877,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":8872,"end":8877,"name":"parts"},"kind":"init","value":{"type":"Identifier","start":8872,"end":8877,"name":"parts"}}]},"init":{"type":"MemberExpression","start":8882,"end":8890,"object":{"type":"Identifier","start":8882,"end":8885,"name":"req"},"property":{"type":"Identifier","start":8886,"end":8890,"name":"body"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":8900,"end":9079,"test":{"type":"BinaryExpression","start":8904,"end":8927,"left":{"type":"UnaryExpression","start":8904,"end":8914,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":8911,"end":8914,"name":"key"}},"operator":"!==","right":{"type":"Literal","start":8919,"end":8927,"value":"string","raw":"'string'"}},"consequent":{"type":"BlockStatement","start":8929,"end":9079,"body":[{"type":"ReturnStatement","start":8943,"end":9069,"argument":{"type":"CallExpression","start":8950,"end":9068,"callee":{"type":"MemberExpression","start":8950,"end":8970,"object":{"type":"CallExpression","start":8950,"end":8965,"callee":{"type":"MemberExpression","start":8950,"end":8960,"object":{"type":"Identifier","start":8950,"end":8953,"name":"res"},"property":{"type":"Identifier","start":8954,"end":8960,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":8961,"end":8964,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":8966,"end":8970,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":8971,"end":9067,"properties":[{"type":"Property","start":8973,"end":9065,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":8973,"end":8978,"name":"error"},"value":{"type":"Literal","start":8980,"end":9065,"value":"s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"","raw":"'s3: the object key must be passed as a query parameter. For example: \"?key=abc.jpg\"'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"IfStatement","start":9088,"end":9270,"test":{"type":"LogicalExpression","start":9092,"end":9142,"left":{"type":"UnaryExpression","start":9092,"end":9113,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":9093,"end":9113,"callee":{"type":"MemberExpression","start":9093,"end":9106,"object":{"type":"Identifier","start":9093,"end":9098,"name":"Array"},"property":{"type":"Identifier","start":9099,"end":9106,"name":"isArray"},"computed":false},"arguments":[{"type":"Identifier","start":9107,"end":9112,"name":"parts"}]}},"operator":"||","right":{"type":"UnaryExpression","start":9117,"end":9142,"operator":"!","prefix":true,"argument":{"type":"CallExpression","start":9118,"end":9142,"callee":{"type":"MemberExpression","start":9118,"end":9129,"object":{"type":"Identifier","start":9118,"end":9123,"name":"parts"},"property":{"type":"Identifier","start":9124,"end":9129,"name":"every"},"computed":false},"arguments":[{"type":"Identifier","start":9130,"end":9141,"name":"isValidPart"}]}}},"consequent":{"type":"BlockStatement","start":9144,"end":9270,"body":[{"type":"ReturnStatement","start":9158,"end":9260,"argument":{"type":"CallExpression","start":9165,"end":9259,"callee":{"type":"MemberExpression","start":9165,"end":9185,"object":{"type":"CallExpression","start":9165,"end":9180,"callee":{"type":"MemberExpression","start":9165,"end":9175,"object":{"type":"Identifier","start":9165,"end":9168,"name":"res"},"property":{"type":"Identifier","start":9169,"end":9175,"name":"status"},"computed":false},"arguments":[{"type":"Literal","start":9176,"end":9179,"value":400,"raw":"400"}]},"property":{"type":"Identifier","start":9181,"end":9185,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":9186,"end":9258,"properties":[{"type":"Property","start":9188,"end":9256,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9188,"end":9193,"name":"error"},"value":{"type":"Literal","start":9195,"end":9256,"value":"s3: `parts` must be an array of {ETag, PartNumber} objects.","raw":"'s3: `parts` must be an array of {ETag, PartNumber} objects.'"},"kind":"init"}]}]}}]},"alternate":null},{"type":"ExpressionStatement","start":9279,"end":9681,"expression":{"type":"CallExpression","start":9279,"end":9680,"callee":{"type":"MemberExpression","start":9279,"end":9309,"object":{"type":"Identifier","start":9279,"end":9285,"name":"client"},"property":{"type":"Identifier","start":9286,"end":9309,"name":"completeMultipartUpload"},"computed":false},"arguments":[{"type":"ObjectExpression","start":9310,"end":9484,"properties":[{"type":"Property","start":9324,"end":9345,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9324,"end":9330,"name":"Bucket"},"value":{"type":"MemberExpression","start":9332,"end":9345,"object":{"type":"Identifier","start":9332,"end":9338,"name":"config"},"property":{"type":"Identifier","start":9339,"end":9345,"name":"bucket"},"computed":false},"kind":"init"},{"type":"Property","start":9359,"end":9367,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9359,"end":9362,"name":"Key"},"value":{"type":"Identifier","start":9364,"end":9367,"name":"key"},"kind":"init"},{"type":"Property","start":9381,"end":9399,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9381,"end":9389,"name":"UploadId"},"value":{"type":"Identifier","start":9391,"end":9399,"name":"uploadId"},"kind":"init"},{"type":"Property","start":9413,"end":9474,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9413,"end":9428,"name":"MultipartUpload"},"value":{"type":"ObjectExpression","start":9430,"end":9474,"properties":[{"type":"Property","start":9448,"end":9460,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9448,"end":9453,"name":"Parts"},"value":{"type":"Identifier","start":9455,"end":9460,"name":"parts"},"kind":"init"}]},"kind":"init"}]},{"type":"ArrowFunctionExpression","start":9486,"end":9679,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":9487,"end":9490,"name":"err"},{"type":"Identifier","start":9492,"end":9496,"name":"data"}],"body":{"type":"BlockStatement","start":9501,"end":9679,"body":[{"type":"IfStatement","start":9515,"end":9590,"test":{"type":"Identifier","start":9519,"end":9522,"name":"err"},"consequent":{"type":"BlockStatement","start":9524,"end":9590,"body":[{"type":"ExpressionStatement","start":9542,"end":9552,"expression":{"type":"CallExpression","start":9542,"end":9551,"callee":{"type":"Identifier","start":9542,"end":9546,"name":"next"},"arguments":[{"type":"Identifier","start":9547,"end":9550,"name":"err"}]}},{"type":"ReturnStatement","start":9569,"end":9576,"argument":null}]},"alternate":null},{"type":"ExpressionStatement","start":9603,"end":9669,"expression":{"type":"CallExpression","start":9603,"end":9668,"callee":{"type":"MemberExpression","start":9603,"end":9611,"object":{"type":"Identifier","start":9603,"end":9606,"name":"res"},"property":{"type":"Identifier","start":9607,"end":9611,"name":"json"},"computed":false},"arguments":[{"type":"ObjectExpression","start":9612,"end":9667,"properties":[{"type":"Property","start":9630,"end":9653,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":9630,"end":9638,"name":"location"},"value":{"type":"MemberExpression","start":9640,"end":9653,"object":{"type":"Identifier","start":9640,"end":9644,"name":"data"},"property":{"type":"Identifier","start":9645,"end":9653,"name":"Location"},"computed":false},"kind":"init"}]}]}}]}}]}}]}},{"type":"ReturnStatement","start":9692,"end":10058,"argument":{"type":"CallExpression","start":9699,"end":10057,"callee":{"type":"MemberExpression","start":9699,"end":10011,"object":{"type":"CallExpression","start":9699,"end":9995,"callee":{"type":"MemberExpression","start":9699,"end":9937,"object":{"type":"CallExpression","start":9699,"end":9923,"callee":{"type":"MemberExpression","start":9699,"end":9871,"object":{"type":"CallExpression","start":9699,"end":9858,"callee":{"type":"MemberExpression","start":9699,"end":9816,"object":{"type":"CallExpression","start":9699,"end":9803,"callee":{"type":"MemberExpression","start":9699,"end":9766,"object":{"type":"CallExpression","start":9699,"end":9752,"callee":{"type":"MemberExpression","start":9699,"end":9720,"object":{"type":"CallExpression","start":9699,"end":9707,"callee":{"type":"Identifier","start":9699,"end":9705,"name":"router"},"arguments":[]},"property":{"type":"Identifier","start":9717,"end":9720,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":9721,"end":9730,"value":"/params","raw":"'/params'"},{"type":"Identifier","start":9732,"end":9751,"name":"getUploadParameters"}]},"property":{"type":"Identifier","start":9762,"end":9766,"name":"post"},"computed":false},"arguments":[{"type":"Literal","start":9767,"end":9779,"value":"/multipart","raw":"'/multipart'"},{"type":"Identifier","start":9781,"end":9802,"name":"createMultipartUpload"}]},"property":{"type":"Identifier","start":9813,"end":9816,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":9817,"end":9839,"value":"/multipart/:uploadId","raw":"'/multipart/:uploadId'"},{"type":"Identifier","start":9841,"end":9857,"name":"getUploadedParts"}]},"property":{"type":"Identifier","start":9868,"end":9871,"name":"get"},"computed":false},"arguments":[{"type":"Literal","start":9872,"end":9906,"value":"/multipart/:uploadId/:partNumber","raw":"'/multipart/:uploadId/:partNumber'"},{"type":"Identifier","start":9908,"end":9922,"name":"signPartUpload"}]},"property":{"type":"Identifier","start":9933,"end":9937,"name":"post"},"computed":false},"arguments":[{"type":"Literal","start":9938,"end":9969,"value":"/multipart/:uploadId/complete","raw":"'/multipart/:uploadId/complete'"},{"type":"Identifier","start":9971,"end":9994,"name":"completeMultipartUpload"}]},"property":{"type":"Identifier","start":10005,"end":10011,"name":"delete"},"computed":false},"arguments":[{"type":"Literal","start":10012,"end":10034,"value":"/multipart/:uploadId","raw":"'/multipart/:uploadId'"},{"type":"Identifier","start":10036,"end":10056,"name":"abortMultipartUpload"}]}}]}}}},{"type":"FunctionDeclaration","start":10062,"end":10209,"id":{"type":"Identifier","start":10071,"end":10082,"name":"isValidPart"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":10083,"end":10087,"name":"part"}],"body":{"type":"BlockStatement","start":10089,"end":10209,"body":[{"type":"ReturnStatement","start":10095,"end":10207,"argument":{"type":"LogicalExpression","start":10102,"end":10206,"left":{"type":"LogicalExpression","start":10102,"end":10173,"left":{"type":"LogicalExpression","start":10102,"end":10134,"left":{"type":"Identifier","start":10102,"end":10106,"name":"part"},"operator":"&&","right":{"type":"BinaryExpression","start":10110,"end":10134,"left":{"type":"UnaryExpression","start":10110,"end":10121,"operator":"typeof","prefix":true,"argument":{"type":"Identifier","start":10117,"end":10121,"name":"part"}},"operator":"===","right":{"type":"Literal","start":10126,"end":10134,"value":"object","raw":"'object'"}}},"operator":"&&","right":{"type":"BinaryExpression","start":10138,"end":10173,"left":{"type":"UnaryExpression","start":10138,"end":10160,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":10145,"end":10160,"object":{"type":"Identifier","start":10145,"end":10149,"name":"part"},"property":{"type":"Identifier","start":10150,"end":10160,"name":"PartNumber"},"computed":false}},"operator":"===","right":{"type":"Literal","start":10165,"end":10173,"value":"number","raw":"'number'"}}},"operator":"&&","right":{"type":"BinaryExpression","start":10177,"end":10206,"left":{"type":"UnaryExpression","start":10177,"end":10193,"operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","start":10184,"end":10193,"object":{"type":"Identifier","start":10184,"end":10188,"name":"part"},"property":{"type":"Identifier","start":10189,"end":10193,"name":"ETag"},"computed":false}},"operator":"===","right":{"type":"Literal","start":10198,"end":10206,"value":"string","raw":"'string'"}}}}]}}],"sourceType":"script"}