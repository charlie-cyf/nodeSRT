{"type":"Program","start":0,"end":2456,"body":[{"type":"VariableDeclaration","start":46,"end":93,"declarations":[{"type":"VariableDeclarator","start":52,"end":92,"id":{"type":"Identifier","start":52,"end":64,"name":"tokenService"},"init":{"type":"CallExpression","start":67,"end":92,"callee":{"type":"Identifier","start":67,"end":74,"name":"require"},"arguments":[{"type":"Literal","start":75,"end":91,"value":"../helpers/jwt","raw":"'../helpers/jwt'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":94,"end":132,"declarations":[{"type":"VariableDeclarator","start":100,"end":131,"id":{"type":"Identifier","start":100,"end":108,"name":"parseUrl"},"init":{"type":"MemberExpression","start":111,"end":131,"object":{"type":"CallExpression","start":111,"end":125,"callee":{"type":"Identifier","start":111,"end":118,"name":"require"},"arguments":[{"type":"Literal","start":119,"end":124,"value":"url","raw":"'url'"}]},"property":{"type":"Identifier","start":126,"end":131,"name":"parse"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":179,"end":242,"declarations":[{"type":"VariableDeclarator","start":185,"end":241,"id":{"type":"ObjectPattern","start":185,"end":211,"properties":[{"type":"Property","start":187,"end":195,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":187,"end":195,"name":"hasMatch"},"kind":"init","value":{"type":"Identifier","start":187,"end":195,"name":"hasMatch"}},{"type":"Property","start":197,"end":209,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":197,"end":209,"name":"sanitizeHtml"},"kind":"init","value":{"type":"Identifier","start":197,"end":209,"name":"sanitizeHtml"}}]},"init":{"type":"CallExpression","start":214,"end":241,"callee":{"type":"Identifier","start":214,"end":221,"name":"require"},"arguments":[{"type":"Literal","start":222,"end":240,"value":"../helpers/utils","raw":"'../helpers/utils'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":243,"end":296,"declarations":[{"type":"VariableDeclarator","start":249,"end":295,"id":{"type":"Identifier","start":249,"end":259,"name":"oAuthState"},"init":{"type":"CallExpression","start":262,"end":295,"callee":{"type":"Identifier","start":262,"end":269,"name":"require"},"arguments":[{"type":"Literal","start":270,"end":294,"value":"../helpers/oauth-state","raw":"'../helpers/oauth-state'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":297,"end":346,"declarations":[{"type":"VariableDeclarator","start":303,"end":345,"id":{"type":"Identifier","start":303,"end":313,"name":"versionCmp"},"init":{"type":"CallExpression","start":316,"end":345,"callee":{"type":"Identifier","start":316,"end":323,"name":"require"},"arguments":[{"type":"Literal","start":324,"end":344,"value":"../helpers/version","raw":"'../helpers/version'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":430,"end":1569,"expression":{"type":"AssignmentExpression","start":430,"end":1568,"operator":"=","left":{"type":"MemberExpression","start":430,"end":444,"object":{"type":"Identifier","start":430,"end":436,"name":"module"},"property":{"type":"Identifier","start":437,"end":444,"name":"exports"},"computed":false},"right":{"type":"FunctionExpression","start":447,"end":1568,"id":{"type":"Identifier","start":456,"end":465,"name":"sendToken"},"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":466,"end":469,"name":"req"},{"type":"Identifier","start":471,"end":474,"name":"res"},{"type":"Identifier","start":476,"end":480,"name":"next"}],"body":{"type":"BlockStatement","start":482,"end":1568,"body":[{"type":"VariableDeclaration","start":488,"end":534,"declarations":[{"type":"VariableDeclarator","start":494,"end":533,"id":{"type":"Identifier","start":494,"end":507,"name":"uppyAuthToken"},"init":{"type":"MemberExpression","start":510,"end":533,"object":{"type":"MemberExpression","start":510,"end":523,"object":{"type":"Identifier","start":510,"end":513,"name":"req"},"property":{"type":"Identifier","start":514,"end":523,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":524,"end":533,"name":"authToken"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":616,"end":782,"test":{"type":"MemberExpression","start":620,"end":658,"object":{"type":"MemberExpression","start":620,"end":642,"object":{"type":"MemberExpression","start":620,"end":633,"object":{"type":"Identifier","start":620,"end":623,"name":"req"},"property":{"type":"Identifier","start":624,"end":633,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":634,"end":642,"name":"provider"},"computed":false},"property":{"type":"Identifier","start":643,"end":658,"name":"needsCookieAuth"},"computed":false},"consequent":{"type":"BlockStatement","start":660,"end":782,"body":[{"type":"ExpressionStatement","start":670,"end":776,"expression":{"type":"CallExpression","start":670,"end":775,"callee":{"type":"MemberExpression","start":670,"end":695,"object":{"type":"Identifier","start":670,"end":682,"name":"tokenService"},"property":{"type":"Identifier","start":683,"end":695,"name":"addToCookies"},"computed":false},"arguments":[{"type":"Identifier","start":696,"end":699,"name":"res"},{"type":"Identifier","start":701,"end":714,"name":"uppyAuthToken"},{"type":"MemberExpression","start":716,"end":737,"object":{"type":"MemberExpression","start":716,"end":729,"object":{"type":"Identifier","start":716,"end":719,"name":"req"},"property":{"type":"Identifier","start":720,"end":729,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":730,"end":737,"name":"options"},"computed":false},{"type":"MemberExpression","start":739,"end":774,"object":{"type":"MemberExpression","start":739,"end":761,"object":{"type":"MemberExpression","start":739,"end":752,"object":{"type":"Identifier","start":739,"end":742,"name":"req"},"property":{"type":"Identifier","start":743,"end":752,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":753,"end":761,"name":"provider"},"computed":false},"property":{"type":"Identifier","start":762,"end":774,"name":"authProvider"},"computed":false}]}}]},"alternate":null},{"type":"VariableDeclaration","start":787,"end":843,"declarations":[{"type":"VariableDeclarator","start":793,"end":842,"id":{"type":"Identifier","start":793,"end":800,"name":"dynamic"},"init":{"type":"LogicalExpression","start":803,"end":842,"left":{"type":"MemberExpression","start":803,"end":836,"object":{"type":"LogicalExpression","start":804,"end":827,"left":{"type":"MemberExpression","start":804,"end":821,"object":{"type":"MemberExpression","start":804,"end":815,"object":{"type":"Identifier","start":804,"end":807,"name":"req"},"property":{"type":"Identifier","start":808,"end":815,"name":"session"},"computed":false},"property":{"type":"Identifier","start":816,"end":821,"name":"grant"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":825,"end":827,"properties":[]}},"property":{"type":"Identifier","start":829,"end":836,"name":"dynamic"},"computed":false},"operator":"||","right":{"type":"ObjectExpression","start":840,"end":842,"properties":[]}}}],"kind":"const"},{"type":"VariableDeclaration","start":848,"end":876,"declarations":[{"type":"VariableDeclarator","start":854,"end":875,"id":{"type":"Identifier","start":854,"end":859,"name":"state"},"init":{"type":"MemberExpression","start":862,"end":875,"object":{"type":"Identifier","start":862,"end":869,"name":"dynamic"},"property":{"type":"Identifier","start":870,"end":875,"name":"state"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":881,"end":1554,"test":{"type":"Identifier","start":885,"end":890,"name":"state"},"consequent":{"type":"BlockStatement","start":892,"end":1554,"body":[{"type":"VariableDeclaration","start":902,"end":988,"declarations":[{"type":"VariableDeclarator","start":908,"end":987,"id":{"type":"Identifier","start":908,"end":914,"name":"origin"},"init":{"type":"CallExpression","start":917,"end":987,"callee":{"type":"MemberExpression","start":917,"end":940,"object":{"type":"Identifier","start":917,"end":927,"name":"oAuthState"},"property":{"type":"Identifier","start":928,"end":940,"name":"getFromState"},"computed":false},"arguments":[{"type":"Identifier","start":941,"end":946,"name":"state"},{"type":"Literal","start":948,"end":956,"value":"origin","raw":"'origin'"},{"type":"MemberExpression","start":958,"end":986,"object":{"type":"MemberExpression","start":958,"end":979,"object":{"type":"MemberExpression","start":958,"end":971,"object":{"type":"Identifier","start":958,"end":961,"name":"req"},"property":{"type":"Identifier","start":962,"end":971,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":972,"end":979,"name":"options"},"computed":false},"property":{"type":"Identifier","start":980,"end":986,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"VariableDeclaration","start":997,"end":1097,"declarations":[{"type":"VariableDeclarator","start":1003,"end":1096,"id":{"type":"Identifier","start":1003,"end":1016,"name":"clientVersion"},"init":{"type":"CallExpression","start":1019,"end":1096,"callee":{"type":"MemberExpression","start":1019,"end":1042,"object":{"type":"Identifier","start":1019,"end":1029,"name":"oAuthState"},"property":{"type":"Identifier","start":1030,"end":1042,"name":"getFromState"},"computed":false},"arguments":[{"type":"Identifier","start":1043,"end":1048,"name":"state"},{"type":"Literal","start":1050,"end":1065,"value":"clientVersion","raw":"'clientVersion'"},{"type":"MemberExpression","start":1067,"end":1095,"object":{"type":"MemberExpression","start":1067,"end":1088,"object":{"type":"MemberExpression","start":1067,"end":1080,"object":{"type":"Identifier","start":1067,"end":1070,"name":"req"},"property":{"type":"Identifier","start":1071,"end":1080,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1081,"end":1088,"name":"options"},"computed":false},"property":{"type":"Identifier","start":1089,"end":1095,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"VariableDeclaration","start":1106,"end":1159,"declarations":[{"type":"VariableDeclarator","start":1112,"end":1158,"id":{"type":"Identifier","start":1112,"end":1126,"name":"allowedClients"},"init":{"type":"MemberExpression","start":1129,"end":1158,"object":{"type":"MemberExpression","start":1129,"end":1150,"object":{"type":"MemberExpression","start":1129,"end":1142,"object":{"type":"Identifier","start":1129,"end":1132,"name":"req"},"property":{"type":"Identifier","start":1133,"end":1142,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1143,"end":1150,"name":"options"},"computed":false},"property":{"type":"Identifier","start":1151,"end":1158,"name":"clients"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":1222,"end":1548,"test":{"type":"LogicalExpression","start":1226,"end":1328,"left":{"type":"LogicalExpression","start":1226,"end":1277,"left":{"type":"UnaryExpression","start":1226,"end":1241,"operator":"!","prefix":true,"argument":{"type":"Identifier","start":1227,"end":1241,"name":"allowedClients"}},"operator":"||","right":{"type":"CallExpression","start":1245,"end":1277,"callee":{"type":"Identifier","start":1245,"end":1253,"name":"hasMatch"},"arguments":[{"type":"Identifier","start":1254,"end":1260,"name":"origin"},{"type":"Identifier","start":1262,"end":1276,"name":"allowedClients"}]}},"operator":"||","right":{"type":"CallExpression","start":1281,"end":1328,"callee":{"type":"Identifier","start":1281,"end":1289,"name":"hasMatch"},"arguments":[{"type":"MemberExpression","start":1290,"end":1311,"object":{"type":"CallExpression","start":1290,"end":1306,"callee":{"type":"Identifier","start":1290,"end":1298,"name":"parseUrl"},"arguments":[{"type":"Identifier","start":1299,"end":1305,"name":"origin"}]},"property":{"type":"Identifier","start":1307,"end":1311,"name":"host"},"computed":false},{"type":"Identifier","start":1313,"end":1327,"name":"allowedClients"}]}},"consequent":{"type":"BlockStatement","start":1330,"end":1548,"body":[{"type":"VariableDeclaration","start":1344,"end":1411,"declarations":[{"type":"VariableDeclarator","start":1350,"end":1410,"id":{"type":"Identifier","start":1350,"end":1369,"name":"allowsStringMessage"},"init":{"type":"CallExpression","start":1372,"end":1410,"callee":{"type":"MemberExpression","start":1372,"end":1386,"object":{"type":"Identifier","start":1372,"end":1382,"name":"versionCmp"},"property":{"type":"Identifier","start":1383,"end":1386,"name":"gte"},"computed":false},"arguments":[{"type":"Identifier","start":1387,"end":1400,"name":"clientVersion"},{"type":"Literal","start":1402,"end":1409,"value":"1.0.2","raw":"'1.0.2'"}]}}],"kind":"const"},{"type":"ReturnStatement","start":1424,"end":1538,"argument":{"type":"CallExpression","start":1431,"end":1537,"callee":{"type":"MemberExpression","start":1431,"end":1439,"object":{"type":"Identifier","start":1431,"end":1434,"name":"res"},"property":{"type":"Identifier","start":1435,"end":1439,"name":"send"},"computed":false},"arguments":[{"type":"ConditionalExpression","start":1440,"end":1536,"test":{"type":"Identifier","start":1440,"end":1459,"name":"allowsStringMessage"},"consequent":{"type":"CallExpression","start":1462,"end":1496,"callee":{"type":"Identifier","start":1462,"end":1473,"name":"htmlContent"},"arguments":[{"type":"Identifier","start":1474,"end":1487,"name":"uppyAuthToken"},{"type":"Identifier","start":1489,"end":1495,"name":"origin"}]},"alternate":{"type":"CallExpression","start":1499,"end":1536,"callee":{"type":"Identifier","start":1499,"end":1513,"name":"oldHtmlContent"},"arguments":[{"type":"Identifier","start":1514,"end":1527,"name":"uppyAuthToken"},{"type":"Identifier","start":1529,"end":1535,"name":"origin"}]}}]}}]},"alternate":null}]},"alternate":null},{"type":"ExpressionStatement","start":1559,"end":1566,"expression":{"type":"CallExpression","start":1559,"end":1565,"callee":{"type":"Identifier","start":1559,"end":1563,"name":"next"},"arguments":[]}}]}}}},{"type":"VariableDeclaration","start":1659,"end":1994,"declarations":[{"type":"VariableDeclarator","start":1665,"end":1993,"id":{"type":"Identifier","start":1665,"end":1676,"name":"htmlContent"},"init":{"type":"ArrowFunctionExpression","start":1679,"end":1993,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1680,"end":1685,"name":"token"},{"type":"Identifier","start":1687,"end":1693,"name":"origin"}],"body":{"type":"BlockStatement","start":1698,"end":1993,"body":[{"type":"ReturnStatement","start":1704,"end":1991,"argument":{"type":"TemplateLiteral","start":1711,"end":1990,"expressions":[{"type":"Identifier","start":1867,"end":1872,"name":"token"},{"type":"CallExpression","start":1881,"end":1901,"callee":{"type":"Identifier","start":1881,"end":1893,"name":"sanitizeHtml"},"arguments":[{"type":"Identifier","start":1894,"end":1900,"name":"origin"}]}],"quasis":[{"type":"TemplateElement","start":1712,"end":1865,"value":{"raw":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage(JSON.stringify({token: \"","cooked":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage(JSON.stringify({token: \""},"tail":false},{"type":"TemplateElement","start":1873,"end":1879,"value":{"raw":"\"}), \"","cooked":"\"}), \""},"tail":false},{"type":"TemplateElement","start":1902,"end":1989,"value":{"raw":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>","cooked":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>"},"tail":true}]}}]}}}],"kind":"const"},{"type":"VariableDeclaration","start":2133,"end":2455,"declarations":[{"type":"VariableDeclarator","start":2139,"end":2454,"id":{"type":"Identifier","start":2139,"end":2153,"name":"oldHtmlContent"},"init":{"type":"ArrowFunctionExpression","start":2156,"end":2454,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":2157,"end":2162,"name":"token"},{"type":"Identifier","start":2164,"end":2170,"name":"origin"}],"body":{"type":"BlockStatement","start":2175,"end":2454,"body":[{"type":"ReturnStatement","start":2181,"end":2452,"argument":{"type":"TemplateLiteral","start":2188,"end":2451,"expressions":[{"type":"Identifier","start":2329,"end":2334,"name":"token"},{"type":"CallExpression","start":2342,"end":2362,"callee":{"type":"Identifier","start":2342,"end":2354,"name":"sanitizeHtml"},"arguments":[{"type":"Identifier","start":2355,"end":2361,"name":"origin"}]}],"quasis":[{"type":"TemplateElement","start":2189,"end":2327,"value":{"raw":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage({token: \"","cooked":"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <script>\n          window.opener.postMessage({token: \""},"tail":false},{"type":"TemplateElement","start":2335,"end":2340,"value":{"raw":"\"}, \"","cooked":"\"}, \""},"tail":false},{"type":"TemplateElement","start":2363,"end":2450,"value":{"raw":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>","cooked":"\")\n          window.close()\n        </script>\n    </head>\n    <body></body>\n    </html>"},"tail":true}]}}]}}}],"kind":"const"}],"sourceType":"script"}