{"type":"Program","start":0,"end":1693,"body":[{"type":"VariableDeclaration","start":0,"end":46,"declarations":[{"type":"VariableDeclarator","start":6,"end":45,"id":{"type":"Identifier","start":6,"end":18,"name":"tokenService"},"init":{"type":"CallExpression","start":21,"end":45,"callee":{"type":"Identifier","start":21,"end":28,"name":"require"},"arguments":[{"type":"Literal","start":29,"end":44,"value":"./helpers/jwt","raw":"'./helpers/jwt'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":47,"end":82,"declarations":[{"type":"VariableDeclarator","start":53,"end":81,"id":{"type":"Identifier","start":53,"end":59,"name":"logger"},"init":{"type":"CallExpression","start":62,"end":81,"callee":{"type":"Identifier","start":62,"end":69,"name":"require"},"arguments":[{"type":"Literal","start":70,"end":80,"value":"./logger","raw":"'./logger'"}]}}],"kind":"const"},{"type":"ExpressionStatement","start":83,"end":508,"expression":{"type":"AssignmentExpression","start":83,"end":507,"operator":"=","left":{"type":"MemberExpression","start":83,"end":112,"object":{"type":"Identifier","start":83,"end":90,"name":"exports"},"property":{"type":"Identifier","start":91,"end":112,"name":"hasSessionAndProvider"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":115,"end":507,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":116,"end":119,"name":"req"},{"type":"Identifier","start":121,"end":124,"name":"res"},{"type":"Identifier","start":126,"end":130,"name":"next"}],"body":{"type":"BlockStatement","start":135,"end":507,"body":[{"type":"IfStatement","start":141,"end":314,"test":{"type":"LogicalExpression","start":145,"end":170,"left":{"type":"UnaryExpression","start":145,"end":157,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":146,"end":157,"object":{"type":"Identifier","start":146,"end":149,"name":"req"},"property":{"type":"Identifier","start":150,"end":157,"name":"session"},"computed":false}},"operator":"||","right":{"type":"UnaryExpression","start":161,"end":170,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":162,"end":170,"object":{"type":"Identifier","start":162,"end":165,"name":"req"},"property":{"type":"Identifier","start":166,"end":170,"name":"body"},"computed":false}}},"consequent":{"type":"BlockStatement","start":172,"end":314,"body":[{"type":"ExpressionStatement","start":182,"end":272,"expression":{"type":"CallExpression","start":182,"end":271,"callee":{"type":"MemberExpression","start":182,"end":194,"object":{"type":"Identifier","start":182,"end":188,"name":"logger"},"property":{"type":"Identifier","start":189,"end":194,"name":"debug"},"computed":false},"arguments":[{"type":"Literal","start":195,"end":256,"value":"No session/body attached to req object. Exiting dispatcher.","raw":"'No session/body attached to req object. Exiting dispatcher.'"},{"type":"Literal","start":258,"end":262,"value":null,"raw":"null"},{"type":"MemberExpression","start":264,"end":270,"object":{"type":"Identifier","start":264,"end":267,"name":"req"},"property":{"type":"Identifier","start":268,"end":270,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":281,"end":308,"argument":{"type":"CallExpression","start":288,"end":307,"callee":{"type":"MemberExpression","start":288,"end":302,"object":{"type":"Identifier","start":288,"end":291,"name":"res"},"property":{"type":"Identifier","start":292,"end":302,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":303,"end":306,"value":400,"raw":"400"}]}}]},"alternate":null},{"type":"IfStatement","start":319,"end":486,"test":{"type":"UnaryExpression","start":323,"end":346,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":324,"end":346,"object":{"type":"MemberExpression","start":324,"end":337,"object":{"type":"Identifier","start":324,"end":327,"name":"req"},"property":{"type":"Identifier","start":328,"end":337,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":338,"end":346,"name":"provider"},"computed":false}},"consequent":{"type":"BlockStatement","start":348,"end":486,"body":[{"type":"ExpressionStatement","start":358,"end":444,"expression":{"type":"CallExpression","start":358,"end":443,"callee":{"type":"MemberExpression","start":358,"end":370,"object":{"type":"Identifier","start":358,"end":364,"name":"logger"},"property":{"type":"Identifier","start":365,"end":370,"name":"debug"},"computed":false},"arguments":[{"type":"Literal","start":371,"end":428,"value":"No provider/provider-handler found. Exiting dispatcher.","raw":"'No provider/provider-handler found. Exiting dispatcher.'"},{"type":"Literal","start":430,"end":434,"value":null,"raw":"null"},{"type":"MemberExpression","start":436,"end":442,"object":{"type":"Identifier","start":436,"end":439,"name":"req"},"property":{"type":"Identifier","start":440,"end":442,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":453,"end":480,"argument":{"type":"CallExpression","start":460,"end":479,"callee":{"type":"MemberExpression","start":460,"end":474,"object":{"type":"Identifier","start":460,"end":463,"name":"res"},"property":{"type":"Identifier","start":464,"end":474,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":475,"end":478,"value":400,"raw":"400"}]}}]},"alternate":null},{"type":"ReturnStatement","start":491,"end":505,"argument":{"type":"CallExpression","start":498,"end":504,"callee":{"type":"Identifier","start":498,"end":502,"name":"next"},"arguments":[]}}]}}}},{"type":"ExpressionStatement","start":509,"end":1108,"expression":{"type":"AssignmentExpression","start":509,"end":1107,"operator":"=","left":{"type":"MemberExpression","start":509,"end":528,"object":{"type":"Identifier","start":509,"end":516,"name":"exports"},"property":{"type":"Identifier","start":517,"end":528,"name":"verifyToken"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":531,"end":1107,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":532,"end":535,"name":"req"},{"type":"Identifier","start":537,"end":540,"name":"res"},{"type":"Identifier","start":542,"end":546,"name":"next"}],"body":{"type":"BlockStatement","start":551,"end":1107,"body":[{"type":"VariableDeclaration","start":557,"end":595,"declarations":[{"type":"VariableDeclarator","start":563,"end":594,"id":{"type":"Identifier","start":563,"end":568,"name":"token"},"init":{"type":"MemberExpression","start":571,"end":594,"object":{"type":"MemberExpression","start":571,"end":584,"object":{"type":"Identifier","start":571,"end":574,"name":"req"},"property":{"type":"Identifier","start":575,"end":584,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":585,"end":594,"name":"authToken"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":600,"end":734,"test":{"type":"BinaryExpression","start":604,"end":617,"left":{"type":"Identifier","start":604,"end":609,"name":"token"},"operator":"==","right":{"type":"Literal","start":613,"end":617,"value":null,"raw":"null"}},"consequent":{"type":"BlockStatement","start":619,"end":734,"body":[{"type":"ExpressionStatement","start":629,"end":692,"expression":{"type":"CallExpression","start":629,"end":691,"callee":{"type":"MemberExpression","start":629,"end":640,"object":{"type":"Identifier","start":629,"end":635,"name":"logger"},"property":{"type":"Identifier","start":636,"end":640,"name":"info"},"computed":false},"arguments":[{"type":"Literal","start":641,"end":660,"value":"cannot auth token","raw":"'cannot auth token'"},{"type":"Literal","start":662,"end":682,"value":"token.verify.unset","raw":"'token.verify.unset'"},{"type":"MemberExpression","start":684,"end":690,"object":{"type":"Identifier","start":684,"end":687,"name":"req"},"property":{"type":"Identifier","start":688,"end":690,"name":"id"},"computed":false}]}},{"type":"ReturnStatement","start":701,"end":728,"argument":{"type":"CallExpression","start":708,"end":727,"callee":{"type":"MemberExpression","start":708,"end":722,"object":{"type":"Identifier","start":708,"end":711,"name":"res"},"property":{"type":"Identifier","start":712,"end":722,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":723,"end":726,"value":401,"raw":"401"}]}}]},"alternate":null},{"type":"VariableDeclaration","start":739,"end":784,"declarations":[{"type":"VariableDeclarator","start":745,"end":783,"id":{"type":"Identifier","start":745,"end":757,"name":"providerName"},"init":{"type":"MemberExpression","start":760,"end":783,"object":{"type":"MemberExpression","start":760,"end":770,"object":{"type":"Identifier","start":760,"end":763,"name":"req"},"property":{"type":"Identifier","start":764,"end":770,"name":"params"},"computed":false},"property":{"type":"Identifier","start":771,"end":783,"name":"providerName"},"computed":false}}],"kind":"const"},{"type":"VariableDeclaration","start":789,"end":876,"declarations":[{"type":"VariableDeclarator","start":795,"end":875,"id":{"type":"ObjectPattern","start":795,"end":811,"properties":[{"type":"Property","start":797,"end":800,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":797,"end":800,"name":"err"},"kind":"init","value":{"type":"Identifier","start":797,"end":800,"name":"err"}},{"type":"Property","start":802,"end":809,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":802,"end":809,"name":"payload"},"kind":"init","value":{"type":"Identifier","start":802,"end":809,"name":"payload"}}]},"init":{"type":"CallExpression","start":814,"end":875,"callee":{"type":"MemberExpression","start":814,"end":838,"object":{"type":"Identifier","start":814,"end":826,"name":"tokenService"},"property":{"type":"Identifier","start":827,"end":838,"name":"verifyToken"},"computed":false},"arguments":[{"type":"Identifier","start":839,"end":844,"name":"token"},{"type":"MemberExpression","start":846,"end":874,"object":{"type":"MemberExpression","start":846,"end":867,"object":{"type":"MemberExpression","start":846,"end":859,"object":{"type":"Identifier","start":846,"end":849,"name":"req"},"property":{"type":"Identifier","start":850,"end":859,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":860,"end":867,"name":"options"},"computed":false},"property":{"type":"Identifier","start":868,"end":874,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"IfStatement","start":881,"end":1049,"test":{"type":"LogicalExpression","start":885,"end":914,"left":{"type":"Identifier","start":885,"end":888,"name":"err"},"operator":"||","right":{"type":"UnaryExpression","start":892,"end":914,"operator":"!","prefix":true,"argument":{"type":"MemberExpression","start":893,"end":914,"object":{"type":"Identifier","start":893,"end":900,"name":"payload"},"property":{"type":"Identifier","start":901,"end":913,"name":"providerName"},"computed":true}}},"consequent":{"type":"BlockStatement","start":916,"end":1049,"body":[{"type":"IfStatement","start":926,"end":1007,"test":{"type":"Identifier","start":930,"end":933,"name":"err"},"consequent":{"type":"BlockStatement","start":935,"end":1007,"body":[{"type":"ExpressionStatement","start":949,"end":997,"expression":{"type":"CallExpression","start":949,"end":996,"callee":{"type":"MemberExpression","start":949,"end":961,"object":{"type":"Identifier","start":949,"end":955,"name":"logger"},"property":{"type":"Identifier","start":956,"end":961,"name":"error"},"computed":false},"arguments":[{"type":"Identifier","start":962,"end":965,"name":"err"},{"type":"Literal","start":967,"end":987,"value":"token.verify.error","raw":"'token.verify.error'"},{"type":"MemberExpression","start":989,"end":995,"object":{"type":"Identifier","start":989,"end":992,"name":"req"},"property":{"type":"Identifier","start":993,"end":995,"name":"id"},"computed":false}]}}]},"alternate":null},{"type":"ReturnStatement","start":1016,"end":1043,"argument":{"type":"CallExpression","start":1023,"end":1042,"callee":{"type":"MemberExpression","start":1023,"end":1037,"object":{"type":"Identifier","start":1023,"end":1026,"name":"res"},"property":{"type":"Identifier","start":1027,"end":1037,"name":"sendStatus"},"computed":false},"arguments":[{"type":"Literal","start":1038,"end":1041,"value":401,"raw":"401"}]}}]},"alternate":null},{"type":"ExpressionStatement","start":1054,"end":1093,"expression":{"type":"AssignmentExpression","start":1054,"end":1092,"operator":"=","left":{"type":"MemberExpression","start":1054,"end":1082,"object":{"type":"MemberExpression","start":1054,"end":1067,"object":{"type":"Identifier","start":1054,"end":1057,"name":"req"},"property":{"type":"Identifier","start":1058,"end":1067,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1068,"end":1082,"name":"providerTokens"},"computed":false},"right":{"type":"Identifier","start":1085,"end":1092,"name":"payload"}}},{"type":"ExpressionStatement","start":1098,"end":1105,"expression":{"type":"CallExpression","start":1098,"end":1104,"callee":{"type":"Identifier","start":1098,"end":1102,"name":"next"},"arguments":[]}}]}}}},{"type":"ExpressionStatement","start":1146,"end":1522,"expression":{"type":"AssignmentExpression","start":1146,"end":1521,"operator":"=","left":{"type":"MemberExpression","start":1146,"end":1171,"object":{"type":"Identifier","start":1146,"end":1153,"name":"exports"},"property":{"type":"Identifier","start":1154,"end":1171,"name":"gentleVerifyToken"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":1174,"end":1521,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1175,"end":1178,"name":"req"},{"type":"Identifier","start":1180,"end":1183,"name":"res"},{"type":"Identifier","start":1185,"end":1189,"name":"next"}],"body":{"type":"BlockStatement","start":1194,"end":1521,"body":[{"type":"VariableDeclaration","start":1200,"end":1245,"declarations":[{"type":"VariableDeclarator","start":1206,"end":1244,"id":{"type":"Identifier","start":1206,"end":1218,"name":"providerName"},"init":{"type":"MemberExpression","start":1221,"end":1244,"object":{"type":"MemberExpression","start":1221,"end":1231,"object":{"type":"Identifier","start":1221,"end":1224,"name":"req"},"property":{"type":"Identifier","start":1225,"end":1231,"name":"params"},"computed":false},"property":{"type":"Identifier","start":1232,"end":1244,"name":"providerName"},"computed":false}}],"kind":"const"},{"type":"IfStatement","start":1250,"end":1507,"test":{"type":"MemberExpression","start":1254,"end":1277,"object":{"type":"MemberExpression","start":1254,"end":1267,"object":{"type":"Identifier","start":1254,"end":1257,"name":"req"},"property":{"type":"Identifier","start":1258,"end":1267,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1268,"end":1277,"name":"authToken"},"computed":false},"consequent":{"type":"BlockStatement","start":1279,"end":1507,"body":[{"type":"VariableDeclaration","start":1289,"end":1394,"declarations":[{"type":"VariableDeclarator","start":1295,"end":1393,"id":{"type":"ObjectPattern","start":1295,"end":1311,"properties":[{"type":"Property","start":1297,"end":1300,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1297,"end":1300,"name":"err"},"kind":"init","value":{"type":"Identifier","start":1297,"end":1300,"name":"err"}},{"type":"Property","start":1302,"end":1309,"method":false,"shorthand":true,"computed":false,"key":{"type":"Identifier","start":1302,"end":1309,"name":"payload"},"kind":"init","value":{"type":"Identifier","start":1302,"end":1309,"name":"payload"}}]},"init":{"type":"CallExpression","start":1314,"end":1393,"callee":{"type":"MemberExpression","start":1314,"end":1338,"object":{"type":"Identifier","start":1314,"end":1326,"name":"tokenService"},"property":{"type":"Identifier","start":1327,"end":1338,"name":"verifyToken"},"computed":false},"arguments":[{"type":"MemberExpression","start":1339,"end":1362,"object":{"type":"MemberExpression","start":1339,"end":1352,"object":{"type":"Identifier","start":1339,"end":1342,"name":"req"},"property":{"type":"Identifier","start":1343,"end":1352,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1353,"end":1362,"name":"authToken"},"computed":false},{"type":"MemberExpression","start":1364,"end":1392,"object":{"type":"MemberExpression","start":1364,"end":1385,"object":{"type":"MemberExpression","start":1364,"end":1377,"object":{"type":"Identifier","start":1364,"end":1367,"name":"req"},"property":{"type":"Identifier","start":1368,"end":1377,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1378,"end":1385,"name":"options"},"computed":false},"property":{"type":"Identifier","start":1386,"end":1392,"name":"secret"},"computed":false}]}}],"kind":"const"},{"type":"IfStatement","start":1403,"end":1501,"test":{"type":"LogicalExpression","start":1407,"end":1436,"left":{"type":"UnaryExpression","start":1407,"end":1411,"operator":"!","prefix":true,"argument":{"type":"Identifier","start":1408,"end":1411,"name":"err"}},"operator":"&&","right":{"type":"MemberExpression","start":1415,"end":1436,"object":{"type":"Identifier","start":1415,"end":1422,"name":"payload"},"property":{"type":"Identifier","start":1423,"end":1435,"name":"providerName"},"computed":true}},"consequent":{"type":"BlockStatement","start":1438,"end":1501,"body":[{"type":"ExpressionStatement","start":1452,"end":1491,"expression":{"type":"AssignmentExpression","start":1452,"end":1490,"operator":"=","left":{"type":"MemberExpression","start":1452,"end":1480,"object":{"type":"MemberExpression","start":1452,"end":1465,"object":{"type":"Identifier","start":1452,"end":1455,"name":"req"},"property":{"type":"Identifier","start":1456,"end":1465,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1466,"end":1480,"name":"providerTokens"},"computed":false},"right":{"type":"Identifier","start":1483,"end":1490,"name":"payload"}}}]},"alternate":null}]},"alternate":null},{"type":"ExpressionStatement","start":1512,"end":1519,"expression":{"type":"CallExpression","start":1512,"end":1518,"callee":{"type":"Identifier","start":1512,"end":1516,"name":"next"},"arguments":[]}}]}}}},{"type":"ExpressionStatement","start":1523,"end":1692,"expression":{"type":"AssignmentExpression","start":1523,"end":1691,"operator":"=","left":{"type":"MemberExpression","start":1523,"end":1546,"object":{"type":"Identifier","start":1523,"end":1530,"name":"exports"},"property":{"type":"Identifier","start":1531,"end":1546,"name":"cookieAuthToken"},"computed":false},"right":{"type":"ArrowFunctionExpression","start":1549,"end":1691,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":1550,"end":1553,"name":"req"},{"type":"Identifier","start":1555,"end":1558,"name":"res"},{"type":"Identifier","start":1560,"end":1564,"name":"next"}],"body":{"type":"BlockStatement","start":1569,"end":1691,"body":[{"type":"ExpressionStatement","start":1575,"end":1670,"expression":{"type":"AssignmentExpression","start":1575,"end":1669,"operator":"=","left":{"type":"MemberExpression","start":1575,"end":1598,"object":{"type":"MemberExpression","start":1575,"end":1588,"object":{"type":"Identifier","start":1575,"end":1578,"name":"req"},"property":{"type":"Identifier","start":1579,"end":1588,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1589,"end":1598,"name":"authToken"},"computed":false},"right":{"type":"MemberExpression","start":1601,"end":1669,"object":{"type":"MemberExpression","start":1601,"end":1612,"object":{"type":"Identifier","start":1601,"end":1604,"name":"req"},"property":{"type":"Identifier","start":1605,"end":1612,"name":"cookies"},"computed":false},"property":{"type":"TemplateLiteral","start":1613,"end":1668,"expressions":[{"type":"MemberExpression","start":1631,"end":1666,"object":{"type":"MemberExpression","start":1631,"end":1653,"object":{"type":"MemberExpression","start":1631,"end":1644,"object":{"type":"Identifier","start":1631,"end":1634,"name":"req"},"property":{"type":"Identifier","start":1635,"end":1644,"name":"companion"},"computed":false},"property":{"type":"Identifier","start":1645,"end":1653,"name":"provider"},"computed":false},"property":{"type":"Identifier","start":1654,"end":1666,"name":"authProvider"},"computed":false}],"quasis":[{"type":"TemplateElement","start":1614,"end":1629,"value":{"raw":"uppyAuthToken--","cooked":"uppyAuthToken--"},"tail":false},{"type":"TemplateElement","start":1667,"end":1667,"value":{"raw":"","cooked":""},"tail":true}]},"computed":true}}},{"type":"ReturnStatement","start":1675,"end":1689,"argument":{"type":"CallExpression","start":1682,"end":1688,"callee":{"type":"Identifier","start":1682,"end":1686,"name":"next"},"arguments":[]}}]}}}}],"sourceType":"script"}