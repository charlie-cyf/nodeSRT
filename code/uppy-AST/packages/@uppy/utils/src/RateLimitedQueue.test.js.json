{"type":"Program","start":0,"end":1384,"body":[{"type":"VariableDeclaration","start":0,"end":54,"declarations":[{"type":"VariableDeclarator","start":6,"end":54,"id":{"type":"Identifier","start":6,"end":22,"name":"RateLimitedQueue"},"init":{"type":"CallExpression","start":25,"end":54,"callee":{"type":"Identifier","start":25,"end":32,"name":"require"},"arguments":[{"type":"Literal","start":33,"end":53,"value":"./RateLimitedQueue","raw":"'./RateLimitedQueue'"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":56,"end":123,"declarations":[{"type":"VariableDeclarator","start":62,"end":123,"id":{"type":"Identifier","start":62,"end":67,"name":"delay"},"init":{"type":"ArrowFunctionExpression","start":70,"end":123,"id":null,"expression":true,"generator":false,"async":false,"params":[{"type":"Identifier","start":70,"end":72,"name":"ms"}],"body":{"type":"NewExpression","start":76,"end":123,"callee":{"type":"Identifier","start":80,"end":87,"name":"Promise"},"arguments":[{"type":"ArrowFunctionExpression","start":88,"end":122,"id":null,"expression":true,"generator":false,"async":false,"params":[{"type":"Identifier","start":88,"end":95,"name":"resolve"}],"body":{"type":"CallExpression","start":99,"end":122,"callee":{"type":"Identifier","start":99,"end":109,"name":"setTimeout"},"arguments":[{"type":"Identifier","start":110,"end":117,"name":"resolve"},{"type":"Identifier","start":119,"end":121,"name":"ms"}]}}]}}}],"kind":"const"},{"type":"ExpressionStatement","start":125,"end":1383,"expression":{"type":"CallExpression","start":125,"end":1383,"callee":{"type":"Identifier","start":125,"end":133,"name":"describe"},"arguments":[{"type":"Literal","start":134,"end":152,"value":"RateLimitedQueue","raw":"'RateLimitedQueue'"},{"type":"ArrowFunctionExpression","start":154,"end":1382,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":160,"end":1382,"body":[{"type":"VariableDeclaration","start":164,"end":179,"declarations":[{"type":"VariableDeclarator","start":168,"end":179,"id":{"type":"Identifier","start":168,"end":175,"name":"pending"},"init":{"type":"Literal","start":178,"end":179,"value":0,"raw":"0"}}],"kind":"let"},{"type":"FunctionDeclaration","start":182,"end":259,"id":{"type":"Identifier","start":191,"end":193,"name":"fn"},"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":197,"end":259,"body":[{"type":"ExpressionStatement","start":203,"end":212,"expression":{"type":"UpdateExpression","start":203,"end":212,"operator":"++","prefix":false,"argument":{"type":"Identifier","start":203,"end":210,"name":"pending"}}},{"type":"ReturnStatement","start":217,"end":255,"argument":{"type":"CallExpression","start":224,"end":255,"callee":{"type":"MemberExpression","start":224,"end":238,"object":{"type":"CallExpression","start":224,"end":233,"callee":{"type":"Identifier","start":224,"end":229,"name":"delay"},"arguments":[{"type":"Literal","start":230,"end":232,"value":15,"raw":"15"}]},"property":{"type":"Identifier","start":234,"end":238,"name":"then"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":239,"end":254,"id":null,"expression":true,"generator":false,"async":false,"params":[],"body":{"type":"UpdateExpression","start":245,"end":254,"operator":"--","prefix":false,"argument":{"type":"Identifier","start":245,"end":252,"name":"pending"}}}]}}]}},{"type":"ExpressionStatement","start":263,"end":674,"expression":{"type":"CallExpression","start":263,"end":674,"callee":{"type":"Identifier","start":263,"end":265,"name":"it"},"arguments":[{"type":"Literal","start":266,"end":314,"value":"should run at most N promises at the same time","raw":"'should run at most N promises at the same time'"},{"type":"ArrowFunctionExpression","start":316,"end":673,"id":null,"expression":false,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","start":328,"end":673,"body":[{"type":"VariableDeclaration","start":334,"end":371,"declarations":[{"type":"VariableDeclarator","start":340,"end":371,"id":{"type":"Identifier","start":340,"end":345,"name":"queue"},"init":{"type":"NewExpression","start":348,"end":371,"callee":{"type":"Identifier","start":352,"end":368,"name":"RateLimitedQueue"},"arguments":[{"type":"Literal","start":369,"end":370,"value":4,"raw":"4"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":376,"end":417,"declarations":[{"type":"VariableDeclarator","start":382,"end":417,"id":{"type":"Identifier","start":382,"end":385,"name":"fn2"},"init":{"type":"CallExpression","start":388,"end":417,"callee":{"type":"MemberExpression","start":388,"end":413,"object":{"type":"Identifier","start":388,"end":393,"name":"queue"},"property":{"type":"Identifier","start":394,"end":413,"name":"wrapPromiseFunction"},"computed":false},"arguments":[{"type":"Identifier","start":414,"end":416,"name":"fn"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":423,"end":545,"declarations":[{"type":"VariableDeclarator","start":429,"end":545,"id":{"type":"Identifier","start":429,"end":435,"name":"result"},"init":{"type":"CallExpression","start":438,"end":545,"callee":{"type":"MemberExpression","start":438,"end":449,"object":{"type":"Identifier","start":438,"end":445,"name":"Promise"},"property":{"type":"Identifier","start":446,"end":449,"name":"all"},"computed":false},"arguments":[{"type":"ArrayExpression","start":450,"end":544,"elements":[{"type":"CallExpression","start":458,"end":463,"callee":{"type":"Identifier","start":458,"end":461,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":465,"end":470,"callee":{"type":"Identifier","start":465,"end":468,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":472,"end":477,"callee":{"type":"Identifier","start":472,"end":475,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":479,"end":484,"callee":{"type":"Identifier","start":479,"end":482,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":492,"end":497,"callee":{"type":"Identifier","start":492,"end":495,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":499,"end":504,"callee":{"type":"Identifier","start":499,"end":502,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":506,"end":511,"callee":{"type":"Identifier","start":506,"end":509,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":513,"end":518,"callee":{"type":"Identifier","start":513,"end":516,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":526,"end":531,"callee":{"type":"Identifier","start":526,"end":529,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":533,"end":538,"callee":{"type":"Identifier","start":533,"end":536,"name":"fn2"},"arguments":[]}]}]}}],"kind":"const"},{"type":"ExpressionStatement","start":551,"end":574,"expression":{"type":"CallExpression","start":551,"end":574,"callee":{"type":"MemberExpression","start":551,"end":571,"object":{"type":"CallExpression","start":551,"end":566,"callee":{"type":"Identifier","start":551,"end":557,"name":"expect"},"arguments":[{"type":"Identifier","start":558,"end":565,"name":"pending"}]},"property":{"type":"Identifier","start":567,"end":571,"name":"toBe"},"computed":false},"arguments":[{"type":"Literal","start":572,"end":573,"value":4,"raw":"4"}]}},{"type":"ExpressionStatement","start":580,"end":595,"expression":{"type":"AwaitExpression","start":580,"end":595,"argument":{"type":"CallExpression","start":586,"end":595,"callee":{"type":"Identifier","start":586,"end":591,"name":"delay"},"arguments":[{"type":"Literal","start":592,"end":594,"value":10,"raw":"10"}]}}},{"type":"ExpressionStatement","start":600,"end":623,"expression":{"type":"CallExpression","start":600,"end":623,"callee":{"type":"MemberExpression","start":600,"end":620,"object":{"type":"CallExpression","start":600,"end":615,"callee":{"type":"Identifier","start":600,"end":606,"name":"expect"},"arguments":[{"type":"Identifier","start":607,"end":614,"name":"pending"}]},"property":{"type":"Identifier","start":616,"end":620,"name":"toBe"},"computed":false},"arguments":[{"type":"Literal","start":621,"end":622,"value":4,"raw":"4"}]}},{"type":"ExpressionStatement","start":629,"end":641,"expression":{"type":"AwaitExpression","start":629,"end":641,"argument":{"type":"Identifier","start":635,"end":641,"name":"result"}}},{"type":"ExpressionStatement","start":646,"end":669,"expression":{"type":"CallExpression","start":646,"end":669,"callee":{"type":"MemberExpression","start":646,"end":666,"object":{"type":"CallExpression","start":646,"end":661,"callee":{"type":"Identifier","start":646,"end":652,"name":"expect"},"arguments":[{"type":"Identifier","start":653,"end":660,"name":"pending"}]},"property":{"type":"Identifier","start":662,"end":666,"name":"toBe"},"computed":false},"arguments":[{"type":"Literal","start":667,"end":668,"value":0,"raw":"0"}]}}]}}]}},{"type":"ExpressionStatement","start":678,"end":1050,"expression":{"type":"CallExpression","start":678,"end":1050,"callee":{"type":"Identifier","start":678,"end":680,"name":"it"},"arguments":[{"type":"Literal","start":681,"end":714,"value":"should accept Infinity as limit","raw":"'should accept Infinity as limit'"},{"type":"ArrowFunctionExpression","start":716,"end":1049,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":722,"end":1049,"body":[{"type":"VariableDeclaration","start":728,"end":772,"declarations":[{"type":"VariableDeclarator","start":734,"end":772,"id":{"type":"Identifier","start":734,"end":739,"name":"queue"},"init":{"type":"NewExpression","start":742,"end":772,"callee":{"type":"Identifier","start":746,"end":762,"name":"RateLimitedQueue"},"arguments":[{"type":"Identifier","start":763,"end":771,"name":"Infinity"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":777,"end":818,"declarations":[{"type":"VariableDeclarator","start":783,"end":818,"id":{"type":"Identifier","start":783,"end":786,"name":"fn2"},"init":{"type":"CallExpression","start":789,"end":818,"callee":{"type":"MemberExpression","start":789,"end":814,"object":{"type":"Identifier","start":789,"end":794,"name":"queue"},"property":{"type":"Identifier","start":795,"end":814,"name":"wrapPromiseFunction"},"computed":false},"arguments":[{"type":"Identifier","start":815,"end":817,"name":"fn"}]}}],"kind":"const"},{"type":"VariableDeclaration","start":824,"end":946,"declarations":[{"type":"VariableDeclarator","start":830,"end":946,"id":{"type":"Identifier","start":830,"end":836,"name":"result"},"init":{"type":"CallExpression","start":839,"end":946,"callee":{"type":"MemberExpression","start":839,"end":850,"object":{"type":"Identifier","start":839,"end":846,"name":"Promise"},"property":{"type":"Identifier","start":847,"end":850,"name":"all"},"computed":false},"arguments":[{"type":"ArrayExpression","start":851,"end":945,"elements":[{"type":"CallExpression","start":859,"end":864,"callee":{"type":"Identifier","start":859,"end":862,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":866,"end":871,"callee":{"type":"Identifier","start":866,"end":869,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":873,"end":878,"callee":{"type":"Identifier","start":873,"end":876,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":880,"end":885,"callee":{"type":"Identifier","start":880,"end":883,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":893,"end":898,"callee":{"type":"Identifier","start":893,"end":896,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":900,"end":905,"callee":{"type":"Identifier","start":900,"end":903,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":907,"end":912,"callee":{"type":"Identifier","start":907,"end":910,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":914,"end":919,"callee":{"type":"Identifier","start":914,"end":917,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":927,"end":932,"callee":{"type":"Identifier","start":927,"end":930,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":934,"end":939,"callee":{"type":"Identifier","start":934,"end":937,"name":"fn2"},"arguments":[]}]}]}}],"kind":"const"},{"type":"ExpressionStatement","start":952,"end":976,"expression":{"type":"CallExpression","start":952,"end":976,"callee":{"type":"MemberExpression","start":952,"end":972,"object":{"type":"CallExpression","start":952,"end":967,"callee":{"type":"Identifier","start":952,"end":958,"name":"expect"},"arguments":[{"type":"Identifier","start":959,"end":966,"name":"pending"}]},"property":{"type":"Identifier","start":968,"end":972,"name":"toBe"},"computed":false},"arguments":[{"type":"Literal","start":973,"end":975,"value":10,"raw":"10"}]}},{"type":"ReturnStatement","start":982,"end":1045,"argument":{"type":"CallExpression","start":989,"end":1045,"callee":{"type":"MemberExpression","start":989,"end":1000,"object":{"type":"Identifier","start":989,"end":995,"name":"result"},"property":{"type":"Identifier","start":996,"end":1000,"name":"then"},"computed":false},"arguments":[{"type":"ArrowFunctionExpression","start":1001,"end":1044,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":1007,"end":1044,"body":[{"type":"ExpressionStatement","start":1015,"end":1038,"expression":{"type":"CallExpression","start":1015,"end":1038,"callee":{"type":"MemberExpression","start":1015,"end":1035,"object":{"type":"CallExpression","start":1015,"end":1030,"callee":{"type":"Identifier","start":1015,"end":1021,"name":"expect"},"arguments":[{"type":"Identifier","start":1022,"end":1029,"name":"pending"}]},"property":{"type":"Identifier","start":1031,"end":1035,"name":"toBe"},"computed":false},"arguments":[{"type":"Literal","start":1036,"end":1037,"value":0,"raw":"0"}]}}]}}]}}]}}]}},{"type":"ExpressionStatement","start":1054,"end":1380,"expression":{"type":"CallExpression","start":1054,"end":1380,"callee":{"type":"Identifier","start":1054,"end":1056,"name":"it"},"arguments":[{"type":"Literal","start":1057,"end":1118,"value":"should accept non-promise function in wrapPromiseFunction()","raw":"'should accept non-promise function in wrapPromiseFunction()'"},{"type":"ArrowFunctionExpression","start":1120,"end":1379,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":1126,"end":1379,"body":[{"type":"VariableDeclaration","start":1132,"end":1169,"declarations":[{"type":"VariableDeclarator","start":1138,"end":1169,"id":{"type":"Identifier","start":1138,"end":1143,"name":"queue"},"init":{"type":"NewExpression","start":1146,"end":1169,"callee":{"type":"Identifier","start":1150,"end":1166,"name":"RateLimitedQueue"},"arguments":[{"type":"Literal","start":1167,"end":1168,"value":1,"raw":"1"}]}}],"kind":"const"},{"type":"FunctionDeclaration","start":1174,"end":1205,"id":{"type":"Identifier","start":1183,"end":1189,"name":"syncFn"},"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":1193,"end":1205,"body":[{"type":"ReturnStatement","start":1195,"end":1203,"argument":{"type":"Literal","start":1202,"end":1203,"value":1,"raw":"1"}}]}},{"type":"VariableDeclaration","start":1210,"end":1255,"declarations":[{"type":"VariableDeclarator","start":1216,"end":1255,"id":{"type":"Identifier","start":1216,"end":1219,"name":"fn2"},"init":{"type":"CallExpression","start":1222,"end":1255,"callee":{"type":"MemberExpression","start":1222,"end":1247,"object":{"type":"Identifier","start":1222,"end":1227,"name":"queue"},"property":{"type":"Identifier","start":1228,"end":1247,"name":"wrapPromiseFunction"},"computed":false},"arguments":[{"type":"Identifier","start":1248,"end":1254,"name":"syncFn"}]}}],"kind":"const"},{"type":"ReturnStatement","start":1261,"end":1375,"argument":{"type":"CallExpression","start":1268,"end":1375,"callee":{"type":"MemberExpression","start":1268,"end":1279,"object":{"type":"Identifier","start":1268,"end":1275,"name":"Promise"},"property":{"type":"Identifier","start":1276,"end":1279,"name":"all"},"computed":false},"arguments":[{"type":"ArrayExpression","start":1280,"end":1374,"elements":[{"type":"CallExpression","start":1288,"end":1293,"callee":{"type":"Identifier","start":1288,"end":1291,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1295,"end":1300,"callee":{"type":"Identifier","start":1295,"end":1298,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1302,"end":1307,"callee":{"type":"Identifier","start":1302,"end":1305,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1309,"end":1314,"callee":{"type":"Identifier","start":1309,"end":1312,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1322,"end":1327,"callee":{"type":"Identifier","start":1322,"end":1325,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1329,"end":1334,"callee":{"type":"Identifier","start":1329,"end":1332,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1336,"end":1341,"callee":{"type":"Identifier","start":1336,"end":1339,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1343,"end":1348,"callee":{"type":"Identifier","start":1343,"end":1346,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1356,"end":1361,"callee":{"type":"Identifier","start":1356,"end":1359,"name":"fn2"},"arguments":[]},{"type":"CallExpression","start":1363,"end":1368,"callee":{"type":"Identifier","start":1363,"end":1366,"name":"fn2"},"arguments":[]}]}]}}]}}]}}]}}]}}],"sourceType":"script"}